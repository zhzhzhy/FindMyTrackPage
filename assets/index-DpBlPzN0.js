import{$ as ce,o as S,c as N,g as o,k as n,a,d as De,W as y,e as Z,w as ae,j as R,b as X,f as ke,y as H,F as q,r as ue,a0 as pe,a1 as me,a2 as Ce,C as de,l as ee,m as Se,J as $e,v as re,_ as Le}from"./vue-vrn0zMNo.js";import{H as Me}from"./@vuepic-CJcSshu8.js";import{u as te,a as b,r as oe,d as F,c as he}from"./@vue-CojEnYtN.js";import{m as U}from"./mapbox-gl-DWMaBres.js";import{M as Ve}from"./@mapbox-xjKLDsbk.js";import"./tinycolor2-CfovpC5H.js";import{P as be}from"./vue3-emoji-picker-BI_Z11BT.js";import{e as ie}from"./gcoord-CaovwXKb.js";import{c as je,a as Pe}from"./vue-router-h5yuP0F9.js";import{i as Ie,z as Ne}from"./element-plus-17KCLzoK.js";import"./vue3-openlayers-DEL4v-Rs.js";import{Q as Oe}from"./@element-plus-Qx67WbJO.js";import{l as Te,f as Ee,F as He}from"./@fortawesome-DNkv1NAJ.js";import"./date-fns-DjqgiLk-.js";import"./lodash-es-CiJSjksT.js";import"./@vueuse-CZ3kz2oL.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-n4Xreh4I.js";import"./async-validator-CiEh-HP4.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-B-WCBpf0.js";import"./ol-PaOofTtg.js";import"./rbush-DoHIURGA.js";import"./quickselect-cI_fw6Fh.js";import"./color-space-CC1atxIw.js";import"./color-rgba-QbDrIVEx.js";import"./color-parse-D1WSI7GZ.js";import"./color-name-XvCybByO.js";import"./earcut-DymNFgKl.js";import"./ol-ext-DKhM1omF.js";import"./ol-contextmenu-DtPVqisZ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&e(d)}).observe(document,{childList:!0,subtree:!0});function u(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function e(t){if(t.ep)return;t.ep=!0;const l=u(t);fetch(t.href,l)}})();const K=(i,s)=>{const u=i.__vccOpts||i;for(const[e,t]of s)u[e]=t;return u},Fe={class:"daterangepicker"},ze={class:"sidebar"},Re={__name:"VueDatePicker",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const s=ce(i,"modelValue");if(!s.value||s.value.length===0){const l=new Date,d=new Date(new Date().setDate(l.getDate()-7));s.value=[d,l]}const u=()=>{const l=new Date,d=new Date(new Date().setHours(l.getHours()-1));s.value=[d,l]},e=()=>{const l=new Date,d=new Date(new Date().setDate(l.getDate()-1));s.value=[d,l]},t=()=>{const l=new Date,d=new Date(new Date().setDate(l.getDate()-7));s.value=[d,l]};return(l,d)=>(S(),N("div",Fe,[o(te(Me),{modelValue:s.value,"onUpdate:modelValue":d[3]||(d[3]=c=>s.value=c),"teleport-center":"",range:""},{"right-sidebar":n(()=>[a("div",ze,[a("div",{class:"sidebar-div",onClick:d[0]||(d[0]=c=>u())},"Last Hour"),a("div",{class:"sidebar-div",onClick:d[1]||(d[1]=c=>e())},"Last Day"),a("div",{class:"sidebar-div",onClick:d[2]||(d[2]=c=>t())},"Last Week")])]),_:1},8,["modelValue"])]))}},ge=K(Re,[["__scopeId","data-v-905a76cf"]]),Ue={class:"block"},Ae=De({__name:"ElementDateTimePicker",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const s=ce(i,"modelValue");if(!s.value||s.value.length===0){const e=new Date,t=new Date(new Date().setDate(e.getDate()-7));s.value=[t,e]}const u=[{text:"Last day",value:()=>{const e=new Date,t=new Date;return t.setDate(t.getDate()-1),[t,e]}},{text:"Last week",value:()=>{const e=new Date,t=new Date;return t.setDate(t.getDate()-7),[t,e]}},{text:"Last month",value:()=>{const e=new Date,t=new Date;return t.setMonth(t.getMonth()-1),[t,e]}},{text:"Last 3 months",value:()=>{const e=new Date,t=new Date;return t.setMonth(t.getMonth()-3),[t,e]}}];return(e,t)=>{const l=y("el-date-picker");return S(),N("div",Ue,[o(l,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=d=>s.value=d),type:"datetimerange",shortcuts:u,"range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date"},null,8,["modelValue"])])}}}),_e=K(Ae,[["__scopeId","data-v-aadf7784"]]),Ke={__name:"GeoJSONConverter",props:{data:{type:Object,required:!0,default:{}}},setup(i,{expose:s}){const u=i,e=b({}),t=l=>{if(Object.keys(l).length>0){const d=l.data,c=[...d].sort((x,j)=>new Date(x.isodatetime)-new Date(j.isodatetime)),$=c.map(x=>({type:"Feature",properties:{name:x.id_short,id:x.id,conf:x.conf,status:x.status,TimeStamp:x.isodatetime,statusCode:x.statusCode},geometry:{type:"Point",coordinates:[x.longitude,x.latitude]}})),L=new Map,_=new Set([...d].map(x=>x.id));for(const x of _){const j=c.filter(O=>O.id==x).map(O=>[O.longitude,O.latitude]);j.length>1&&L.set(x,j)}const p=Array.from(L,([x,j])=>({type:"Feature",properties:{id:x},geometry:{type:"LineString",coordinates:j,direction:"forward","arrow-symbol":"triangle"}}));e.value={type:"FeatureCollection",features:[...$,...p]}}};return Z(()=>{ae(()=>u.data,l=>{Object.keys(l).length>0&&t(l)},{immediate:!0})}),s({convertToGeoJson:t,geoJsonData:e}),(l,d)=>null}},Je={__name:"DataHandler",props:{payload:{type:Object,default:{}}},setup(i,{expose:s}){const u=b(null),e=b(!0),t=b(null),l=b(),d=b(null),c=async $=>{const L={idArray:$.idSelected,dateTimeRange:{start:$.dateTimeRange[0],end:$.dateTimeRange[1]},mode:$.mode};try{const _=await fetch("https://fmt.geeek.cf/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)});if(!_.ok)throw new Error(`Error: ${_.statusText}`);const p=await _.json();return p&&(l.value=p),p}catch(_){t.value=_.message}finally{e.value=!1}};return Z(async()=>{ae(()=>u.value.geoJsonData,$=>{$&&(d.value=u.value.geoJsonData)},{immediate:!0})}),s({fetchData:c,exposedData:d}),($,L)=>(S(),R(Ke,{data:l.value,ref_key:"Geojsondata",ref:u},null,8,["data"]))}},fe=K(Je,[["__scopeId","data-v-91e4577f"]]),we={__name:"localStorage",props:{data:{type:Object,required:!0,default:{}}},setup(i){const u=i.data;return ae(()=>u,e=>{const t=JSON.stringify(e);localStorage.setItem("itemsProp",t)},{deep:!0}),(e,t)=>null}},le=i=>(pe("data-v-3bf158c7"),i=i(),me(),i),Be={class:"main-layout-wrapper"},Ge={class:"main-layout"},We=le(()=>a("i",{class:"fa-solid fa-list",style:{"margin-right":"10px"}},null,-1)),qe={class:"flex-center"},Ze={class:"flex flex-wrap gap-4"},Ye=le(()=>a("span",{class:"hide-small",style:{"vertical-align":"middle"}}," Clear ",-1)),Qe={class:"flex"},Xe=le(()=>a("i",{class:"fa-regular fa-square-check hide-small margin-right"},null,-1)),et=le(()=>a("i",{class:"fa-solid fa-fire hide-small margin-right"},null,-1)),tt=le(()=>a("i",{class:"fa-regular fa-clock hide-small margin-right"},null,-1)),ot={__name:"MainPanel",props:{itemsProps:{type:Object,default:{}}},emits:["submit","addHeatMap","realtime"],setup(i,{emit:s}){const u=b(!1);b("btt");const e=b([]),t=b({}),l=b(null),d=b({}),c=oe({idSelected:[],dateTimeRange:{start:"",end:""},mode:""}),$=i,L=b(window.innerWidth),_=()=>{L.value=window.innerWidth},p=s,x=X(()=>L.value<=770?"90%":"30%"),j=X(()=>L.value<=770),O=()=>{c.idSelected.length>0&&Array.from(c.dateTimeRange).length>1&&p("submit",c)},v=()=>{c.idSelected.length>0&&Array.from(c.dateTimeRange).length>1&&p("addHeatMap",c)},M=()=>{c.idSelected.length>0&&p("realtime",c)},T=()=>{c.idSelected=[]};return Z(()=>{window.addEventListener("resize",_),c.dateTimeRange=e.value,ae(()=>e.value,h=>{c.dateTimeRange=h,t.value=h}),ae(()=>c,h=>{t.value=h},{deep:!0})}),ke(()=>{window.removeEventListener("resize",_)}),(h,P)=>{const A=y("el-button"),Y=y("el-option"),I=y("el-select"),g=y("el-col"),C=y("CircleClose"),f=y("el-icon"),r=y("el-row"),m=y("el-form-item"),D=y("el-form"),w=y("el-card"),z=y("el-dialog");return S(),N(q,null,[a("div",Be,[a("div",Ge,[j.value?(S(),R(ge,{key:1,modelValue:e.value,"onUpdate:modelValue":P[1]||(P[1]=k=>e.value=k),range:""},null,8,["modelValue"])):(S(),R(_e,{key:0,modelValue:e.value,"onUpdate:modelValue":P[0]||(P[0]=k=>e.value=k)},null,8,["modelValue"]))]),o(A,{class:"dialog-button",type:"primary",onClick:P[2]||(P[2]=k=>u.value=!0)},{default:n(()=>[We,H("Data Select ")]),_:1}),o(fe,{payload:t.value,ref_key:"DataHandlerRef",ref:l},null,8,["payload"]),o(we,{data:d.value},null,8,["data"])]),o(z,{modelValue:u.value,"onUpdate:modelValue":P[6]||(P[6]=k=>u.value=k),title:"Data select",width:x.value,draggable:"","align-center":""},{default:n(()=>[a("div",qe,[a("div",Ze,[o(w,{class:"card",shadow:"never",style:{"max-width":"600px"}},{default:n(()=>[o(D,{model:c,"label-width":"auto"},{default:n(()=>[o(m,{label:"Items select"},{default:n(()=>[o(r,{gutter:10},{default:n(()=>[o(g,{span:20},{default:n(()=>[o(I,{modelValue:c.idSelected,"onUpdate:modelValue":P[3]||(P[3]=k=>c.idSelected=k),multiple:"",filterable:"","default-first-option":"","reserve-keyword":!1,placeholder:"Choose your items",style:{"min-width":"150px"}},{default:n(()=>[(S(!0),N(q,null,ue($.itemsProps.value,(k,E)=>(S(),R(Y,{key:E,label:`${k.emoji} ${k.Name}`,value:k.pubKey},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(g,{span:4},{default:n(()=>[o(A,{onClick:T,type:"primary"},{default:n(()=>[o(f,{style:{"vertical-align":"middle"}},{default:n(()=>[o(C)]),_:1}),Ye]),_:1})]),_:1})]),_:1})]),_:1}),o(m,{label:"Activity time",style:{"max-width":"600px"}},{default:n(()=>[o(g,{span:24},{default:n(()=>[j.value?(S(),R(ge,{key:1,modelValue:e.value,"onUpdate:modelValue":P[5]||(P[5]=k=>e.value=k),range:""},null,8,["modelValue"])):(S(),R(_e,{key:0,modelValue:e.value,"onUpdate:modelValue":P[4]||(P[4]=k=>e.value=k)},null,8,["modelValue"]))]),_:1})]),_:1}),o(m,null,{default:n(()=>[a("div",Qe,[o(A,{type:"primary",onClick:O},{default:n(()=>[Xe,H("Get Data ")]),_:1}),o(A,{type:"primary",onClick:v},{default:n(()=>[et,H("HeatMap ")]),_:1}),o(A,{type:"primary",onClick:M},{default:n(()=>[tt,H("RealTime ")]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})])])]),_:1},8,["modelValue","width"])],64)}}},at=K(ot,[["__scopeId","data-v-3bf158c7"]]),lt={id:"menu"},nt={class:"input-label-row"},st=["id","value","checked"],rt=["for"],ye="streets",it={__name:"MapboxMain",props:{geodata:{type:Object,default:{}},itemsPropMap:{type:Object,default:{}}},setup(i,{expose:s}){const u=b(null),e=b(null),t=b(null);let l=!1;const d={ar:"ar",de:"de",en:"en",es:"es",fr:"fr",it:"it",ja:"ja",ko:"ko",mul:"mul",pt:"pt",ru:"ru",vi:"vi","zh-CN":"zh-Hans","zh-HK":"zh-Hant","zh-TW":"zh-Hant","zh-Hans":"zh-Hans","zh-Hant":"zh-Hant"},c=[],$="pk.eyJ1IjoiZ2Vla2NhdCIsImEiOiJjbHc5ZTJ6dmIwMTEyMmpudGowMXk5Y3o2In0.HDxYFBSNCpbYan731GLJEw",L=[{id:"satellite-streets",label:"Satellite Streets",url:"mapbox://styles/geekcat/clwc44om0008b01pn91yg82cg"},{id:"light-v11",label:"Light",url:"mapbox://styles/mapbox/light-v11"},{id:"dark-v11",label:"Dark",url:"mapbox://styles/mapbox/dark-v11"},{id:"streets",label:"Streets",url:"mapbox://styles/geekcat/clwxb0z8q01ep01pohp1h4q4d"},{id:"outdoors",label:"Outdoors",url:"mapbox://styles/geekcat/clwxbnita01es01po7fto915q"},{id:"amap",label:"高德地图",url:{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://wprd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}"],tileSize:256}},layers:[{id:"amap-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:24}]}}],_=i,p=()=>{const f=navigator.language||navigator.userLanguage,r=navigator.language.split("-")[0];let m="mul";r=="zh"&&d[f]&&(m=d[f]),r!=="zh"&&d[r]&&(m=d[r]),U.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js");const D=new Ve({defaultLanguage:m});e.value.language=m,e.value.setStyle(D.setLanguage(e.value.getStyle(),m)),e.value.addControl(D)},x=f=>{const r=f.target.value,m=L.find(D=>D.id===r).url;e.value&&(e.value.setStyle(m),e.value.once("style.load",()=>{_.geodata.status=="GeoJSONLayers"&&v(_.geodata.data),_.geodata.status=="HeatMap"&&O(_.geodata.data)}))},j=f=>{const r=["match",["get","id"]];return Object.entries(f).length>0&&Object.entries(f).forEach(([D,w])=>{r.push(D,w)}),r.push("#B42222"),r},O=f=>{Object.keys(f).length!=0&&(e.value.getSource("findmy-data")||e.value.addSource("findmy-data",{type:"geojson",data:f}),e.value.getLayer("findmy-heatmap")||e.value.addLayer({id:"findmy-heatmap",type:"heatmap",source:"findmy-data",maxzoom:17,paint:{"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3,15,10],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,15],"heatmap-opacity":["interpolate",["linear"],["zoom"],0,.6,10,.7,17,1]},filter:["==","$type","Point"]}))},v=f=>{if(Object.keys(f).length==0)return;const r={},m={};Object.entries(_.itemsPropMap.value).forEach(z=>{const[k,E]=z;r[k]=E.pointColor,m[k]=E.lineColor});const D=j(r),w=j(m);e.value.getSource("findmy-data")||e.value.addSource("findmy-data",{type:"geojson",data:f}),e.value.getLayer("findmy-point")||e.value.addLayer({id:"findmy-point",type:"circle",source:"findmy-data",paint:{"circle-radius":6,"circle-color":D},filter:["==","$type","Point"]}),e.value.getLayer("findmy-route")||e.value.addLayer({id:"findmy-route",type:"line",source:"findmy-data",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":w,"line-width":3,"line-dasharray":[1,2]},filter:["==","$type","LineString"]}),e.value.getLayer("line-arrows")||e.value.addLayer({id:"line-arrows",type:"symbol",source:"findmy-data",layout:{"symbol-placement":"line","text-field":"▶","text-size":24,"symbol-spacing":50,"text-keep-upright":!1},paint:{"text-color":"red"},filter:["==","$type","LineString"]})},M=(f,r)=>{f.forEach(m=>{e.value.getLayer(m)&&e.value.removeLayer(m)}),r.forEach(m=>{e.value.getSource(m)&&e.value.removeSource(m)})},T=f=>{const r=new U.LngLatBounds;f.features.forEach(function(m){const D=m.geometry.coordinates;r.extend(D)}),e.value.fitBounds(r,{padding:50,maxZoom:15})},h=f=>{const r=["in",["get","name"],["literal",f]];e.value.setFilter("findmy-point",r),e.value.setFilter("findmy-route",r),e.value.setFilter("line-arrows",r),l=!0},P=()=>{e.value.setFilter("findmy-point",null),e.value.setFilter("findmy-route",null),e.value.setFilter("line-arrows",null),l=!1},A=f=>{for(const r of f.features){const m=r.properties.id,D=document.createElement("div");D.className="marker";const w=document.createElement("div");if(w.className="markerWrapper",w.innerHTML='<div class="emoji-wrapper">🌏</div>',_.itemsPropMap.value[m].emoji){const V=_.itemsPropMap.value[m].emoji;w.innerHTML=`<div class="emoji-wrapper">${V}</div>`}D.appendChild(w);const z=_.itemsPropMap.value[m].Name,k=r.geometry.coordinates,E=k.join(","),B=r.properties.TimeStamp,Q=new U.Popup({offset:25}).setHTML(`<strong>Name:</strong> ${z}<br/><strong>Coordinates:</strong> ${E}<br/><strong>Timestamp:</strong> ${B}`),se=new U.Marker(D).setLngLat(k).setPopup(Q).addTo(e.value);c.push(se)}},Y=()=>{if(c.length>0)for(const f of c)f.remove()};function I(){var f=e.value.getCenter(),r=e.value.getZoom();localStorage.setItem("mapCenter",JSON.stringify(f)),localStorage.setItem("mapZoom",r)}function g(){var f=JSON.parse(localStorage.getItem("mapCenter")),r=localStorage.getItem("mapZoom");f&&r&&(e.value.setCenter(f),e.value.setZoom(r))}const C=new U.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});return s({map:e,switchStyle:x,setStyleLanguage:p,geometryColorSet:j,addHeatmapLayer:O,addGeoJSONLayers:v,removeGeoJSONLayers:M,setMapFilter:h,removeMapFilter:P,FitBounds:T,addRealtimeMarker:A,removeMarkers:Y}),Z(()=>{const f=[104.0657,30.6594];U.accessToken=$,e.value=new U.Map({container:u.value,style:L.find(r=>r.id===ye).url,center:f,zoom:2}),g(),e.value.on("moveend",function(){I()}),e.value.on("load",()=>{p()}),e.value.on("mouseenter","findmy-point",r=>{e.value.getCanvas().style.cursor="pointer";const m=l?1:0,D=r.features[m].geometry.coordinates.slice(),w=D.map(Q=>Q.toFixed(4).toString()),z=r.features[m].properties.TimeStamp,k=r.features[m].properties.id,E=_.itemsPropMap.value[k].Name,B=new U.Popup({offset:25}).setLngLat(D).setHTML(`<strong>Name:</strong> ${E}<br/><strong>Coordinates:</strong> ${w}<br/><strong>Timestamp:</strong> ${z}`).addTo(e.value);e.value.on("mouseleave","findmy-point",()=>{e.value.getCanvas().style.cursor="",B.remove()})}),e.value.on("click","findmy-point",r=>{const m=l?1:0,D=r.features[m].geometry.coordinates.slice(),w=D.map(B=>B.toFixed(4).toString()),z=r.features[m].properties.TimeStamp,k=r.features[m].properties.id,E=_.itemsPropMap.value[k].Name;new U.Popup({offset:25}).setLngLat(D).setHTML(`<strong>Name:</strong> ${E}<br/><strong>Coordinates:</strong> ${w}<br/><strong>Timestamp:</strong> ${z}`).addTo(e.value)}),e.value.addControl(new U.NavigationControl),e.value.addControl(C)}),(f,r)=>{const m=y("el-row"),D=y("el-col");return S(),N("div",null,[a("div",{id:"map",ref_key:"mapContainer",ref:u},null,512),o(fe,{ref_key:"DataHandlerRef",ref:t},null,512),a("div",lt,[o(D,null,{default:n(()=>[(S(),N(q,null,ue(L,w=>o(m,{span:6,key:w.id},{default:n(()=>[a("div",nt,[a("input",{id:w.id,type:"radio",name:"rtoggle",value:w.id,checked:w.id===ye,onChange:x},null,40,st),a("label",{for:w.id},F(w.label),9,rt)])]),_:2},1024)),64))]),_:1})])])}}},dt=K(it,[["__scopeId","data-v-f9c0b5c1"]]),ve=i=>(pe("data-v-a0b54543"),i=i(),me(),i),ct={class:"flex-row-center"},ut={class:"flex-row"},pt=ve(()=>a("div",{class:"margin-right"},"iconColor:",-1)),mt={class:"flex-row"},ft=ve(()=>a("div",{class:"margin-right"},"pointColor:",-1)),vt={class:"flex-row"},gt=ve(()=>a("div",{class:"margin-right"},"lineColor:",-1)),_t={__name:"ColorPicker",props:{PropsMap:Object,selectedDevice:Object},setup(i){const s=i,u=X({get(){return s.selectedDevice.prop.bgColor},set(d){s.selectedDevice.prop.bgColor=d}}),e=X({get(){return s.selectedDevice.prop.pointColor},set(d){s.selectedDevice.prop.pointColor=d}}),t=X({get(){return s.selectedDevice.prop.lineColor},set(d){s.selectedDevice.prop.lineColor=d}}),l=b(["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgb(255, 120, 0)","#c71585"]);return(d,c)=>{const $=y("el-color-picker"),L=y("el-col"),_=y("el-row");return S(),N("div",ct,[o(_,{gutter:10},{default:n(()=>[o(L,{xs:24,sm:24,md:8,lg:8},{default:n(()=>[a("div",ut,[pt,o($,{modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=p=>u.value=p),predefine:l.value},null,8,["modelValue","predefine"])])]),_:1}),o(L,{xs:24,sm:24,md:8,lg:8},{default:n(()=>[a("div",mt,[ft,o($,{modelValue:e.value,"onUpdate:modelValue":c[1]||(c[1]=p=>e.value=p),predefine:l.value},null,8,["modelValue","predefine"])])]),_:1}),o(L,{xs:24,sm:24,md:8,lg:8},{default:n(()=>[a("div",vt,[gt,o($,{modelValue:t.value,"onUpdate:modelValue":c[2]||(c[2]=p=>t.value=p),predefine:l.value},null,8,["modelValue","predefine"])])]),_:1})]),_:1})])}}},yt=K(_t,[["__scopeId","data-v-a0b54543"]]),ht={key:0,class:"flex-column"},bt={class:"justify-center"},wt={class:"Emoji-2x"},xt={class:"Edit-info-div"},Dt={class:"Edit-info-div-inner"},kt={class:"info-item flex-prop"},Ct={key:0,class:"single-line-text"},St={class:"info-item flex-prop"},$t={key:0,class:"single-line-text"},Lt={class:"info-item flex-prop"},Mt={key:0,class:"single-line-text"},Vt={class:"info-item flex-prop"},jt={key:0,class:"single-line-text"},Pt={__name:"EditDeviceDialog",props:Ce({dialogEditVisible:Boolean,selectedDevice:Object,iconBgColor:Function,onSelectEmoji:Function},{modelValue:{prop:"modelValue",event:"update:modelValue"},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const s=i,u=ce(i,"modelValue"),e=b(!1),t=b(!1),l=b(!1),d=b(!1),c=b(!1),$=_=>{if(!c.value)switch(c.value=!0,setTimeout(()=>{c.value=!1},100),_){case"Name":e.value=!e.value;break;case"pubKey":t.value=!t.value;break;case"Location":l.value=!l.value;break;case"Lastupdate":d.value=!d.value;break}},L=_=>{$(_)};return(_,p)=>{const x=y("el-button"),j=y("el-popover"),O=y("el-col"),v=y("el-input"),M=y("el-row"),T=y("el-dialog");return S(),R(T,{modelValue:u.value,"onUpdate:modelValue":p[9]||(p[9]=h=>u.value=h),title:"Edit Device",draggable:"",width:"50%",class:"responsive-dialog"},{default:n(()=>[i.selectedDevice?(S(),N("div",ht,[o(M,{gutter:10},{default:n(()=>[o(O,{xs:24,sm:24,md:6,lg:4},{default:n(()=>[a("div",bt,[o(j,{placement:"top",title:"Icon Picker",width:300,trigger:"click"},{reference:n(()=>[o(x,{class:"icon-div-2x",style:he(i.iconBgColor(i.selectedDevice.prop.bgColor))},{default:n(()=>[a("div",wt,F(i.selectedDevice.prop.emoji),1)]),_:1},8,["style"])]),default:n(()=>[o(te(be),{native:!0,onSelect:p[0]||(p[0]=h=>i.onSelectEmoji(h,i.selectedDevice.id))})]),_:1})])]),_:1}),o(O,{xs:24,sm:24,md:18,lg:20},{default:n(()=>[a("div",xt,[a("div",Dt,[a("div",kt,[H(" Name: "),e.value?(S(),R(v,{key:1,modelValue:i.selectedDevice.prop.Name,"onUpdate:modelValue":p[1]||(p[1]=h=>i.selectedDevice.prop.Name=h),onBlur:p[2]||(p[2]=h=>L("Name")),onKeyup:p[3]||(p[3]=de(h=>L("Name"),["enter"]))},null,8,["modelValue"])):(S(),N("span",Ct,F(i.selectedDevice.prop.Name),1)),a("i",{onClick:p[4]||(p[4]=h=>$("Name")),class:"fas fa-edit edit-icon"})]),a("div",St,[H(" pubKey: "),t.value?(S(),R(v,{key:1,modelValue:i.selectedDevice.prop.pubKey,"onUpdate:modelValue":p[5]||(p[5]=h=>i.selectedDevice.prop.pubKey=h),onBlur:p[6]||(p[6]=h=>L("pubKey")),onKeyup:p[7]||(p[7]=de(h=>L("pubKey"),["enter"]))},null,8,["modelValue"])):(S(),N("span",$t,F(i.selectedDevice.prop.pubKey),1)),a("i",{onClick:p[8]||(p[8]=h=>$("pubKey")),class:"fas fa-edit edit-icon"})]),a("div",Lt,[H(" Location: "),l.value?ee("",!0):(S(),N("span",Mt,F(i.selectedDevice.prop.Location),1))]),a("div",Vt,[H(" Lastupdate: "),d.value?ee("",!0):(S(),N("span",jt,F(i.selectedDevice.prop.Lastupdate),1))])])])]),_:1})]),_:1}),o(yt,Se(_.$attrs,{selectedDevice:s.selectedDevice}),null,16,["selectedDevice"])])):ee("",!0)]),_:1},8,["modelValue"])}}},It=K(Pt,[["__scopeId","data-v-64d6d802"]]),J=i=>(pe("data-v-da450692"),i=i(),me(),i),Nt={class:"manageForm"},Ot=J(()=>a("span",{class:"hide-small",style:{"vertical-align":"middle"}}," Add ",-1)),Tt={class:"justify-end"},Et=J(()=>a("i",{class:"fa-solid fa-trash margin-right"},null,-1)),Ht=J(()=>a("span",{class:"hide-small",style:{"vertical-align":"middle"}}," Clear All",-1)),Ft=J(()=>a("i",{class:"fa-solid fa-rotate-right margin-right"},null,-1)),zt=J(()=>a("span",{class:"hide-small",style:{"vertical-align":"middle"}}," Refresh ",-1)),Rt={class:"scrolldiv"},Ut={class:"itemsdiv"},At={class:"card-inner"},Kt={class:"Emoji"},Jt={class:"item-prop"},Bt={class:"flex-prop"},Gt={class:"flex-wrap"},Wt={key:0},qt=J(()=>a("i",{class:"fa-solid fa-copy"},null,-1)),Zt={class:"flex-prop"},Yt={class:"flex-wrap"},Qt={key:0},Xt=J(()=>a("i",{class:"fa-solid fa-copy"},null,-1)),eo={class:"single-line-text"},to={class:"single-line-text"},oo={class:"main-layout-wrapper"},ao=J(()=>a("i",{class:"fa-solid fa-box-archive",style:{"margin-right":"10px"}},null,-1)),lo={__name:"itemsManage",props:{propsMap:{type:Object,default:{}}},emits:["updateItemProps","reqUpdateItemProps"],setup(i,{emit:s}){const u=b(!1),e=b(!1),t=b(""),l=b(new Set),d=b(null),c=b(null),$=s,L=g=>g?`background-color:${g}`:"",_=b("350px"),p=()=>{const g=window.innerWidth,C=window.innerHeight;_.value=C*.5+"px",g<=768&&(_.value=C*.6+"px")};Z(()=>{p(),window.addEventListener("resize",p),A()}),$e(()=>{window.removeEventListener("resize",p)});const x=g=>{c.value={id:g,prop:I[g]},e.value=!0},j=g=>{d.value=g},O=g=>{g in I&&delete I[g]},v=(g,C)=>{I[C].emoji=g.i,I[C].emojiName=g.n[0],I[C].emojiValue=g.u},M=()=>{const g=t.value;if(g&&!l.value.has(g)){l.value.add(g);const C=g,f=Y();I[C]={emoji:"🌏",emojiName:"",emojiValue:"",bgColor:"#FFFFFF",pointColor:"red",lineColor:"blue",Name:f,serialNum:"N/A",pubKey:C,Lastupdate:"N/A",Added:new Date().toISOString(),Coordinate:["N/A","N/A"],Location:"N/A"},$("updateItemProps",I),t.value=""}},T=()=>{$("reqUpdateItemProps",I)},h=()=>{Object.keys(I).forEach(g=>{delete I[g]})},P=g=>{navigator.clipboard.writeText(g).then(()=>{console.log("Copied to clipboard successfully!")},C=>{console.error("Could not copy text: ",C)})},A=()=>{if(localStorage.getItem("itemsProp")){const g=localStorage.getItem("itemsProp"),C=JSON.parse(g);Object.assign(I,C.value),$("updateItemProps",I)}},Y=(()=>{const g=[];function C(f=5){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let m="";for(let D=0;D<f;D++)m+=r.charAt(Math.floor(Math.random()*r.length));return m}return function(f=6){let r;do r=C(f);while(g.includes(r));return g.push(r),r}})();let I=oe({});return(g,C)=>{const f=y("el-input"),r=y("el-col"),m=y("CirclePlus"),D=y("el-icon"),w=y("el-button"),z=y("el-popconfirm"),k=y("el-row"),E=y("el-popover"),B=y("el-card"),Q=y("el-scrollbar"),se=y("el-dialog");return S(),N(q,null,[o(se,{modelValue:u.value,"onUpdate:modelValue":C[1]||(C[1]=V=>u.value=V),title:"Items Manage",draggable:"",width:"95%"},{default:n(()=>[a("div",Nt,[o(k,{gutter:20},{default:n(()=>[o(r,{xs:12,sm:8},{default:n(()=>[o(f,{modelValue:t.value,"onUpdate:modelValue":C[0]||(C[0]=V=>t.value=V),onKeydown:de(M,["enter"])},null,8,["modelValue"])]),_:1}),o(r,{xs:4,sm:4},{default:n(()=>[o(w,{type:"primary",onClick:M},{default:n(()=>[o(D,{style:{"vertical-align":"middle"}},{default:n(()=>[o(m)]),_:1}),Ot]),_:1})]),_:1}),o(r,{xs:4,sm:8}),o(r,{xs:4,sm:4},{default:n(()=>[a("div",Tt,[o(z,{"confirm-button-text":"Yes","cancel-button-text":"No","icon-color":"red",title:"Are you sure to delete All items?",onConfirm:h},{reference:n(()=>[o(w,{class:"clear-button",type:"danger"},{default:n(()=>[Et,Ht]),_:1})]),_:1}),o(w,{class:"refresh-button",type:"primary",onClick:T},{default:n(()=>[Ft,zt]),_:1})])]),_:1})]),_:1})]),o(Q,{"max-height":_.value},{default:n(()=>[a("div",Rt,[a("div",Ut,[o(k,{gutter:10},{default:n(()=>[(S(!0),N(q,null,ue(te(I),(V,W)=>(S(),R(r,{key:W,xs:24,sm:12,md:8,lg:6},{default:n(()=>[o(E,{ref_for:!0,ref:"popover",placement:"top",title:"Options",width:200,trigger:"contextmenu"},{reference:n(()=>[o(B,{class:"card",shadow:"hover",onClick:G=>x(W)},{default:n(()=>[a("div",At,[o(E,{placement:"right",title:"Icon Picker",width:300,trigger:"click"},{reference:n(()=>[o(w,{class:"icon-div",onClick:re(G=>j(W),["stop"]),style:he(L(V.bgColor))},{default:n(()=>[a("div",Kt,F(V.emoji),1)]),_:2},1032,["onClick","style"])]),default:n(()=>[o(te(be),{native:!0,onSelect:G=>v(G,W)},null,8,["onSelect"])]),_:2},1024),a("div",Jt,[a("div",Bt,[H("Name: "),o(E,{trigger:"hover",placement:"top"},{reference:n(()=>[a("div",Gt,[H(F(V.Name.substring(0,13))+" ",1),V.Name.length>10?(S(),N("div",Wt,"... ")):ee("",!0),o(w,{link:"",onClick:re(G=>P(V.Name),["stop"])},{default:n(()=>[qt]),_:2},1032,["onClick"])])]),default:n(()=>[a("div",null,F(V.Name),1)]),_:2},1024)]),a("div",Zt,[H("pubKey: "),o(E,{trigger:"hover",placement:"top"},{reference:n(()=>[a("div",Yt,[H(F(V.pubKey.substring(0,13))+" ",1),V.pubKey.length>10?(S(),N("div",Qt,"... ")):ee("",!0),o(w,{link:"",onClick:re(G=>P(V.pubKey),["stop"])},{default:n(()=>[Xt]),_:2},1032,["onClick"])])]),default:n(()=>[a("div",null,F(V.pubKey),1)]),_:2},1024)]),a("div",eo,"Location: "+F(V.Location),1),a("div",to,"LastUpdate: "+F(V.Lastupdate),1)])])]),_:2},1032,["onClick"])]),default:n(()=>[a("div",null,[o(w,{onClick:G=>x(W)},{default:n(()=>[H("Edit")]),_:2},1032,["onClick"]),o(w,{type:"danger",onClick:G=>O(W)},{default:n(()=>[H("Delete")]),_:2},1032,["onClick"])])]),_:2},1536)]),_:2},1024))),128))]),_:1})])])]),_:1},8,["max-height"])]),_:1},8,["modelValue"]),o(It,{modelValue:e.value,"onUpdate:modelValue":C[2]||(C[2]=V=>e.value=V),selectedDevice:c.value,iconBgColor:L,onSelectEmoji:v,PropsMap:te(I)},null,8,["modelValue","selectedDevice","PropsMap"]),a("div",oo,[o(w,{class:"dail-button",type:"primary",onClick:C[3]||(C[3]=V=>u.value=!0)},{default:n(()=>[ao,H("Items ")]),_:1})])],64)}}},no=K(lo,[["__scopeId","data-v-da450692"]]),xe={__name:"MainApp",setup(i){const s=b(null),u=b(null),e=b({}),t=oe({}),l={layers:["findmy-point","findmy-route","line-arrows","findmy-heatmap"],sources:["findmy-data"]},d=v=>{c(v),e.value.data=v,e.value.status="GeoJSONLayers",s.value.removeGeoJSONLayers(l.layers,l.sources),s.value.addGeoJSONLayers(v),s.value.FitBounds(v)},c=v=>{s.value.map.getStyle().layers[0].id=="amap-tiles"&&ie.transform(v,ie.WGS84,ie.GCJ02)},$=v=>{e.value.data=v,e.value.status="HeatMap",s.value.removeGeoJSONLayers(l.layers,l.sources),s.value.addHeatmapLayer(v),s.value.FitBounds(v)},L=async v=>{v.mode="timerange",await u.value.fetchData(v);const M=u.value.exposedData;d(M)},_=async v=>{v.mode="timerange",await u.value.fetchData(v);const M=u.value.exposedData;$(M)},p=async v=>{const M={...v};M.dateTimeRange=[],M.mode="realtime",await u.value.fetchData(M);const T=u.value.exposedData;c(T),s.value.removeMarkers(),s.value.addRealtimeMarker(T),s.value.FitBounds(T)},x=async()=>{const v=t.value,M=oe({idSelected:[],dateTimeRange:[],mode:"realtime"});if(v&&Object.keys(v).length){Object.values(v).forEach(h=>{M.idSelected.push(h.pubKey)}),await u.value.fetchData(M);const T=u.value.exposedData;c(T),s.value.removeMarkers(),s.value.addRealtimeMarker(T),s.value.FitBounds(T)}},j=v=>{t.value=v},O=async v=>{const M=oe({idSelected:[],dateTimeRange:[],mode:"realtime"});Object.values(v).forEach(h=>{M.idSelected.push(h.pubKey)}),(await u.value.fetchData(M)).data.forEach(h=>{v[h.id].Lastupdate=h.isodatetime,v[h.id].Coordinate=[h.longitude,h.latitude]})};return Z(()=>{x()}),(v,M)=>(S(),N(q,null,[o(at,{"items-props":t,onSubmit:L,onAddHeatMap:_,onRealtime:p},null,8,["items-props"]),o(no,{onUpdateItemProps:j,onReqUpdateItemProps:O}),o(dt,{geodata:e.value,itemsPropMap:t,ref_key:"MapboxMainRef",ref:s},null,8,["geodata","itemsPropMap"]),o(fe,{ref_key:"DataHandlerRef",ref:u},null,512),o(we,{data:t},null,8,["data"])],64))}},so={__name:"App",setup(i){return(s,u)=>(S(),R(xe))}};je({history:Pe("/FindMyTrackPage/"),routes:[{path:"/",name:"home",component:xe}]});Te.add(Ee);const ne=Le(so);ne.component("font-awesome-icon",He);for(const[i,s]of Object.entries(Oe))ne.component(i,s);ne.use(Ie,{locale:Ne});ne.mount("#app");
