import{m as Ae,C as Ie,V as Oe,I as Fe,B as we,a as R,u as D,i as Ve,b as de,c as De,T as me,d as ze,H as Re,S as Be,e as Ge,f as Ue,L as He,g as qe,t as q,h as We,j as V,k as z,F as $,l as K,n as se,o as fe,p as H,M as ve,P as ee,q as ae,r as je,s as Te,v as U,w as Ye,x as ye,y as re,z as Se,A as Xe,D as _e,E as Ee,R as oe,G as he,J as G,K as ie,N as Ze,O as be,Q as Je,U as Ke,W as Qe}from"./ol-PaOofTtg.js";function xe(r){const e=r.frameState,t=Ae(r.inversePixelTransform.slice(),e.coordinateToPixelTransform);return new Ie(r.context,e.pixelRatio,e.extent,t,e.viewState.rotation)}var Q=Oe.split(".");Q=parseInt(Q[0])*100+parseInt(Q[1]);var $e=function(r,e){var t=r.frameState.pixelRatio;if(Q>605&&Q<700&&t!==1&&e.getImage()instanceof Fe){e=e.clone();var i=e.getImage();i.setScale(i.getScale()*t);var s=i.getAnchor();if(s&&i.setDisplacement){var a=i.getDisplacement();a&&(a[0]-=s[0]/t,a[1]+=s[1]/t,i.setAnchor([0,0]))}else s&&(s[0]/=t,s[1]/=t)}return e},et=class extends we{constructor(e){e=e||{},super();var t=this.input=e.input;t||(t=this.input=document.createElement("INPUT"),e.type&&t.setAttribute("type",e.type),e.min!==void 0&&t.setAttribute("min",e.min),e.max!==void 0&&t.setAttribute("max",e.max),e.step!==void 0&&t.setAttribute("step",e.step),e.parent&&e.parent.appendChild(t)),e.disabled&&(t.disabled=!0),e.checked!==void 0&&(t.checked=!!e.checked),e.val!==void 0&&(t.value=e.val),e.hidden&&(t.style.display="none"),t.addEventListener("focus",(function(){this.element&&this.element.classList.add("ol-focus")}).bind(this));var i;t.addEventListener("focusout",(function(){this.element&&(i&&clearTimeout(i),i=setTimeout((function(){this.element.classList.remove("ol-focus")}).bind(this),0))}).bind(this))}_listenDrag(e,t){var i=(function(s){this.moving=!0,this.element.classList.add("ol-moving");var a=(function(l){l.type==="pointerup"&&(document.removeEventListener("pointermove",a),document.removeEventListener("pointerup",a),document.removeEventListener("pointercancel",a),setTimeout((function(){this.moving=!1,this.element.classList.remove("ol-moving")}).bind(this))),l.target===e&&t(l),l.stopPropagation(),l.preventDefault()}).bind(this);document.addEventListener("pointermove",a,!1),document.addEventListener("pointerup",a,!1),document.addEventListener("pointercancel",a,!1),s.stopPropagation(),s.preventDefault()}).bind(this);e.addEventListener("mousedown",i,!1),e.addEventListener("touchstart",i,!1)}setValue(e){e!==void 0&&(this.input.value=e),this.input.dispatchEvent(new Event("change"))}getValue(){return this.input.value}getInputElement(){return this.input}},ue=class extends et{constructor(e){e=e||{},super(e);var t=this.element=document.createElement("LABEL");e.html instanceof Element?t.appendChild(e.html):e.html!==void 0&&(t.innerHTML=e.html),t.className=("ol-ext-check ol-ext-checkbox "+(e.className||"")).trim(),this.input.parentNode&&this.input.parentNode.insertBefore(t,this.input),t.appendChild(this.input),t.appendChild(document.createElement("SPAN")),e.after&&t.appendChild(document.createTextNode(e.after)),this.input.addEventListener("change",(function(){this.dispatchEvent({type:"check",checked:this.input.checked,value:this.input.value})}).bind(this))}isChecked(){return this.input.checked}},tt=class extends ue{constructor(e){e=e||{},super(e),this.element.className=("ol-ext-toggle-switch "+(e.className||"")).trim()}},it=class extends ue{constructor(e){e=e||{},super(e),this.element.className=("ol-ext-check ol-ext-radio "+(e.className||"")).trim()}},o={};o.create=function(r,e){e=e||{};var t;if(r==="TEXT")t=document.createTextNode(e.html||""),e.parent&&e.parent.appendChild(t);else{t=document.createElement(r),/button/i.test(r)&&t.setAttribute("type","button");for(var i in e)switch(i){case"className":{e.className&&e.className.trim&&t.setAttribute("class",e.className.trim());break}case"text":{t.innerText=e.text;break}case"html":{e.html instanceof Element?t.appendChild(e.html):e.html!==void 0&&(t.innerHTML=e.html);break}case"parent":{e.parent&&e.parent.appendChild(t);break}case"options":{if(/select/i.test(r))for(var s in e.options)o.create("OPTION",{html:s,value:e.options[s],parent:t});break}case"style":{o.setStyle(t,e.style);break}case"change":case"click":{o.addListener(t,i,e[i]);break}case"on":{for(var a in e.on)o.addListener(t,a,e.on[a]);break}case"checked":{t.checked=!!e.checked;break}default:{t.setAttribute(i,e[i]);break}}}return t};o.createSwitch=function(r){var e=o.create("INPUT",{type:"checkbox",on:r.on,click:r.click,change:r.change,parent:r.parent}),t=Object.assign({input:e},r||{});return new tt(t),e};o.createCheck=function(r){var e=o.create("INPUT",{name:r.name,type:r.type==="radio"?"radio":"checkbox",on:r.on,parent:r.parent}),t=Object.assign({input:e},r||{});return r.type==="radio"?new it(t):new ue(t),e};o.setHTML=function(r,e){e instanceof Element?r.appendChild(e):e!==void 0&&(r.innerHTML=e)};o.appendText=function(r,e){r.appendChild(document.createTextNode(e||""))};o.addListener=function(r,e,t,i){typeof e=="string"&&(e=e.split(" ")),e.forEach(function(s){r.addEventListener(s,t,i)})};o.removeListener=function(r,e,t){typeof e=="string"&&(e=e.split(" ")),e.forEach(function(i){r.removeEventListener(i,t)})};o.show=function(r){r.style.display=""};o.hide=function(r){r.style.display="none"};o.hidden=function(r){return o.getStyle(r,"display")==="none"};o.toggle=function(r){r.style.display=r.style.display==="none"?"":"none"};o.setStyle=function(r,e){for(var t in e)switch(t){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":{typeof e[t]=="number"?r.style[t]=e[t]+"px":r.style[t]=e[t];break}default:r.style[t]=e[t]}};o.getStyle=function(r,e){var t,i=(r.ownerDocument||document).defaultView;if(i&&i.getComputedStyle)e=e.replace(/([A-Z])/g,"-$1").toLowerCase(),t=i.getComputedStyle(r,null).getPropertyValue(e);else if(r.currentStyle&&(e=e.replace(/-(\w)/g,function(s,a){return a.toUpperCase()}),t=r.currentStyle[e],/^\d+(em|pt|%|ex)?$/i.test(t)))return function(s){var a=r.style.left,l=r.runtimeStyle.left;return r.runtimeStyle.left=r.currentStyle.left,r.style.left=s||0,s=r.style.pixelLeft+"px",r.style.left=a,r.runtimeStyle.left=l,s}(t);return/px$/.test(t)?parseInt(t):t};o.outerHeight=function(r){return r.offsetHeight+o.getStyle(r,"marginBottom")};o.outerWidth=function(r){return r.offsetWidth+o.getStyle(r,"marginLeft")};o.offsetRect=function(r){var e=r.getBoundingClientRect();return{top:e.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:e.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:e.height||e.bottom-e.top,width:e.width||e.right-e.left}};o.getFixedOffset=function(r){var e={left:0,top:0},t=function(i){if(!i)return e;if(o.getStyle(i,"position")==="absolute"&&o.getStyle(i,"transform")!=="none"){var s=i.getBoundingClientRect();return e.left+=s.left,e.top+=s.top,e}return t(i.offsetParent)};return t(r.offsetParent)};o.positionRect=function(r,e){var t=0,i=0,s=function(a){if(a)return t+=a.offsetLeft,i+=a.offsetTop,s(a.offsetParent);var l={top:r.offsetTop+i,left:r.offsetLeft+t};return e&&(l.top-=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,l.left-=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),l.bottom=l.top+r.offsetHeight,l.right=l.top+r.offsetWidth,l};return s(r.offsetParent)};o.scrollDiv=function(r,e){e=e||{};var t=!1,i=0,s,a=0,l=typeof e.onmove=="function"?e.onmove:function(){},n=e.vertical?"screenY":"screenX",h=e.vertical?"scrollTop":"scrollLeft",c=!1,d,f,u=0,m=function(){C&&(u++,setTimeout(p))},p=function(){if(C){if(u--,u)return;var _=r.clientHeight,M=r.scrollHeight;d=_/M,C.style.height=d*100+"%",C.style.top=r.scrollTop/M*100+"%",x.style.height=_+"px",_>M-.5?x.classList.add("ol-100pc"):x.classList.remove("ol-100pc")}},g=function(_){_.target.classList.contains("ol-noscroll")||(c=!1,t=_[n],a=new Date,r.classList.add("ol-move"),_.preventDefault(),window.addEventListener("pointermove",y),o.addListener(window,["pointerup","pointercancel"],S))},y=function(_){if(t!==!1){var M=(f?-1/d:1)*(t-_[n]);c=c||Math.round(M),r[h]+=M,s=new Date,s-a&&(i=(i+M/(s-a))/2),t=_[n],a=s,M&&l(!0)}else c=!0},b=function(_){var M=_>0?Math.min(100,_/2):Math.max(-100,_/2);_-=M,r[h]+=M,-1<_&&_<1?(c?setTimeout(function(){r.classList.remove("ol-move")}):r.classList.remove("ol-move"),c=!1,l(!1)):setTimeout(function(){b(_)},40)},x,C;if(e.vertical&&e.minibar){var N=function(_){r.removeEventListener("pointermove",N),r.parentNode.classList.add("ol-miniscroll"),C=o.create("DIV"),x=o.create("DIV",{className:"ol-scroll",html:C}),r.parentNode.insertBefore(x,r),C.addEventListener("pointerdown",function(M){f=!0,g(M)}),e.mousewheel&&(o.addListener(x,["mousewheel","DOMMouseScroll","onmousewheel"],function(M){E(M)}),o.addListener(C,["mousewheel","DOMMouseScroll","onmousewheel"],function(M){E(M)})),r.parentNode.addEventListener("pointerenter",m),window.addEventListener("resize",m),_!==!1&&m()};r.parentNode?N(!1):r.addEventListener("pointermove",N),r.addEventListener("scroll",function(){m()})}r.style["touch-action"]="none",r.style.overflow="hidden",r.classList.add("ol-scrolldiv"),o.addListener(r,["pointerdown"],function(_){f=!1,g(_)}),r.addEventListener("click",function(_){r.classList.contains("ol-move")&&(_.preventDefault(),_.stopPropagation())},!0);var S=function(_){a=new Date-a,a>100||f?i=0:a>0&&(i=((i||0)+(t-_[n])/a)/2),b(e.animate===!1?0:i*200),t=!1,i=0,a=0,r.classList.contains("ol-move")?r.classList.remove("ol-hasClick"):(r.classList.add("ol-hasClick"),setTimeout(function(){r.classList.remove("ol-hasClick")},500)),f=!1,window.removeEventListener("pointermove",y),o.removeListener(window,["pointerup","pointercancel"],S)},E=function(_){var M=Math.max(-1,Math.min(1,_.wheelDelta||-_.detail));return r.classList.add("ol-move"),r[h]-=M*30,r.classList.remove("ol-move"),!1};return e.mousewheel&&o.addListener(r,["mousewheel","DOMMouseScroll","onmousewheel"],E),{refresh:m}};o.dispatchEvent=function(r,e){var t;try{t=new CustomEvent(r)}catch{t=document.createEvent("CustomEvent"),t.initCustomEvent(r,!0,!0,{})}e.dispatchEvent(t)};var st=class extends R{constructor(e){e=e||{};var t=o.create("DIV",{className:e.switcherClass||"ol-layerswitcher"});super({element:t,target:e.target});var i=this;this.dcount=0,this.show_progress=e.show_progress,this.oninfo=typeof e.oninfo=="function"?e.oninfo:null,this.onextent=typeof e.onextent=="function"?e.onextent:null,this.hasextent=e.extent||e.onextent,this.hastrash=e.trash,this.reordering=e.reordering!==!1,this._layers=[],this._layerGroup=e.layerGroup&&e.layerGroup.getLayers?e.layerGroup:null,this.onchangeCheck=typeof e.onchangeCheck=="function"?e.onchangeCheck:null,typeof e.displayInLayerSwitcher=="function"&&(this.displayInLayerSwitcher=e.displayInLayerSwitcher),e.target||(t.classList.add("ol-unselectable"),t.classList.add("ol-control"),t.classList.add(e.collapsed!==!1?"ol-collapsed":"ol-forceopen"),this.button=o.create("BUTTON",{type:"button",parent:t}),this.button.addEventListener("touchstart",function(s){t.classList.toggle("ol-forceopen"),t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:t.classList.contains("ol-collapsed")}),s.preventDefault(),i.overflow()}),this.button.addEventListener("click",function(){t.classList.toggle("ol-forceopen"),t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!t.classList.contains("ol-forceopen")}),i.overflow()}),e.mouseover&&(t.addEventListener("mouseleave",function(){t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!0})}),t.addEventListener("mouseover",function(){t.classList.remove("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!1})})),e.minibar&&(e.noScroll=!0),e.noScroll||(this.topv=o.create("DIV",{className:"ol-switchertopdiv",parent:t,click:function(){i.overflow("+50%")}}),this.botv=o.create("DIV",{className:"ol-switcherbottomdiv",parent:t,click:function(){i.overflow("-50%")}})),this._noScroll=e.noScroll),this.panel_=o.create("UL",{className:"panel"}),this.panelContainer_=o.create("DIV",{className:"panel-container",html:this.panel_,parent:t}),!e.target&&!e.noScroll&&o.addListener(this.panel_,"mousewheel DOMMouseScroll onmousewheel",function(s){i.overflow(Math.max(-1,Math.min(1,s.wheelDelta||-s.detail)))&&(s.stopPropagation(),s.preventDefault())}),this.header_=o.create("LI",{className:"ol-header",parent:this.panel_}),this.set("drawDelay",e.drawDelay||0),this.set("selection",e.selection),e.minibar&&setTimeout((function(){var s=o.scrollDiv(this.panelContainer_,{mousewheel:!0,vertical:!0,minibar:!0});this.on(["drawlist","toggle"],function(){s.refresh()})}).bind(this))}displayInLayerSwitcher(e){return e.get("displayInLayerSwitcher")!==!1}setMap(e){if(super.setMap(e),this.drawPanel(),this._listener)for(var t in this._listener)D(this._listener[t]);this._listener=null,e&&(this._listener={moveend:e.on("moveend",this.viewChange.bind(this)),size:e.on("change:size",this.overflow.bind(this))},this._layerGroup?this._listener.change=this._layerGroup.getLayers().on("change:length",this.drawPanel.bind(this)):this._listener.change=e.getLayerGroup().getLayers().on("change:length",this.drawPanel.bind(this)))}show(){this.element.classList.add("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!1})}hide(){this.element.classList.remove("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!0})}toggle(){this.element.classList.toggle("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!this.isOpen()})}isOpen(){return this.element.classList.contains("ol-forceopen")}setHeader(e){o.setHTML(this.header_,e)}overflow(e){if(this.button&&!this._noScroll){if(o.hidden(this.panel_)){o.setStyle(this.element,{height:"auto"});return}var t=o.outerHeight(this.element),i=o.outerHeight(this.panel_),s=this.button.offsetTop+o.outerHeight(this.button),a=this.panel_.offsetTop-s;if(i>t-s){o.setStyle(this.element,{height:"100%"});var l=this.panel_.querySelectorAll("li.ol-visible .li-content")[0],n=l?2*o.getStyle(l,"height"):0;switch(e){case 1:a+=n;break;case-1:a-=n;break;case"+50%":a+=Math.round(t/2);break;case"-50%":a-=Math.round(t/2);break}return a+i<=t-3*s/2?(a=t-3*s/2-i,o.hide(this.botv)):o.show(this.botv),a>=0?(a=0,o.hide(this.topv)):o.show(this.topv),o.setStyle(this.panel_,{top:a+"px"}),!0}else return o.setStyle(this.element,{height:"auto"}),o.setStyle(this.panel_,{top:0}),o.hide(this.botv),o.hide(this.topv),!1}else return!1}_setLayerForLI(e,t){var i=[];t.getLayers&&i.push(t.getLayers().on("change:length",this.drawPanel.bind(this))),e&&(i.push(t.on("change:opacity",(function(){this.setLayerOpacity(t,e)}).bind(this))),i.push(t.on("change:visible",(function(){this.setLayerVisibility(t,e)}).bind(this)))),i.push(t.on("propertychange",(function(s){(s.key==="displayInLayerSwitcher"||s.key==="openInLayerSwitcher"||s.key==="title"||s.key==="name")&&this.drawPanel(s)}).bind(this))),this._layers.push({li:e,layer:t,listeners:i})}setLayerOpacity(e,t){var i=t.querySelector(".layerswitcher-opacity-cursor");i&&(i.style.left=e.getOpacity()*100+"%"),this.dispatchEvent({type:"layer:opacity",layer:e})}setLayerVisibility(e,t){var i=t.querySelector(".ol-visibility");i&&(i.checked=e.getVisible()),e.getVisible()?t.classList.add("ol-visible"):t.classList.remove("ol-visible"),this.dispatchEvent({type:"layer:visible",layer:e})}_clearLayerForLI(){this._layers.forEach(function(e){e.listeners.forEach(function(t){D(t)})}),this._layers=[]}_getLayerForLI(e){for(var t=0,i;i=this._layers[t];t++)if(i.li===e)return i.layer;return null}viewChange(){this.panel_.querySelectorAll("li").forEach((function(e){var t=this._getLayerForLI(e);t&&(this.testLayerVisibility(t)?e.classList.remove("ol-layer-hidden"):e.classList.add("ol-layer-hidden"))}).bind(this))}getPanel(){return this.panelContainer_}drawPanel(){if(this.getMap()){var e=this;this.dcount++,setTimeout(function(){e.drawPanel_()},this.get("drawDelay")||0)}}drawPanel_(){if(!(--this.dcount||this.dragging_)){var e=this.panelContainer_.scrollTop;this._clearLayerForLI(),this.panel_.querySelectorAll("li").forEach((function(t){t.classList.contains("ol-header")||t.remove()}).bind(this)),this._layerGroup?this.drawList(this.panel_,this._layerGroup.getLayers()):this.getMap()&&this.drawList(this.panel_,this.getMap().getLayers()),this.panelContainer_.scrollTop=e}}switchLayerVisibility(e,t){e.get("baseLayer")?(e.getVisible()||e.setVisible(!0),t.forEach(function(i){e!==i&&i.get("baseLayer")&&i.getVisible()&&i.setVisible(!1)})):e.setVisible(!e.getVisible())}testLayerVisibility(e){if(!this.getMap())return!0;var t=this.getMap().getView().getResolution(),i=this.getMap().getView().getZoom();if(e.getMaxResolution()<=t||e.getMinResolution()>=t)return!1;if(e.getMinZoom&&(e.getMinZoom()>=i||e.getMaxZoom()<i))return!1;var s=e.getExtent();if(s){var a=this.getMap().getView().calculateExtent(this.getMap().getSize());return Ve(a,s)}return!0}dragOrdering_(e){e.stopPropagation(),e.preventDefault();var t=this,i=e.currentTarget.parentNode.parentNode,s=!0,a=this.panel_,l,n=e.pageY||e.touches&&e.touches.length&&e.touches[0].pageY||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageY,h,c,d,f;i.parentNode.classList.add("drag");function u(){if(h){var p=d,g=t.getSelection()===p;if(p&&h){var y;f?y=f.getLayers():y=t._layerGroup?t._layerGroup.getLayers():t.getMap().getLayers();for(var b=y.getArray(),x=0;x<b.length;x++)if(b[x]==p){y.removeAt(x);break}for(var C=0;C<b.length;C++)if(b[C]===h){x>C?y.insertAt(C,p):y.insertAt(C+1,p);break}}g&&t.selectLayer(p),t.dispatchEvent({type:"reorder-end",layer:p,group:f})}i.parentNode.querySelectorAll("li").forEach(function(N){N.classList.remove("dropover"),N.classList.remove("dropover-after"),N.classList.remove("dropover-before")}),i.classList.remove("drag"),i.parentNode.classList.remove("drag"),t.element.classList.remove("drag"),c&&c.remove(),o.removeListener(document,"mousemove touchmove",m),o.removeListener(document,"mouseup touchend touchcancel",u)}function m(p){if(l=p.pageY||p.touches&&p.touches.length&&p.touches[0].pageY||p.changedTouches&&p.changedTouches.length&&p.changedTouches[0].pageY,s&&Math.abs(n-l)>2&&(s=!1,i.classList.add("drag"),d=t._getLayerForLI(i),h=!1,f=t._getLayerForLI(i.parentNode.parentNode),c=o.create("LI",{className:"ol-dragover",html:i.innerHTML,style:{position:"absolute","z-index":1e4,left:i.offsetLeft,opacity:.5,width:o.outerWidth(i),height:o.getStyle(i,"height")},parent:a}),t.element.classList.add("drag"),t.dispatchEvent({type:"reorder-start",layer:d,group:f})),!s){p.preventDefault(),p.stopPropagation(),o.setStyle(c,{top:l-o.offsetRect(a).top+a.scrollTop+5});var g;if(!p.touches)g=p.target,p.target.shadowRoot&&(g=p.composedPath()[0]);else for(g=document.elementFromPoint(p.touches[0].clientX,p.touches[0].clientY);g.shadowRoot;)g=g.shadowRoot.elementFromPoint(p.touches[0].clientX,p.touches[0].clientY);for(g.classList.contains("ol-switcherbottomdiv")?t.overflow(-1):g.classList.contains("ol-switchertopdiv")&&t.overflow(1);g&&g.tagName!=="LI";)g=g.parentNode;(!g||!g.classList.contains("dropover"))&&i.parentNode.querySelectorAll("li").forEach(function(y){y.classList.remove("dropover"),y.classList.remove("dropover-after"),y.classList.remove("dropover-before")}),g&&g.parentNode.classList.contains("drag")&&g!==i?(h=t._getLayerForLI(g),h&&!h.get("allwaysOnTop")==!d.get("allwaysOnTop")?(g.classList.add("dropover"),g.classList.add(i.offsetTop<g.offsetTop?"dropover-after":"dropover-before")):h=!1,o.show(c)):(h=!1,g===i?o.hide(c):o.show(c)),h?c.classList.remove("forbidden"):c.classList.add("forbidden")}}o.addListener(document,"mousemove touchmove",m),o.addListener(document,"mouseup touchend touchcancel",u)}dragOpacity_(e){e.stopPropagation(),e.preventDefault();var t=this,i=e.target,s=this._getLayerForLI(i.parentNode.parentNode.parentNode);if(!s)return;var a=e.pageX||e.touches&&e.touches.length&&e.touches[0].pageX||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageX,l=o.getStyle(i,"left")-a;t.dragging_=!0;function n(){o.removeListener(document,"mouseup touchend touchcancel",n),o.removeListener(document,"mousemove touchmove",h),t.dragging_=!1}function h(c){var d=c.pageX||c.touches&&c.touches.length&&c.touches[0].pageX||c.changedTouches&&c.changedTouches.length&&c.changedTouches[0].pageX,f=(l+d)/o.getStyle(i.parentNode,"width"),u=Math.max(0,Math.min(1,f));o.setStyle(i,{left:u*100+"%"}),i.parentNode.nextElementSibling.innerHTML=Math.round(u*100),s.setOpacity(u)}o.addListener(document,"mouseup touchend touchcancel",n),o.addListener(document,"mousemove touchmove",h)}drawList(e,t){var i=this,s=t.getArray(),a=function(f){f.stopPropagation(),f.preventDefault();var u=i._getLayerForLI(this.parentNode.parentNode);i.switchLayerVisibility(u,t),i.get("selection")&&u.getVisible()&&i.selectLayer(u),i.onchangeCheck&&i.onchangeCheck(u)};function l(f){f.stopPropagation(),f.preventDefault();var u=i._getLayerForLI(this.parentNode.parentNode);i.oninfo(u),i.dispatchEvent({type:"info",layer:u})}function n(f){f.stopPropagation(),f.preventDefault();var u=i._getLayerForLI(this.parentNode.parentNode);i.onextent?i.onextent(u):i.getMap().getView().fit(u.getExtent(),i.getMap().getSize()),i.dispatchEvent({type:"extent",layer:u})}function h(f){f.stopPropagation(),f.preventDefault();var u=this.parentNode.parentNode.parentNode.parentNode,m,p=i._getLayerForLI(u);p?(m=i._getLayerForLI(this.parentNode.parentNode),p.getLayers().remove(m),p.getLayers().getLength()==0&&!p.get("noSwitcherDelete")&&h.call(u.querySelectorAll(".layerTrash")[0],f)):(u=this.parentNode.parentNode,i.getMap().removeLayer(i._getLayerForLI(u)))}function c(f){if(!this.displayInLayerSwitcher(f)){this._setLayerForLI(null,f);return}var u=o.create("LI",{className:(f.getVisible()?"ol-visible ":" ")+(f.get("baseLayer")?"baselayer":""),parent:e});this._setLayerForLI(u,f),this._selectedLayer===f&&u.classList.add("ol-layer-select");var m=o.create("DIV",{className:"ol-layerswitcher-buttons",parent:u}),p=o.create("DIV",{className:"li-content",parent:u});o.create("INPUT",{type:f.get("baseLayer")?"radio":"checkbox",className:"ol-visibility",checked:f.getVisible(),click:a,parent:p});var g=o.create("LABEL",{title:f.get("title")||f.get("name"),click:a,style:{userSelect:"none"},parent:p});if(g.addEventListener("selectstart",function(){return!1}),o.create("SPAN",{html:f.get("title")||f.get("name"),click:(function(S){this.get("selection")&&(S.stopPropagation(),this.selectLayer(f))}).bind(this),parent:g}),this.reordering&&(d<s.length-1&&(f.get("allwaysOnTop")||!s[d+1].get("allwaysOnTop"))||d>0&&(!f.get("allwaysOnTop")||s[d-1].get("allwaysOnTop")))&&o.create("DIV",{className:"layerup ol-noscroll",title:this.tip.up,on:{"mousedown touchstart":function(S){i.dragOrdering_(S)}},parent:m}),f.getLayers){var y=0;f.getLayers().forEach(function(S){i.displayInLayerSwitcher(S)&&y++}),y&&o.create("DIV",{className:f.get("openInLayerSwitcher")?"collapse-layers":"expend-layers",title:this.tip.plus,click:function(){var S=i._getLayerForLI(this.parentNode.parentNode);S.set("openInLayerSwitcher",!S.get("openInLayerSwitcher"))},parent:m})}if(this.oninfo&&o.create("DIV",{className:"layerInfo",title:this.tip.info,click:l,parent:m}),this.hastrash&&!f.get("noSwitcherDelete")&&o.create("DIV",{className:"layerTrash",title:this.tip.trash,click:h,parent:m}),this.hasextent&&s[d].getExtent()){var b=s[d].getExtent();b.length==4&&b[0]<b[2]&&b[1]<b[3]&&o.create("DIV",{className:"layerExtent",title:this.tip.extent,click:n,parent:m})}if(this.show_progress&&f instanceof me){var x=o.create("DIV",{className:"layerswitcher-progress",parent:p});this.setprogress_(f),f.layerswitcher_progress=o.create("DIV",{parent:x})}var C=o.create("DIV",{className:"layerswitcher-opacity",click:function(S){if(S.target===this){S.stopPropagation(),S.preventDefault();var E=Math.max(0,Math.min(1,S.offsetX/o.getStyle(this,"width")));i._getLayerForLI(this.parentNode.parentNode).setOpacity(E),this.parentNode.querySelectorAll(".layerswitcher-opacity-label")[0].innerHTML=Math.round(E*100)}},parent:p});if(o.create("DIV",{className:"layerswitcher-opacity-cursor ol-noscroll",style:{left:f.getOpacity()*100+"%"},on:{"mousedown touchstart":function(S){i.dragOpacity_(S)}},parent:C}),o.create("DIV",{className:"layerswitcher-opacity-label",html:Math.round(f.getOpacity()*100),parent:p}),f.getLayers&&(u.classList.add("ol-layer-group"),f.get("openInLayerSwitcher")===!0)){var N=o.create("UL",{parent:u});this.drawList(N,f.getLayers())}u.classList.add(this.getLayerClass(f)),this.dispatchEvent({type:"drawlist",layer:f,li:u})}for(var d=s.length-1;d>=0;d--)c.call(this,s[d]);this.viewChange(),e===this.panel_&&this.overflow()}getLayerClass(e){return e?e.getLayers?"ol-layer-group":e instanceof de?"ol-layer-vector":e instanceof De?"ol-layer-vectortile":e instanceof me?"ol-layer-tile":e instanceof ze?"ol-layer-image":e instanceof Re?"ol-layer-heatmap":e.getFeatures?"ol-layer-vectorimage":"unknown":"none"}selectLayer(e,t){if(!e){if(!this.getMap())return;e=this.getMap().getLayers().item(this.getMap().getLayers().getLength()-1)}this._selectedLayer=e,this.drawPanel(),t||this.dispatchEvent({type:"select",layer:e})}getSelection(){return this._selectedLayer}setprogress_(e){if(!e.layerswitcher_progress){var t=0,i=0,s=function(){i===t?(i=t=0,o.setStyle(e.layerswitcher_progress,{width:0})):o.setStyle(e.layerswitcher_progress,{width:(t/i*100).toFixed(1)+"%"})};e.getSource().on("tileloadstart",function(){i++,s()}),e.getSource().on("tileloadend",function(){t++,s()}),e.getSource().on("tileloaderror",function(){t++,s()})}}};st.prototype.tip={up:"up/down",down:"down",info:"informations...",extent:"zoom to extent",trash:"remove layer",plus:"expand/shrink"};Be.prototype.getPreview=function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAk6QAAJOkBUCTn+AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAANeSURBVHic7ZpPiE1RHMc/780MBhkik79JSUlIUbOxI+wkI2yRhYSUlJLNpJF/xcpiJBmZGBZsNM1CkmhKITGkGbH0/BuPmXnP4rxbb/TOn3fvOffeec6nfqvb/b7f93fveeec37ng8Xg8Ho/nf6Uu4d+fDswFssCvhHOJhaXAMeApMAQUyyIPPAdOAiuTStAVy4EHjDWsix5gdRLJ2mY34ulWYz6IEeA4kIk9awtkgTOEM/5vdAKT4k0/Ou3YMR/ELcbRm9AKFLBbgCJwNE4TYZkJfMG++SIwDCyLz0o4bI17WdyJz0r1TAZ+oDcxCBwAFgIzEIuhvcBbg3sLwOK4DFXLFvQGniCGSSUagS4DjUPOHESkA3XiOWCORqMR6Nfo9DjI3QqPUSd+ylBnv0Zn0GrWFvmIOvGNhjqrNDp/EAutyFgRKUM2tgO+Gur81FxvAKYZaimxXYBvmuuLDHWWaK4X0RfJCNsF6NdcbzXU2a65PohYFKWOc+jn8PUajbWIXaBKp9NB7lZYh34OzwFbFfd/NtDYYSth27urLGIm0M31AL3APWAAmIooymaDnPIl/Vz4NN1yHrd7gcvxWQnHAuA3bsyPop8hUsE13BSgK04TUViBeFo2zedJ8S6wElexW4D2eNOPTjNi6WvD/DtEr8E6tk6GGoAmxFY2iFHE9NZiQf8gogiB9gTEH23izAZuE77vHyU+ANucO1QwD3hD/MbLowAcdm20EmkwXx4n3NodS9rMB2HabYpEWs0HcRqHp0fNwAvJD+eBTZr7p6BvmQVxUaEzEbiruNfJekH15L8jtrEm7JJolEcOmKXRqQOuKDQuY7HZY8s8iNfzkSLxIuI43FTrkkLnOlBfRW4VsWk+oAX5weknxFAxJQNckGgVgZuIRVoomoGXEmGTMa+iQ6K7M4SW7k24QYgiuDQPYinbhugiF4H3RGtzZYCzyIvQXfpNI1ybLyeLpf5+iTbkRbiP2EcocTHm4+YI8iI8RFHwWjAfsA95Q+YZFU6wasl8wB7kReijtNbIILa0vcg/PRlGfPQwHmlCviDqAzaA+OREtzqr1ejOIDorxlNEjTGUBV4nnUWCvAJxGDlA8q9j3DEArAn2zvXAfOwfl6eVAmJrPpJ0Ih6Px+PxeJLjLwPul3vj5d0eAAAAAElFTkSuQmCC"};Ge.prototype.getPreview=function(r,e){r||(r=[21020,6355964]),e||(e=150);var t=this.getTileGrid().getTileCoordForCoordAndResolution(r,e),i=this.getTileUrlFunction();return i.call(this,t,this.getProjection())};Ue.prototype.getPreview=function(r,e){r||(r=[21020,6355964]),e||(e=150);var t=this.getTileUrlFunction();if(t){var i=this.getTileGrid()||this.getTileGridForProjection(this.getProjection()),s=i.getTileCoordForCoordAndResolution(r,e);return t.call(this,s,1,this.getProjection())}var a=this.getGetFeatureInfoUrl?this.getGetFeatureInfoUrl(r,e,this.getProjection()||"EPSG:3857",{}):this.getFeatureInfoUrl(r,e,this.getProjection()||"EPSG:3857",{});return a=a.replace(/getfeatureinfo/i,"GetMap"),a};He.prototype.getPreview=function(r,e,t){if(this.get("preview"))return[this.get("preview")];if(e||(e=150),e<this.getMinResolution()||e>this.getMaxResolution()){var i=this.getMinResolution(),s=this.getMaxResolution();for(s>1e5&&(s=156543),i<.15&&(i=.15),e=s;s>i;)i*=2,s/=2,e=i}var a=this.getExtent();if(r||(r=[21020,6355964]),a&&!qe(a,r)&&(r=[(a[0]+a[2])/2,(a[1]+a[3])/2]),t&&(r=q(r,t,this.getSource().getProjection())),this.getSource&&this.getSource())try{return[this.getSource().getPreview(r,e)]}catch{}return[]};We.prototype.getPreview=function(r,e){if(this.get("preview"))return[this.get("preview")];var t=[];if(this.getLayers)for(var i=this.getLayers().getArray(),s=0;s<i.length;s++)t=t.concat(i[s].getPreview(r,e));return t};var Me=class extends R{constructor(e){e=e||{},e.fullscreen&&(e.target=document.body);var t=o.create("DIV",{className:((e.className||"")+(e.zoom?" ol-zoom":"")+" ol-ext-dialog").trim()});super({element:t,target:e.target}),t.addEventListener("click",(function(a){this.get("hideOnBack")&&a.target===t&&this.close(),this.get("hideOnClick")&&this.close()}).bind(this));var i=o.create("FORM",{on:{submit:this._onButton("submit")},parent:t});o.create("H2",{parent:i}),o.create("DIV",{className:"ol-closebox",click:this._onButton("cancel"),parent:i}),o.create("DIV",{className:"ol-content",parent:i}),this._progress=o.create("DIV",{style:{display:"none"},parent:i});var s=o.create("DIV",{className:"ol-progress-bar",parent:this._progress});this._progressbar=o.create("DIV",{parent:s}),this._progressMessage=o.create("DIV",{className:"ol-progress-message",parent:this._progress}),o.create("DIV",{className:"ol-buttons",parent:i}),this.set("closeBox",e.closeBox!==!1),this.set("zoom",!!e.zoom),this.set("hideOnClick",!!e.hideOnClick),this.set("hideOnBack",!!e.hideOnBack),this.set("className",t.className),this.set("closeOnSubmit",e.closeOnSubmit),this.set("buttons",e.buttons),this.setContent(e)}show(e){e&&((e instanceof Element||typeof e=="string")&&(e={content:e}),this.setContent(e)),this.element.classList.add("ol-visible");var t=this.element.querySelector('input[type="text"],input[type="search"],input[type="number"]');if(t&&t.focus(),this.dispatchEvent({type:"show"}),e){if(e.autoclose){var i=setTimeout((function(){this.hide()}).bind(this),e.autoclose);this.once("hide",function(){clearTimeout(i)})}if(e.hideOnBack){var s=this.get("hideOnBack");this.set("hideOnBack",!0),this.once("hide",(function(){this.set("hideOnBack",s)}).bind(this))}}}open(){this.show()}setContentMessage(e){if(e!==void 0){var t=this.getContentElement();e instanceof Element&&o.setHTML(t,""),o.setHTML(t,e||"")}}setTitle(e){var t=this.element.querySelector("form");t.querySelector("h2").innerText=e||"",e?t.classList.add("ol-title"):t.classList.remove("ol-title")}setContent(e){if(e){this.element.className=this.get("className"),typeof e=="string"&&(e={content:e}),e=e||{},this.setProgress(!1),e.max&&this.setProgress(0,e.max),e.progress!==void 0&&this.setProgress(e.progress),this.get("zoom")?this.element.classList.add("ol-zoom"):this.element.classList.remove("ol-zoom"),e.className&&e.className.split(" ").forEach((function(l){this.element.classList.add(l)}).bind(this));var t=this.element.querySelector("form");e.content!==void 0&&(e.content instanceof Element&&o.setHTML(t.querySelector(".ol-content"),""),o.setHTML(t.querySelector(".ol-content"),e.content||"")),this.setTitle(e.title),e.closeBox||this.get("closeBox")&&e.closeBox!==!1?t.classList.add("ol-closebox"):t.classList.remove("ol-closebox");var i=this.element.querySelector(".ol-buttons");i.innerHTML="";var s=e.buttons||this.get("buttons");if(s){t.classList.add("ol-button");for(var a in s)o.create("INPUT",{type:a==="submit"?"submit":"button",value:s[a],click:this._onButton(a,e.onButton),parent:i})}else t.classList.remove("ol-button")}}getContentElement(){return this.element.querySelector("form .ol-content")}setProgress(e,t,i){if(e===!1){o.setStyle(this._progress,{display:"none"});return}if(t>0?this.set("max",Number(t)):t=this.get("max"),!t)o.setStyle(this._progress,{display:"none"});else{var s=Math.round(e/t*100);o.setStyle(this._progress,{display:""}),this._progressbar.className=s?"":"notransition",o.setStyle(this._progressbar,{width:s+"%"})}this._progressMessage.innerHTML="",o.setHTML(this._progressMessage,i||"")}_onButton(e,t){var i=(function(s){s.preventDefault(),(e!=="submit"||this.get("closeOnSubmit")!==!1)&&this.hide();var a=this.getInputs();this.dispatchEvent({type:"button",button:e,inputs:a}),typeof t=="function"&&t(e,a)}).bind(this);return i}getInputs(){var e={};return["input","textarea","select"].forEach((function(t){this.element.querySelectorAll("form "+t).forEach(function(i){i.className&&i.className.split(" ").forEach(function(s){e[s]=i})})}).bind(this)),e}hide(){this.element.classList.remove("ol-visible"),this.dispatchEvent({type:"hide"})}close(){this.hide()}isOpen(){return this.element.classList.contains("ol-visible")}},at=function(r){if(!r)return null;var e=r.getViewport().getElementsByClassName("ol-fixedoverlay")[0];return e||(r.getViewport().querySelector(".ol-layers")?(e=document.createElement("canvas"),e.className="ol-fixedoverlay",r.getViewport().querySelector(".ol-layers").after(e),r.on("precompose",function(t){e.width=r.getSize()[0]*t.frameState.pixelRatio,e.height=r.getSize()[1]*t.frameState.pixelRatio})):e=r.getViewport().querySelector("canvas")),e},ge=class extends R{constructor(e){e=e||{},super(e),this.setStyle(e.style)}setMap(e){this.getCanvas(e);var t=this.getMap();if(this._listener&&(D(this._listener),this._listener=null),super.setMap(e),t)try{t.renderSync()}catch{}e&&(this._listener=e.on("postcompose",this._draw.bind(this)))}getCanvas(e){return at(e)}getContext(e){var t=e.context;if(!t&&this.getMap()){var i=this.getMap().getViewport().getElementsByClassName("ol-fixedoverlay")[0];t=i?i.getContext("2d"):null}return t}setStyle(e){this._style=e||new V({})}getStyle(){return this._style}getStroke(){var e=this._style.getStroke();return e||this._style.setStroke(new z({color:"#000",width:1.25})),this._style.getStroke()}getFill(){var e=this._style.getFill();return e||this._style.setFill(new $({color:"#fff"})),this._style.getFill()}getTextStroke(){var e=this._style.getText();return e||(e=new K({})),e.getStroke()||e.setStroke(new z({color:"#fff",width:3})),e.getStroke()}getTextFill(){var e=this._style.getText();return e||(e=new K({})),e.getFill()||e.setFill(new $({color:"#fff"})),e.getFill()}getTextFont(){var e=this._style.getText();return e||(e=new K({})),e.getFont()||e.setFont("12px sans-serif"),e.getFont()}_draw(){console.warn("[CanvasBase] draw function not implemented.")}},rt=class extends ge{constructor(e){e=e||{};var t=document.createElement("div");if(super({element:t,target:e.target}),e.target)t.className=e.className||"ol-legend";else{t.className=(e.className||"ol-legend")+" ol-unselectable ol-control"+(e.collapsible===!1?" ol-uncollapsible":" ol-collapsed");var i=document.createElement("button");i.setAttribute("type","button"),i.addEventListener("click",(function(){this.toggle()}).bind(this)),t.appendChild(i),i=document.createElement("button"),i.setAttribute("type","button"),i.className="ol-closebox",i.addEventListener("click",(function(){this.toggle()}).bind(this)),t.appendChild(i)}this._legend=e.legend,this._legend.getCanvas().className="ol-legendImg",t.appendChild(this._legend.getCanvas()),t.appendChild(this._legend.getListElement()),e.collapsible!==!1&&e.collapsed===!1&&this.show(),this._legend.on("select",(function(s){this.dispatchEvent(s)}).bind(this)),this._legend.on("refresh",(function(){if(this._onCanvas&&this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this)),this._legend.on("items",(function(s){s.nb?(this.element.classList.remove("ol-empty"),this.element.title=e.title||"legend"):(this.element.classList.add("ol-empty"),this.element.title=e.emptyTitle||"no legend"),this.dispatchEvent(s)}).bind(this))}getLegend(){return this._legend}setCanvas(e){if(this._onCanvas=e,this.element.style.visibility=e?"hidden":"visible",this.getMap())try{this.getMap().renderSync()}catch{}}onCanvas(){return!!this._onCanvas}_draw(e){if(this._onCanvas&&!this.element.classList.contains("ol-collapsed")){var t=this._legend.getCanvas(),i=this.getContext(e),s=i.canvas.height-t.height;i.save(),i.rect(0,s,t.width,t.height);var a="#fff";this._legend.getTextStyle().getBackgroundFill()&&(a=se(this._legend.getTextStyle().getBackgroundFill().getColor())),i.fillStyle=i.strokeStyle=a,i.lineWidth=10,i.lineJoin="round",i.stroke(),i.clearRect(0,s,t.width,t.height),i.fill(),i.drawImage(t,0,s),i.restore()}}show(){if(this.element.classList.contains("ol-collapsed")&&(this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:!1}),this.getMap()))try{this.getMap().renderSync()}catch{}}hide(){if(!this.element.classList.contains("ol-collapsed")&&(this.element.classList.add("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:!0}),this.getMap()))try{this.getMap().renderSync()}catch{}}collapse(e){e===!1?this.show():this.hide()}isCollapsed(){return this.element.classList.contains("ol-collapsed")}toggle(){if(this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:this.element.classList.contains("ol-collapsed")}),this.getMap())try{this.getMap().renderSync()}catch{}}},Ce=class extends R{constructor(e){e=e||{};var t=o.create("DIV",{className:e.className||"ol-print"});super({element:t,target:e.target}),e.target||(t.classList.add("ol-unselectable","ol-control"),o.create("BUTTON",{type:"button",title:e.title||"Print",click:(function(){this.print()}).bind(this),parent:t})),this.set("immediate",e.immediate),this.set("imageType",e.imageType||"image/jpeg"),this.set("quality",e.quality||.8),this.set("orientation",e.orientation)}toClipboard(e,t){try{e.canvas.toBlob(function(i){try{navigator.clipboard.write([new window.ClipboardItem(Object.defineProperty({},i.type,{value:i,enumerable:!0}))]),typeof t=="function"&&t(!0)}catch{typeof t=="function"&&t(!1)}})}catch{typeof t=="function"&&t(!1)}}copyMap(e,t){this.once("print",(function(i){this.toClipboard(i,t)}).bind(this)),this.print(e)}_getCanvas(e,t,i){var s;if(e.context)i=e.context.canvas;else{if(i)s=i.getContext("2d");else{i=document.createElement("canvas");var a=this.getMap().getSize();i.width=a[0],i.height=a[1],s=i.getContext("2d"),/jp.*g$/.test(t)&&(s.fillStyle=this.get("bgColor")||"white",s.fillRect(0,0,i.width,i.height))}this.getMap().getViewport().querySelectorAll(".ol-layers canvas, canvas.ol-fixedoverlay").forEach((function(l){if(l.width){if(s.save(),l.parentNode.style.opacity==="0")return;s.globalAlpha=parseFloat(l.parentNode.style.opacity)||1,s.globalCompositeOperation=o.getStyle(l.parentNode,"mix-blend-mode"),s.filter=o.getStyle(l.parentNode,"filter");var n=o.getStyle(l,"transform")||o.getStyle(l,"-webkit-transform");/^matrix/.test(n)?(n=n.replace(/^matrix\(|\)$/g,"").split(","),n.forEach(function(h,c){n[c]=parseFloat(h)}),s.transform(n[0],n[1],n[2],n[3],n[4],n[5]),s.drawImage(l,0,0)):s.drawImage(l,0,0,o.getStyle(l,"width"),o.getStyle(l,"height")),s.restore()}}).bind(this))}return i}fastPrint(e,t){e=e||{},this._ol6?requestAnimationFrame((function(){t(this._getCanvas({},e.imageType,e.canvas))}).bind(this)):(this.getMap().once("postcompose",(function(i){i.context||(this._ol6=!0),t(this._getCanvas(i,e.imageType,e.canvas))}).bind(this)),this.getMap().render())}print(e){e=e||{};var t=e.imageType||this.get("imageType"),i=e.quality||this.get("quality");if(this.getMap()){if(e.immediate!=="silent"&&this.dispatchEvent(Object.assign({type:"printing"},e)),!e.immediate){setTimeout((function(){e=Object.assign({},e),e.immediate="silent",this.print(e)}).bind(this),200);return}this.getMap().once(this.get("immediate")?"postcompose":"rendercomplete",(function(s){var a=this._getCanvas(s,t),l=e.size||[210,297],n=e.format||"a4",h,c,d,f=e.orient||this.get("orientation"),u=typeof e.margin=="number"?e.margin:10;if(a){f!=="landscape"&&f!=="portrait"&&(f=a.width>a.height?"landscape":"portrait"),f==="landscape"&&(l=[l[1],l[0]]);var m=Math.min((l[0]-2*u)/a.width,(l[1]-2*u)/a.height);h=m*a.width,c=m*a.height,d=[(l[0]-h)/2,(l[1]-c)/2]}var p;try{p=a?a.toDataURL(t,i):null}catch{this.dispatchEvent({type:"error",canvas:a});return}var g=Object.assign({type:"print",print:{format:n,orientation:f,unit:"mm",size:l,position:d,imageWidth:h,imageHeight:c},image:p,imageType:t,quality:i,canvas:a},e);this.dispatchEvent(g)}).bind(this)),this.getMap().render()}}},nt=class extends ge{constructor(e){e=e||{};var t=o.create("DIV",{className:(e.className||"")+" ol-control-title ol-unselectable",style:{display:"block",visibility:"hidden"}});super({element:t,style:e.style}),this.setTitle(e.title||""),this.setVisible(e.visible!==!1),this.element.style.font=this.getTextFont()}setStyle(e){super.setStyle(e),this.element&&(this.element.style.font=this.getTextFont()),this.getMap()&&this.getMap().render()}setTitle(e){if(this.element.textContent=e,this.set("title",e),this.getMap())try{this.getMap().renderSync()}catch{}}getTitle(){return this.get("title")}setVisible(e){if(this.element.style.display=e?"block":"none",this.getMap())try{this.getMap().renderSync()}catch{}}getVisible(){return this.element.style.display!=="none"}_draw(e){if(this.getVisible()){var t=this.getContext(e);if(t){var i=e.frameState.pixelRatio;t.save(),t.scale(i,i);var s=this.element.getBoundingClientRect(),a=this.getMap().getViewport().getBoundingClientRect(),l=this.getMap().getSize()[0]/a.width;t.translate(Math.round((s.left-a.left)*l),Math.round((s.top-a.top)*l));var n=this.element.clientHeight,h=this.element.clientWidth,c=h/2;t.beginPath(),t.fillStyle=se(this.getFill().getColor()),t.rect(0,0,h,n),t.fill(),t.closePath(),t.beginPath(),t.fillStyle=se(this.getTextFill().getColor()),t.strokeStyle=se(this.getTextStroke().getColor()),t.lineWidth=this.getTextStroke().getWidth(),t.textAlign="center",t.textBaseline="middle",t.font=this.getTextFont(),t.lineJoin="round",t.lineWidth&&t.strokeText(this.getTitle(),c,n/2),t.fillText(this.getTitle(),c,n/2),t.closePath(),t.restore()}}}},ce=function(r,e){var t=r.getView(),i=t.getProjection(),s=t.getCenter(),a=r.getPixelFromCoordinate(s);a[1]+=1;var l=r.getCoordinateFromPixel(a),n=fe(q(s,i,"EPSG:4326"),q(l,i,"EPSG:4326"));return n*=96/.0254,n},lt=function(r,e,t){if(r&&e){var i=e;if(typeof e=="string"&&(e=e.replace(":","/").split("/"),i=e[1],i||(i=e[0]||""),i=i.replace(/[^\d]/g,""),i=parseInt(i),e[1])){var s=parseInt(e[0]);s&&(i/=s)}if(!i)return;var a=r.getView(),l=a.getProjection(),n=a.getCenter(),h=r.getPixelFromCoordinate(n);h[1]+=1;var c=r.getCoordinateFromPixel(h),d=fe(q(n,l,"EPSG:4326"),q(c,l,"EPSG:4326"));return d*=96/.0254,a.setResolution(a.getResolution()*i/d),i}},Le=class extends ge{constructor(e){e=e||{};var t=document.createElement("div");t.className="ol-control ol-compassctrl ol-unselectable ol-hidden"+(e.className?" "+e.className:""),t.style.position="absolute",t.style.visibility="hidden";var i=e.style instanceof z?new V({stroke:e.style}):e.style;e.style||(i=new V({stroke:new z({width:0})})),super({element:t,style:i}),this.set("rotateVithView",e.rotateWithView!==!1),this.setVisible(e.visible!==!1),this.setImage(e.image||e.src)}setImage(e){if(e instanceof Image)this.img_=e,this.img_.onload=(function(){if(this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this);else if(typeof e=="string")switch(e){case"compact":{this.img_=this.compactCompass_(this.element.clientWidth,this.getStroke().getColor());break}case"default":{this.img_=this.defaultCompass_(this.element.clientWidth,this.getStroke().getColor());break}default:{this.img_=new Image,this.img_.onload=(function(){if(this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this),this.img_.src=e;break}}else this.img_=this.defaultCompass_(this.element.clientWidth,this.getStroke().getColor())}compactCompass_(e,t){var i=document.createElement("canvas"),s=i.getContext("2d");e=i.width=i.height=e||150;var a=e/2;return s.translate(a,a),s.fillStyle=t||"#963",s.lineWidth=5,s.lineJoin=s.lineCap="round",s.font="bold "+a*.4+"px sans-serif",s.textBaseline="bottom",s.textAlign="center",s.strokeStyle="#fff",s.globalAlpha=.75,s.strokeText("N",0,-a/2),s.globalAlpha=1,s.fillText("N",0,-a/2),s.beginPath(),s.moveTo(0,a/4),s.lineTo(a/3,a/2),s.lineTo(0,-a/2),s.lineTo(-a/3,a/2),s.lineTo(0,a/4),s.lineWidth=12,s.fillStyle="#fff",s.globalAlpha=.75,s.fill(),s.stroke(),s.globalAlpha=1,s.fillStyle=s.strokeStyle=t||"#963",s.lineWidth=5,s.beginPath(),s.moveTo(0,a/4),s.lineTo(0,-a/2),s.lineTo(a/3,a/2),s.lineTo(0,a/4),s.fill(),s.stroke(),s.beginPath(),s.moveTo(0,a/4),s.lineTo(0,-a/2),s.lineTo(-a/3,a/2),s.lineTo(0,a/4),s.stroke(),i}defaultCompass_(e,t){var i=document.createElement("canvas"),s=i.getContext("2d");e=i.width=i.height=e||150;var a=e/2,l=.22*a;function n(c,d){s.fillStyle=t||"#963",s.beginPath(),s.moveTo(0,0),s.lineTo(c,0),s.lineTo(d,d),s.moveTo(0,0),s.lineTo(-c,0),s.lineTo(-d,-d),s.moveTo(0,0),s.lineTo(0,c),s.lineTo(-d,d),s.moveTo(0,0),s.lineTo(0,-c),s.lineTo(d,-d),s.moveTo(0,0),s.fill(),s.stroke()}function h(c,d){s.globalCompositeOperation="destination-out",s.fillStyle="#fff",s.beginPath(),s.moveTo(0,0),s.lineTo(c,0),s.lineTo(d,-d),s.moveTo(0,0),s.lineTo(-c,0),s.lineTo(-d,d),s.moveTo(0,0),s.lineTo(0,c),s.lineTo(d,d),s.moveTo(0,0),s.lineTo(0,-c),s.lineTo(-d,-d),s.moveTo(0,0),s.fill(),s.globalCompositeOperation="source-over",s.beginPath(),s.moveTo(0,0),s.lineTo(c,0),s.lineTo(d,-d),s.moveTo(0,0),s.lineTo(-c,0),s.lineTo(-d,d),s.moveTo(0,0),s.lineTo(0,c),s.lineTo(d,d),s.moveTo(0,0),s.lineTo(0,-c),s.lineTo(-d,-d),s.moveTo(0,0),s.stroke()}return s.translate(a,a),s.strokeStyle=t||"#963",s.lineWidth=1.5,s.beginPath(),s.arc(0,0,e*.41,0,2*Math.PI),s.arc(0,0,e*.44,0,2*Math.PI),s.stroke(),s.rotate(Math.PI/4),n(a*.9,l*.8),h(a*.9,l*.8),s.rotate(-Math.PI/4),n(a,l),h(a,l),i}getVisible(){return o.getStyle(this.element,"display")==="block"}setVisible(e){e?this.element.classList.add("ol-visible"):this.element.classList.remove("ol-visible"),this.getMap()&&this.getMap().render()}_draw(e){var t=this.getContext(e);if(!(!t||!this.getVisible())){var i=t.canvas,s,a=[];for(s=0;s<8;s++)a[s]=[Math.cos(Math.PI*s/8),Math.sin(Math.PI*s/8)];var l=e.frameState.pixelRatio;t.save(),t.scale(l,l);var n=this.element.clientWidth,h=this.element.clientHeight,c={left:this.element.offsetLeft,top:this.element.offsetTop},d=this.img_,f=e.frameState.viewState.rotation;if(t.beginPath(),t.translate(c.left+n/2,c.top+h/2),this.get("rotateVithView")&&t.rotate(f),this.getStroke().getWidth()){t.beginPath(),t.strokeStyle=this.getStroke().getColor(),t.lineWidth=this.getStroke().getWidth();var u=Math.max(i.width,i.height);for(s=0;s<8;s++)t.moveTo(-a[s][0]*u,-a[s][1]*u),t.lineTo(a[s][0]*u,a[s][1]*u);t.stroke()}d.width&&t.drawImage(d,-n/2,-h/2,n,h),t.closePath(),t.restore()}}},X=class extends R{constructor(e){e=e||{};var t=o.create("DIV",{className:(e.className||"ol-print")+" ol-unselectable ol-control"});super({element:t}),this._lang=e.lang||"en",e.target||o.create("BUTTON",{type:"button",title:e.title||"Print",click:(function(){this.print()}).bind(this),parent:t}),e.openWindow&&this.on("print",function(v){v.canvas&&window.open().document.write('<img src="'+v.canvas.toDataURL()+'"/>')}),e.target=o.create("DIV");var i=this._printCtrl=new Ce(e);i.on(["print","error","printing"],(function(v){this._printing(v)}).bind(this)),this._compass=new Le({src:e.northImage||"compact",visible:!1,className:"olext-print-compass",style:new z({color:"#333",width:0})});var s=this._printDialog=new Me({target:e.targetDialog||document.body,closeBox:!0,className:"ol-ext-print-dialog"}),a=s.getContentElement();this._input={};var l=o.create("DIV",{className:"ol-print-param",parent:a});this._pages=[o.create("DIV",{className:"ol-page"})];var n=o.create("DIV",{className:"ol-map",parent:this._pages[0]});o.create("DIV",{html:this._pages[0],className:"ol-print-map",parent:a}),o.create("H2",{html:this.i18n("title"),parent:l});var h=o.create("UL",{parent:l}),c=o.create("LI",{className:"ol-orientation",parent:h});this._input.orientation={list:c};var d=o.create("LABEL",{className:"portrait",parent:c});this._input.orientation.portrait=o.create("INPUT",{type:"radio",name:"ol-print-orientation",value:"portrait",checked:!0,on:{change:(function(v){this.setOrientation(v.target.value)}).bind(this)},parent:d}),o.create("SPAN",{html:this.i18n("portrait"),parent:d}),d=o.create("LABEL",{className:"landscape",parent:c}),this._input.orientation.landscape=o.create("INPUT",{type:"radio",name:"ol-print-orientation",value:"landscape",on:{change:(function(v){this.setOrientation(v.target.value)}).bind(this)},parent:d}),o.create("SPAN",{html:this.i18n("landscape"),parent:d});var f;c=o.create("LI",{html:o.create("LABEL",{html:this.i18n("size")}),className:"ol-size",parent:h});var u=this._input.size=o.create("SELECT",{on:{change:(function(){this.setSize(u.value||k)}).bind(this)},parent:c});for(f in this.paperSize)o.create("OPTION",{html:f+(this.paperSize[f]?" - "+this.paperSize[f][0]+"x"+this.paperSize[f][1]+" mm":this.i18n("custom")),value:f,parent:u});c=o.create("LI",{html:o.create("LABEL",{html:this.i18n("margin")}),className:"ol-margin",parent:h});var m=this._input.margin=o.create("SELECT",{on:{change:(function(){this.setMargin(m.value)}).bind(this)},parent:c});for(f in this.marginSize)o.create("OPTION",{html:this.i18n(f)+" - "+this.marginSize[f]+" mm",value:this.marginSize[f],parent:m});c=o.create("LI",{html:o.create("LABEL",{html:this.i18n("scale")}),className:"ol-scale",parent:h});var p=this._input.scale=o.create("SELECT",{on:{change:(function(){this.setScale(parseInt(p.value))}).bind(this)},parent:c});Object.keys(this.scales).forEach((function(v){o.create("OPTION",{html:this.scales[v],value:v,parent:p})}).bind(this)),c=o.create("LI",{className:"ol-legend",parent:h});var g=o.createSwitch({html:this.i18n("legend"),checked:!1,on:{change:(function(){w.legend.control.setCanvas(g.checked)}).bind(this)},parent:c});c=o.create("LI",{className:"ol-print-north",parent:h});var y=this._input.north=o.createSwitch({html:this.i18n("north"),checked:"checked",on:{change:(function(){y.checked?this._compass.element.classList.add("ol-print-compass"):this._compass.element.classList.remove("ol-print-compass"),this.getMap().render()}).bind(this)},parent:c});c=o.create("LI",{className:"ol-print-title",parent:h});var b=o.createSwitch({html:this.i18n("mapTitle"),checked:!1,on:{change:(function(v){w.title.control.setVisible(v.target.checked)}).bind(this)},parent:c}),x=o.create("INPUT",{type:"text",placeholder:this.i18n("mapTitle"),on:{keydown:function(v){v.keyCode===13&&v.preventDefault()},keyup:function(){w.title.control.setTitle(x.value)},change:(function(){w.title.control.setTitle(x.value)}).bind(this)},parent:c}),C=o.create("DIV",{className:"ol-user-param",parent:l});c=o.create("LI",{className:"ol-saveas",parent:h}),o.create("DIV",{html:this.i18n("copied"),className:"ol-clipboard-copy",parent:c});var N=o.create("SELECT",{on:{change:(function(){var v=N.value;if(N.value="",!(this.formats[v].clipboard&&this._copyMap(v))){var T=typeof this.getSize()=="string"?this.getSize():null,P=Object.assign({format:T,size:T?this.paperSize[T]:null,orient:this.getOrientation(),margin:this.getMargin()},this.formats[v]);i.print(P)}}).bind(this)},parent:c});o.create("OPTION",{html:this.i18n("saveas"),style:{display:"none"},value:"",parent:N}),this.formats.forEach((function(v,T){if(v.pdf){if(e.pdf===!1)return}else if(v.clipboard){if(e.copy===!1)return}else if(e.save===!1)return;o.create("OPTION",{html:this.i18n(v.title),value:T,parent:N})}).bind(this)),N.querySelectorAll("option").length===1&&(N.style.display="none"),c=o.create("LI",{className:"ol-savelegend",parent:h});var S=o.create("DIV",{html:this.i18n("copied"),className:"ol-clipboard-copy",parent:c}),E=o.create("SELECT",{on:{change:(function(){var v=w.legend.control.getLegend().getCanvas(),T=document.createElement("CANVAS");T.width=v.width,T.height=v.height;var P=T.getContext("2d");if(P.fillStyle="#fff",P.fillRect(0,0,T.width,T.height),P.drawImage(v,0,0),this.formats[E.value].clipboard)T.toBlob(function(j){try{navigator.clipboard.write([new window.ClipboardItem(Object.defineProperty({},j.type,{value:j,enumerable:!0}))]),S.classList.add("visible"),setTimeout(function(){S.classList.remove("visible")},1e3)}catch{}},"image/png");else{var I;try{I=T.toDataURL(this.formats[E.value].imageType,this.formats[E.value].quality);var A=typeof this.getSize()=="string"?this.getSize():"A4",W=T.width/96*25.4,te=T.height/96*25.4,B=this.paperSize[A];this.getOrientation()==="landscape"&&(B=[B[1],B[0]]);var le=[(B[0]-W)/2,(B[1]-te)/2];this.dispatchEvent({type:"print",print:{legend:!0,format:A,orientation:this.getOrientation(),unit:"mm",size:this.paperSize[A],position:le,imageWidth:W,imageHeight:te},image:I,imageType:this.formats[E.value].imageType,pdf:this.formats[E.value].pdf,quality:this.formats[E.value].quality,canvas:T})}catch{}}E.value=""}).bind(this)},parent:c});o.create("OPTION",{html:this.i18n("saveLegend"),style:{display:"none"},value:"",parent:E}),this.formats.forEach((function(v,T){o.create("OPTION",{html:this.i18n(v.title),value:T,parent:E})}).bind(this));var _=o.create("DIV",{className:"ol-ext-buttons",parent:l});o.create("BUTTON",{html:this.i18n("printBt"),type:"submit",click:function(v){v.preventDefault(),window.print()},parent:_}),o.create("BUTTON",{html:this.i18n("cancel"),type:"button",click:function(){s.hide()},parent:_}),o.create("DIV",{html:this.i18n("errorMsg"),className:"ol-error",parent:l});var M,k,L,w={};s.on("show",(function(){this.dispatchEvent({type:"show",userElement:C,dialog:this._printDialog,page:this.getPage()});var v=this.getMap();v&&(document.body.classList.add("ol-print-document"),M=v.getTargetElement(),k=v.getSize(),typeof this.getSize()=="string"?this.setSize(this.getSize()):this.setSize(k),v.setTarget(n),L&&D(L),L=v.on("moveend",(function(){this.setScale(ce(v))}).bind(this)),this.setScale(ce(v)),w={},this.getMap().getControls().forEach((function(T){T instanceof rt&&(w.legend={control:T}),T instanceof nt&&(w.title={control:T}),T instanceof Le&&(w.compass?T.element.classList.remove("ol-print-compass"):(this._input.north.checked?T.element.classList.add("ol-print-compass"):T.element.classList.remove("ol-print-compass"),this._compass=T,w.compass={control:T}))}).bind(this)),w.title?(b.checked=w.title.isVisible=w.title.control.getVisible(),x.value=w.title.control.getTitle(),b.parentNode.parentNode.classList.remove("hidden")):b.parentNode.parentNode.classList.add("hidden"),w.legend?(w.legend.ison=w.legend.control.onCanvas(),w.legend.collapsed=w.legend.control.isCollapsed(),w.legend.control.collapse(!1),E.parentNode.classList.remove("hidden"),g.parentNode.parentNode.classList.remove("hidden"),g.checked=!w.legend.collapsed,w.legend.control.setCanvas(!w.legend.collapsed)):(E.parentNode.classList.add("hidden"),g.parentNode.parentNode.classList.add("hidden")))}).bind(this)),s.on("hide",(function(){document.body.classList.remove("ol-print-document"),M&&(this.getMap().setTarget(M),M=null,L&&D(L),w.title&&w.title.control.setVisible(w.title.isVisible),w.legend&&(w.legend.control.setCanvas(w.legend.ison),w.legend.control.collapse(w.legend.collapsed)),this.dispatchEvent({type:"hide"}))}).bind(this)),window.addEventListener("resize",(function(){this.setSize()}).bind(this)),e.saveAs&&this.on("print",function(v){v.pdf||v.canvas.toBlob(function(T){var P=(v.print.legend?"legend.":"map.")+v.imageType.replace("image/","");e.saveAs(T,P)},v.imageType,v.quality)}),e.jsPDF&&this.on("print",function(v){if(v.pdf){var T=new e.jsPDF({orientation:v.print.orientation,unit:v.print.unit,format:v.print.size});T.addImage(v.image,"JPEG",v.print.position[0],v.print.position[0],v.print.imageWidth,v.print.imageHeight),T.save(v.print.legend?"legend.pdf":"map.pdf")}})}static addLang(e,t){X.prototype._labels[e]=t}isOpen(){return this._printDialog.isOpen()}i18n(e){var t=this._labels.en[e]||e;return this._labels[this._lang]&&this._labels[this._lang][e]&&(t=this._labels[this._lang][e]),t}getOrientation(){return this._orientation||"portrait"}setOrientation(e){this._orientation=e==="landscape"?"landscape":"portrait",this._printDialog.element.dataset.orientation=this._orientation,this._input.orientation[this._orientation].checked=!0,this.setSize()}getMargin(){return this._margin||0}setMargin(e){this._margin=e,this._input.margin.value=e,this.setSize()}getSize(){return this._size}setSize(e){if(this._printDialog.getContentElement().dataset.status="",e?this._size=e:e=this._size,!!e){if(typeof e=="string"){for(var t in this.paperSize)t&&new RegExp(t,"i").test(e)&&(e=t);this.paperSize[e]||(e=this._size="A4"),this._input.size.value=e,e=[Math.trunc(this.paperSize[e][0]*96/25.4),Math.trunc(this.paperSize[e][1]*96/25.4)],this.getOrientation()==="landscape"&&(e=[e[1],e[0]]),this.getPage().classList.remove("margin")}else this._input.size.value="",this.getPage().classList.add("margin");var i=this.getPage(),s=i.parentNode.getBoundingClientRect(),a=(s.width-40)/e[0],l=(s.height-40)/e[1],n=Math.min(a,l,1);i.style.width=e[0]+"px",i.style.height=e[1]+"px",i.style["-webkit-transform"]=i.style.transform="translate(-50%,-50%) scale("+n+")";var h=Math.round(5/n);i.style["-webkit-box-shadow"]=i.style["box-shadow"]=h+"px "+h+"px "+h+"px rgba(0,0,0,.6)",i.style.padding=this.getMargin()*96/25.4+"px",this.getMap()&&this.getMap().updateSize(),this.dispatchEvent({type:"dialog:refresh"})}}_printing(e){this._printDialog.getContentElement().dataset.status=e.type,e.clipboard||this.dispatchEvent(e)}_copyMap(e){var t=this._printDialog.element.querySelector(".ol-clipboard-copy");return this._printCtrl.copyMap(this.formats[e],function(i){i&&(t.classList.add("visible"),setTimeout(function(){t.classList.remove("visible")},1e3))}),!0}getContentElement(){return this._printDialog.getContentElement()}getUserElement(){return this._printDialog.getContentElement().querySelector(".ol-user-param")}getPage(){return this._pages[0]}setMap(e){this.getMap()&&(this.getMap().removeControl(this._compass),this.getMap().removeControl(this._printCtrl),this.getMap().removeControl(this._printDialog)),super.setMap(e),this.getMap()&&(this.getMap().addControl(this._compass),this.getMap().addControl(this._printCtrl),this.getMap().addControl(this._printDialog))}setScale(e){lt(this.getMap(),e),this._input.scale.value=" "+Math.round(e/100)*100}getScale(){return ce(this.getMap())}print(e){e=e||{},e.size&&this.setSize(e.size),e.scale&&this.setScale(e.scale),e.orientation&&this.setOrientation(e.orientation),e.margin&&this.setMargin(e.margin),this._printDialog.show()}getPrintControl(){return this._printCtrl}};X.prototype._labels={en:{title:"Print",orientation:"Orientation",portrait:"Portrait",landscape:"Landscape",size:"Page size",custom:"screen size",margin:"Margin",scale:"Scale",legend:"Legend",north:"North arrow",mapTitle:"Map title",saveas:"Save as...",saveLegend:"Save legend...",copied:"✔ Copied to clipboard",errorMsg:"Can't save map canvas...",printBt:"Print...",clipboardFormat:"copy to clipboard...",jpegFormat:"save as jpeg",pngFormat:"save as png",pdfFormat:"save as pdf",none:"none",small:"small",large:"large",cancel:"cancel"},fr:{title:"Imprimer",orientation:"Orientation",portrait:"Portrait",landscape:"Paysage",size:"Taille du papier",custom:"taille écran",margin:"Marges",scale:"Echelle",legend:"Légende",north:"Flèche du nord",mapTitle:"Titre de la carte",saveas:"Enregistrer sous...",saveLegend:"Enregistrer la légende...",copied:"✔ Carte copiée",errorMsg:"Impossible d'enregistrer la carte",printBt:"Imprimer",clipboardFormat:"copier dans le presse-papier...",jpegFormat:"enregistrer un jpeg",pngFormat:"enregistrer un png",pdfFormat:"enregistrer un pdf",none:"aucune",small:"petites",large:"larges",cancel:"annuler"},de:{title:"Drucken",orientation:"Ausrichtung",portrait:"Hochformat",landscape:"Querformat",size:"Papierformat",custom:"Bildschirmgröße",margin:"Rand",scale:"Maßstab",legend:"Legende",north:"Nordpfeil",mapTitle:"Kartentitel",saveas:"Speichern als...",saveLegend:"Legende speichern...",copied:"✔ In die Zwischenablage kopiert",errorMsg:"Kann Karte nicht speichern...",printBt:"Drucken...",clipboardFormat:"in die Zwischenablage kopieren...",jpegFormat:"speichern als jpeg",pngFormat:"speichern als png",pdfFormat:"speichern als pdf",none:"kein",small:"klein",large:"groß",cancel:"abbrechen"},zh:{title:"打印",orientation:"方向",portrait:"纵向",landscape:"横向",size:"页面大小",custom:"屏幕大小",margin:"外边距",scale:"尺度",legend:"图例",north:"指北针",mapTitle:"地图名字",saveas:"保存为...",saveLegend:"保存图例为...",copied:"✔ 已复制到剪贴板",errorMsg:"无法保存地图...",printBt:"打印...",cancel:"取消"}};X.prototype.paperSize={"":null,A0:[841,1189],A1:[594,841],A2:[420,594],A3:[297,420],A4:[210,297],"US Letter":[215.9,279.4],A5:[148,210],B4:[257,364],B5:[182,257]};X.prototype.marginSize={none:0,small:5,large:10};X.prototype.formats=[{title:"clipboardFormat",imageType:"image/png",clipboard:!0},{title:"jpegFormat",imageType:"image/jpeg",quality:.8},{title:"pngFormat",imageType:"image/png",quality:.8},{title:"pdfFormat",imageType:"image/jpeg",pdf:!0}];X.prototype.scales={" 5000":"1/5.000"," 10000":"1/10.000"," 25000":"1/25.000"," 50000":"1/50.000"," 100000":"1/100.000"," 250000":"1/250.000"," 1000000":"1/1.000.000"};var pe=function(r,e){var t=r[0]-e[0],i=r[1]-e[1];return Math.sqrt(t*t+i*i)},Z=function(r,e){return r[0]==e[0]&&r[1]==e[1]},ke;(function(){function r(t,i){var s;for(let a=t.length-1;a>0;a--)(t[a][0]>i&&t[a-1][0]<i||t[a][0]<i&&t[a-1][0]>i)&&(s=[i,(i-t[a][0])/(t[a-1][0]-t[a][0])*(t[a-1][1]-t[a][1])+t[a][1]],t.splice(a,0,s))}function e(t,i){var s;for(let a=t.length-1;a>0;a--)(t[a][1]>i&&t[a-1][1]<i||t[a][1]<i&&t[a-1][1]>i)&&(s=[(i-t[a][1])/(t[a-1][1]-t[a][1])*(t[a-1][0]-t[a][0])+t[a][0],i],t.splice(a,0,s))}ke=function(t,i){var s=i.getType()==="Polygon";if(!s&&i.getType()!=="MultiPolygon")return null;var a=i.getCoordinates();return s&&(a=[a]),a.forEach(function(l){l.forEach(function(n){r(n,t[0]),r(n,t[2]),e(n,t[1]),e(n,t[3])})}),a.forEach(function(l){l.forEach(function(n){n.forEach(function(h){h[0]<t[0]?h[0]=t[0]:h[0]>t[2]&&(h[0]=t[2]),h[1]<t[1]?h[1]=t[1]:h[1]>t[3]&&(h[1]=t[3])})})}),s?new ee(a[0]):new ae(a)}})();var ne=function(r,e,t,i){var s=[];i!==!1&&s.push(r);var a=pe(r,e);if(a){var l=Math.round(a/t);if(l>1)for(var n=(e[0]-r[0])/l,h=(e[1]-r[1])/l,c=1;c<l;c++)s.push([r[0]+n*c,r[1]+h*c])}return s.push(e),s};H.prototype.sampleAt=function(r){for(var e=this.getCoordinates(),t=[],i=1;i<e.length;i++)t=t.concat(ne(e[i-1],e[i],r,i===1));return new H(t)};ve.prototype.sampleAt=function(r){var e=this.getCoordinates(),t=[];return e.forEach(function(i){for(var s=[],a=1;a<i.length;a++)s=s.concat(ne(i[a-1],i[a],r,a===1));t.push(s)}),new ve(t)};ee.prototype.sampleAt=function(r){var e=this.getCoordinates(),t=[];return e.forEach(function(i){for(var s=[],a=1;a<i.length;a++)s=s.concat(ne(i[a-1],i[a],r,a===1));t.push(s)}),new ee(t)};ae.prototype.sampleAt=function(r){var e=this.getCoordinates(),t=[];return e.forEach(function(i){var s=[];t.push(s),i.forEach(function(a){for(var l=[],n=1;n<a.length;n++)l=l.concat(ne(a[n-1],a[n],r,n===1));s.push(l)})}),new ae(t)};je.prototype.intersection=function(r,e){if(r.sampleAt){var t=Te(this.getCenter().concat(this.getCenter()),this.getRadius());r=ke(t,r),r=r.simplify(e);var i=this.getCenter(),s=this.getRadius(),a=r.sampleAt(e).getCoordinates();switch(r.getType()){case"Polygon":a=[a];case"MultiPolygon":{var l=!1,n=[];return a.forEach(function(h){var c=[];n.push(c),h.forEach(function(d){var f=[];c.push(f),d.forEach(function(u){var m=pe(i,u);m>s?(l=!0,f.push([i[0]+s/m*(u[0]-i[0]),i[1]+s/m*(u[1]-i[1])])):f.push(u)})})}),l?r.getType()==="Polygon"?new ee(n[0]):new ae(n):r}}}else console.warn("[ol/geom/Circle~intersection] Unsupported geometry type: "+r.getType());return r};var Ne=class extends R{constructor(e){e=e||{};var t=document.createElement("div");super({element:t,target:e.target});var i=this;if(this.info=e.info||Ne.prototype.info,e.target)t.classList.add(e.className||"ol-profile");else{t.className=((e.className||"ol-profile")+" ol-unselectable ol-control ol-collapsed").trim(),this.button=document.createElement("button"),this.button.title=e.title||"Profile",this.button.setAttribute("type","button");var s=function(E){i.toggle(),E.preventDefault()};this.button.addEventListener("click",s),this.button.addEventListener("touchstart",s),t.appendChild(this.button),o.create("I",{parent:this.button})}e.style instanceof V?this._style=e.style:this._style=new V({text:new K,stroke:new z({width:1.5,color:"#369"})}),this._style.getText()||this._style.setText(new K),e.selectStyle instanceof V?this._selectStyle=e.selectStyle:this._selectStyle=new V({fill:new $({color:"#369"})});var a=document.createElement("div");a.classList.add("ol-inner"),t.appendChild(a);var l=document.createElement("div");l.style.position="relative",a.appendChild(l);var n=this.ratio=2;this.canvas_=document.createElement("canvas"),this.canvas_.width=(e.width||300)*n,this.canvas_.height=(e.height||150)*n;var h={msTransform:"scale(0.5,0.5)",msTransformOrigin:"0 0",webkitTransform:"scale(0.5,0.5)",webkitTransformOrigin:"0 0",mozTransform:"scale(0.5,0.5)",mozTransformOrigin:"0 0",transform:"scale(0.5,0.5)",transformOrigin:"0 0"};Object.keys(h).forEach(function(E){E in i.canvas_.style&&(i.canvas_.style[E]=h[E])});var c=document.createElement("div");l.appendChild(c),c.style.width=this.canvas_.width/n+"px",c.style.height=this.canvas_.height/n+"px",c.appendChild(this.canvas_),c.addEventListener("pointerdown",this.onMove.bind(this)),document.addEventListener("pointerup",this.onMove.bind(this)),c.addEventListener("mousemove",this.onMove.bind(this)),c.addEventListener("touchmove",this.onMove.bind(this)),this.set("selectable",e.selectable),this.margin_={top:10*n,left:45*n,bottom:30*n,right:10*n},this.info.ytitle||(this.margin_.left-=20*n),this.info.xtitle||(this.margin_.bottom-=20*n),this.bar_=document.createElement("div"),this.bar_.classList.add("ol-profilebar"),this.bar_.style.top=this.margin_.top/n+"px",this.bar_.style.height=(this.canvas_.height-this.margin_.top-this.margin_.bottom)/n+"px",l.appendChild(this.bar_),this.cursor_=document.createElement("div"),this.cursor_.classList.add("ol-profilecursor"),l.appendChild(this.cursor_),this.popup_=document.createElement("div"),this.popup_.classList.add("ol-profilepopup"),this.cursor_.appendChild(this.popup_);var d=document.createElement("table");d.cellPadding="0",d.cellSpacing="0",d.style.clientWidth=this.canvas_.width/n+"px",l.appendChild(d);var f=document.createElement("tr");f.classList.add("track-info"),d.appendChild(f);var u=document.createElement("td");u.innerHTML=(this.info.zmin||"Zmin")+': <span class="zmin">',f.appendChild(u);var m=document.createElement("td");m.innerHTML=(this.info.zmax||"Zmax")+': <span class="zmax">',f.appendChild(m);var p=document.createElement("td");p.innerHTML=(this.info.distance||"Distance")+': <span class="dist">',f.appendChild(p);var g=document.createElement("td");g.innerHTML=(this.info.time||"Time")+': <span class="time">',f.appendChild(g);var y=document.createElement("tr");y.classList.add("point-info"),d.appendChild(y);var b=document.createElement("td");b.innerHTML=(this.info.altitude||"Altitude")+': <span class="z">',y.appendChild(b);var x=document.createElement("td");x.innerHTML=(this.info.distance||"Distance")+': <span class="dist">',y.appendChild(x);var C=document.createElement("td");if(C.innerHTML=(this.info.time||"Time")+': <span class="time">',y.appendChild(C),this.tab_=[],e.feature&&this.setGeometry(e.feature),e.zoomable){this.set("selectable",!0);var N,S;this.on("change:geometry",function(){S=null}),this.on("dragstart",function(E){N=E.index}),this.on("dragend",(function(E){if(Math.abs(N-E.index)>10){if(!S)var _=o.create("BUTTON",{parent:t,className:"ol-zoom-out",click:(function(L){L.stopPropagation(),L.preventDefault(),S&&(this.dispatchEvent({type:"zoom"}),this.setGeometry(S,this._geometry[1])),t.removeChild(_)}).bind(this)});var M=S||this._geometry[0],k=new H(this.getSelection(N,E.index));this.setGeometry(k,this._geometry[1]),S=M,this.dispatchEvent({type:"zoom",geometry:k,start:N,end:E.index})}}).bind(this))}}popup(e){this.popup_.innerHTML=e}_drawAt(e,t){e?(this.cursor_.style.left=t+"px",this.cursor_.style.top=(this.canvas_.height-this.margin_.bottom+e[1]*this.scale_[1]+this.dy_)/this.ratio+"px",this.cursor_.style.display="block",this.bar_.parentElement.classList.add("over"),this.bar_.style.left=t+"px",this.bar_.style.display="block",this.element.querySelector(".point-info .z").textContent=e[1]+this.info.altitudeUnits,this.element.querySelector(".point-info .dist").textContent=(e[0]/1e3).toFixed(1)+this.info.distanceUnitsKM,this.element.querySelector(".point-info .time").textContent=e[2],t>this.canvas_.width/this.ratio/2?this.popup_.classList.add("ol-left"):this.popup_.classList.remove("ol-left")):(this.cursor_.style.display="none",this.bar_.style.display="none",this.cursor_.style.display="none",this.bar_.parentElement.classList.remove("over"))}showAt(e){var t,i,s,a=1/0;if(typeof e>"u")this.bar_.parentElement.classList.contains("over")&&this._drawAt();else if(e.length)for(t=1;i=this.tab_[t];t++){var l=pe(i[3],e);l<a&&(s=i,a=l)}else for(t=0;(i=this.tab_[t])&&(s=i,!(i[0]>=e));t++);if(s){var n=(s[0]*this.scale_[0]+this.margin_.left)/this.ratio;return this._drawAt(s,n),s[3]}return null}showAtTime(e,t){var i,s,a;if(e instanceof Date?e=e.getTime()/1e3:t&&(e+=this.tab_[0][3][3]),typeof e>"u")this.bar_.parentElement.classList.contains("over")&&this._drawAt();else for(i=0;(s=this.tab_[i])&&(a=s,!(s[3][3]>=e));i++);if(a){var l=(a[0]*this.scale_[0]+this.margin_.left)/this.ratio;return this._drawAt(a,l),a[3]}return null}pointAtTime(e){var t,i;for(t=1;i=this.tab_[t];t++){var s=i[3][3];if(s>=e){var a=this.tab_[t-1][3];return(a[3]+s)/2<e?a:i}}return this.tab_[this.tab_.length-1][3]}onMove(e){if(this.tab_.length){var t=this.canvas_.getBoundingClientRect(),i={top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft},s=e.pageX||e.touches&&e.touches.length&&e.touches[0].pageX||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageX,a=e.pageY||e.touches&&e.touches.length&&e.touches[0].pageY||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageY,l=s-i.left,n=a-i.top,h=this.ratio;if(l>this.margin_.left/h-20&&l<(this.canvas_.width-this.margin_.right)/h+8&&n>this.margin_.top/h&&n<(this.canvas_.height-this.margin_.bottom)/h){var c=(l*h-this.margin_.left)/this.scale_[0],d=this.tab_[0],f,u;for(f=1;u=this.tab_[f];f++)if(u[0]>=c){c<(u[0]+d[0])/2&&(f=0,u=d);break}switch(u||(u=this.tab_[this.tab_.length-1]),l=Math.max(this.margin_.left/h,Math.min(l,(this.canvas_.width-this.margin_.right)/h)),this._drawAt(u,l),this.dispatchEvent({type:"over",click:e.type==="click",index:f,coord:u[3],time:u[2],distance:u[0]}),e.type){case"pointerdown":{this._dragging={event:{type:"dragstart",index:f,coord:u[3],time:u[2],distance:u[0]},pageX:s,pageY:a};break}case"pointerup":{this._dragging&&this._dragging.pageX?Math.abs(this._dragging.pageX-s)<3&&Math.abs(this._dragging.pageY-a)<3&&(this.dispatchEvent({type:"click",index:f,coord:u[3],time:u[2],distance:u[0]}),this.refresh()):this.dispatchEvent({type:"dragend",index:f,coord:u[3],time:u[2],distance:u[0]}),this._dragging=!1;break}default:{if(this._dragging)if(this._dragging.pageX)(Math.abs(this._dragging.pageX-s)>3||Math.abs(this._dragging.pageY-a)>3)&&(this._dragging.pageX=this._dragging.pageY=!1,this.dispatchEvent(this._dragging.event));else{this.dispatchEvent({type:"dragging",index:f,coord:u[3],time:u[2],distance:u[0]});var m=Math.min(this._dragging.event.index,f),p=Math.max(this._dragging.event.index,f);this.refresh(),this.get("selectable")&&this._drawGraph(this.tab_.slice(m,p),this._selectStyle)}break}}}else this.bar_.parentElement.classList.contains("over")&&(this._drawAt(),this.dispatchEvent({type:"out"})),e.type==="pointerup"&&this._dragging&&(this.dispatchEvent({type:"dragcancel"}),this._dragging=!1)}}show(){this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"show",show:!0})}hide(){this.element.classList.add("ol-collapsed"),this.dispatchEvent({type:"show",show:!1})}toggle(){this.element.classList.toggle("ol-collapsed");var e=this.element.classList.contains("ol-collapsed");this.dispatchEvent({type:"show",show:!e})}isShown(){return!this.element.classList.contains("ol-collapsed")}getSelection(e,t){for(var i=[],s=Math.max(Math.min(e,t),0),a=Math.min(Math.max(e,t),this.tab_.length-1),l=s;l<=a;l++)i.push(this.tab_[l][3]);return i}_drawGraph(e,t){if(e.length){var i=this.canvas_.getContext("2d"),s=this.scale_[0],a=this.scale_[1],l=this.dy_,n=this.ratio,h,c;for(i.beginPath(),h=0;c=e[h];h++)h==0?i.moveTo(c[0]*s,c[1]*a+l):i.lineTo(c[0]*s,c[1]*a+l);t.getStroke()&&(i.strokeStyle=t.getStroke().getColor()||"#000",i.lineWidth=t.getStroke().getWidth()*n,i.setLineDash([]),i.stroke()),t.getFill()&&(i.fillStyle=t.getFill().getColor()||"#000",i.Style=t.getFill().getColor()||"#000",i.lineTo(e[e.length-1][0]*s,0),i.lineTo(e[0][0]*s,0),i.fill())}}setGeometry(e,t){if(t||(t={}),e instanceof U&&(e=e.getGeometry()),this._geometry=[e,t],!/Z/.test(e.getLayout()))return;/M/.test(e.getLayout())?this.element.querySelector(".time").parentElement.style.display="block":this.element.querySelector(".time").parentElement.style.display="none";var i=e.getCoordinates();switch(e.getType()){case"LineString":break;case"MultiLineString":i=i[0];break;default:return}var s=t.projection||this.getMap().getView().getProjection();function a(g,y){return fe(q(g,s,"EPSG:4326"),q(y,s,"EPSG:4326"))}function l(g,y){if(!g||!y)return"-";var b=(y-g)/60,x=Math.trunc(b/60),C=Math.trunc(b-x*60);return x+"h"+(C<10?"0":"")+C+"mn"}var n=1/0,h=-1/0,c,d,f,u,m,p=this.tab_=[];for(c=0,d;d=i[c];c++)u=d[2],u<n&&(n=u),u>h&&(h=u),c==0?f=0:f+=a(i[c-1],d),m=l(i[0][3],d[3]),p.push([f,u,m,d]);this._z=[n,h],this.set("graduation",t.graduation||100),this.set("zmin",t.zmin),this.set("zmax",t.zmax),this.set("amplitude",t.amplitude),this.set("unit",t.unit),this.set("zunit",t.zunit),this.set("zDigits",t.zDigits),this.set("zMaxChars",t.zMaxChars),this.dispatchEvent({type:"change:geometry",geometry:e}),this.refresh()}refresh(){var e=this.canvas_,t=e.getContext("2d"),i=e.width,s=e.height;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,i,s);var a=this._z[0],l=this._z[1],n=this.tab_,h=n[n.length-1][0],c=n[n.length-1][2],d;if(!h){console.error("[ol/control/Profile] no data...",n);return}t.setTransform(1,0,0,1,this.margin_.left,s-this.margin_.bottom);var f=this.ratio;i-=this.margin_.right+this.margin_.left,s-=this.margin_.top+this.margin_.bottom,t.strokeStyle=this._style.getText().getFill().getColor()||"#000",t.lineWidth=.5*f,t.beginPath(),t.moveTo(0,0),t.lineTo(0,-s),t.moveTo(0,0),t.lineTo(i,0),t.stroke(),this.element.querySelector(".track-info .zmin").textContent=a.toFixed(2)+this.info.altitudeUnits,this.element.querySelector(".track-info .zmax").textContent=l.toFixed(2)+this.info.altitudeUnits,h>1e3?this.element.querySelector(".track-info .dist").textContent=(h/1e3).toFixed(1)+this.info.distanceUnitsKM:this.element.querySelector(".track-info .dist").textContent=h.toFixed(1)+this.info.distanceUnitsM,this.element.querySelector(".track-info .time").textContent=c;for(var u=this.get("graduation");;){l=Math.ceil(l/u)*u,a=Math.floor(a/u)*u;var m=(l-a)/u;if(s/m<15*f)u*=2;else break}typeof this.get("zmin")=="number"&&a>this.get("zmin")&&(a=this.get("zmin")),typeof this.get("zmax")=="number"&&l<this.get("zmax")&&(l=this.get("zmax"));var p=this.get("amplitude");p&&(l=Math.max(a+p,l));var g=i/h,y=-s/(l-a),b=this.dy_=-a*y;this.scale_=[g,y],this._drawGraph(n,this._style),t.textAlign="right",t.textBaseline="top",t.fillStyle=this._style.getText().getFill().getColor()||"#000",t.beginPath();var x=this.get("zDigits")||0,C=null;if(typeof this.get("zMaxChars")=="number"){var N;if(this.get("zunit")!="km"?N=Math.max(a.toFixed(x).length,l.toFixed(x).length):N=Math.max((a/1e3).toFixed(1).length,(l/1e3).toFixed(1).length),this.get("zMaxChars")<N){C=Math.floor(Math.log10(Math.max(Math.abs(a),Math.abs(l),Number.MIN_VALUE))),t.font="bold "+9*f+"px arial",t.fillText(C.toString(),-8*f,8*f);var S=t.measureText(C.toString()),E=S.width,_=S.actualBoundingBoxAscent+S.actualBoundingBoxDescent;t.font="bold "+12*f+"px arial",t.fillText("10",-8*f-E,8*f+.5*_)}}for(t.font=10*f+"px arial",t.textBaseline="middle",d=a;d<=l;d+=u){if(C!==null){var M=d/Math.pow(10,C);this.get("zunit")=="km"&&(M/=1e3);var k=this.get("zMaxChars")-Math.floor(Math.log10(Math.max(Math.abs(M),1))+1)-1;M<0&&(k-=1),this.get("zunit")!="km",t.fillText(M.toFixed(Math.max(k,0)),-4*f,d*y+b)}else this.get("zunit")!="km"?t.fillText(d.toFixed(x),-4*f,d*y+b):t.fillText((d/1e3).toFixed(1),-4*f,d*y+b);t.moveTo(-2*f,d*y+b),d!=0?t.lineTo(h*g,d*y+b):t.lineTo(0,d*y+b)}t.textAlign="center",t.textBaseline="top",t.setLineDash([f,3*f]);var L=this.get("unit")||"km",w;for(h>1e3?(w=Math.round(h/1e3)*100,w>1e3&&(w=Math.ceil(w/1e3)*1e3)):(L="m",h>100?w=Math.round(h/100)*10:h>10?w=Math.round(h/10):h>1?w=Math.round(h)/10:w=h),d=0;d<=h;d+=w){var v=L=="m"?d:d/1e3;t.fillText(Math.round(v*10)/10,d*g,4*f),t.moveTo(d*g,2*f),t.lineTo(d*g,0)}t.font=12*f+"px arial",t.fillText(this.info.xtitle.replace("(km)","("+L+")"),i/2,18*f),t.save(),t.rotate(-Math.PI/2),t.fillText(this.info.ytitle,s/2,-this.margin_.left),t.restore(),t.stroke()}getImage(e,t){return e==="canvas"?this.canvas_:this.canvas_.toDataURL(e,t)}};Ne.prototype.info={zmin:"Zmin",zmax:"Zmax",ytitle:"Altitude (m)",xtitle:"Distance (km)",time:"Time",altitude:"Altitude",distance:"Distance",altitudeUnits:"m",distanceUnitsM:"m",distanceUnitsKM:"km"};var ot=class extends R{constructor(e){e=e||{};var t=(e.className||"")+" ol-search"+(e.target?"":" ol-unselectable ol-control"),i=o.create("DIV",{className:t});super({element:i,target:e.target});var s=this;if(e.typing==null&&(e.typing=300),this._classname=e.className||"search",e.collapsed!==!1&&i.classList.add("ol-collapsed"),e.target||(this.button=document.createElement("BUTTON"),this.button.setAttribute("type","button"),this.button.setAttribute("title",e.title||e.label||"Search"),this.button.addEventListener("click",function(){if(i.classList.toggle("ol-collapsed"),!i.classList.contains("ol-collapsed")){i.querySelector("input.search").focus();for(var u=i.querySelectorAll("li"),m=0;m<u.length;m++)u[m].classList.remove("select");h.value||s.drawList_()}}),i.appendChild(this.button)),e.inputLabel){var a=document.createElement("LABEL");a.innerText=e.inputLabel,i.appendChild(a)}var l,n="",h=this._input=document.createElement("INPUT");h.setAttribute("type","search"),h.setAttribute("class","search"),h.setAttribute("autocomplete","off"),h.setAttribute("placeholder",e.placeholder||"Search..."),h.addEventListener("change",function(u){s.dispatchEvent({type:"change:input",input:u,value:h.value})});var c=function(u){var m=i.querySelector("ul.autocomplete li.select"),p=h.value;if(u.key=="ArrowDown"||u.key=="ArrowUp"||u.key=="Down"||u.key=="Up")m?(m.classList.remove("select"),m=/Down/.test(u.key)?m.nextElementSibling:m.previousElementSibling,m&&m.classList.add("select")):i.querySelector("ul.autocomplete li").classList.add("select");else if(u.type=="input"&&!p)setTimeout(function(){s.drawList_()},200);else if(m&&(u.type=="search"||u.key=="Enter"))i.classList.contains("ol-control")&&h.blur(),m.classList.remove("select"),n=p,s._handleSelect(s._list[m.getAttribute("data-search")]);else if(u.type=="search"||u.key=="Enter"||n!=p&&e.typing>=0)if(n=p,n){l&&clearTimeout(l);var g=s.get("minLength");l=setTimeout(function(){if(n.length>=g){var y=s.autocomplete(n,function(b){s.drawList_(b)});y&&s.drawList_(y)}else s.drawList_()},e.typing)}else s.drawList_();else m=i.querySelector("ul.autocomplete li"),m&&m.classList.remove("select")};if(h.addEventListener("keyup",c),h.addEventListener("search",c),h.addEventListener("cut",c),h.addEventListener("paste",c),h.addEventListener("input",c),e.noCollapse||(h.addEventListener("blur",(function(){setTimeout((function(){h!==document.activeElement&&(i.classList.add("ol-collapsed"),this.set("reverse",!1),i.classList.remove("ol-revers"))}).bind(this),200)}).bind(this)),h.addEventListener("focus",(function(){this.get("reverse")||(i.classList.remove("ol-collapsed"),i.classList.remove("ol-revers"))}).bind(this))),i.appendChild(h),e.reverse){var d=o.create("BUTTON",{type:"button",class:"ol-revers",title:e.reverseTitle||"click on the map",click:(function(){this.get("reverse")?this.set("reverse",!1):(this.set("reverse",!this.get("reverse")),h.focus(),i.classList.add("ol-revers"))}).bind(this)});i.appendChild(d)}var f=document.createElement("UL");f.classList.add("autocomplete"),i.appendChild(f),typeof e.getTitle=="function"&&(this.getTitle=e.getTitle),typeof e.autocomplete=="function"&&(this.autocomplete=e.autocomplete),this.set("copy",e.copy),this.set("minLength",e.minLength||1),this.set("maxItems",e.maxItems||10),this.set("maxHistory",e.maxHistory||e.maxItems||10),e.onselect&&this.on("select",e.onselect),e.centerOnSelect&&this.on("select",(function(u){var m=this.getMap();m&&m.getView().setCenter(u.coordinate)}).bind(this)),e.zoomOnSelect&&this.on("select",(function(u){var m=this.getMap();m&&(m.getView().setCenter(u.coordinate),m.getView().getZoom()<e.zoomOnSelect&&m.getView().setZoom(e.zoomOnSelect))}).bind(this)),this.restoreHistory(),this.drawList_()}setMap(e){this._listener&&D(this._listener),this._listener=null,super.setMap(e),e&&(this._listener=e.on("click",this._handleClick.bind(this)))}collapse(e){e===!1?this.element.classList.remove("ol-collapsed"):this.element.classList.add("ol-collapsed")}getInputField(){return this._input}getTitle(e){return e.name||"No title"}_getTitleTxt(e){return o.create("DIV",{html:this.getTitle(e)}).innerText}search(){var e=this.element.querySelector("input.search");this._triggerCustomEvent("search",e)}_handleClick(e){this.get("reverse")&&(document.activeElement.blur(),this.reverseGeocode(e.coordinate))}reverseGeocode(){}_triggerCustomEvent(e,t){o.dispatchEvent(e,t)}setInput(e,t){var i=this.element.querySelector("input.search");i.value=e,t&&this._triggerCustomEvent("keyup",i)}select(e,t,i,s){var a={type:"select",search:e,reverse:!!t,coordinate:i};if(s)for(var l in s)a[l]=s[l];this.dispatchEvent(a)}_handleSelect(e,t,i){if(e){var s=this.get("history"),a;try{var l=JSON.stringify(e);for(a=s.length-1;a>=0;a--)(!s[a]||JSON.stringify(s[a])===l)&&s.splice(a,1)}catch{for(a=s.length-1;a>=0;a--)s[a]===e&&s.splice(a,1)}s.unshift(e);for(var n=Math.max(0,this.get("maxHistory")||10)||0;s.length>n;)s.pop();this.saveHistory(),this.select(e,t,null,i),t&&(this.setInput(this._getTitleTxt(e)),this.drawList_(),setTimeout((function(){this.collapse(!1)}).bind(this),300))}}saveHistory(){try{this.get("maxHistory")>=0?localStorage["ol@search-"+this._classname]=JSON.stringify(this.get("history")):localStorage.removeItem("ol@search-"+this._classname)}catch{console.warn("Failed to access localStorage...")}}restoreHistory(){if(this._history[this._classname])this.set("history",this._history[this._classname]);else try{this._history[this._classname]=JSON.parse(localStorage["ol@search-"+this._classname]),this.set("history",this._history[this._classname])}catch{this.set("history",[])}}clearHistory(){this.set("history",[]),this.saveHistory(),this.drawList_()}getHistory(){return this.get("history")}autocomplete(e,t){return t([]),!1}drawList_(e){var t=this,i=this.element.querySelector("ul.autocomplete");if(i.innerHTML="",this._list=[],e)i.setAttribute("class","autocomplete");else{var s=this.element.querySelector("input.search"),a=s.value;if(!a)e=this.get("history");else return;i.setAttribute("class","autocomplete history")}for(var l,n=Math.min(t.get("maxItems"),e.length),h=0;h<n;h++)if(e[h]&&(!h||!t.equalFeatures(e[h],e[h-1]))){l=document.createElement("LI"),l.setAttribute("data-search",this._list.length),this._list.push(e[h]),l.addEventListener("click",function(d){t._handleSelect(t._list[d.currentTarget.getAttribute("data-search")])});var c=t.getTitle(e[h]);c instanceof Element?l.appendChild(c):l.innerHTML=c,i.appendChild(l)}n&&this.get("copy")&&(l=document.createElement("LI"),l.classList.add("copy"),l.innerHTML=this.get("copy"),i.appendChild(l))}equalFeatures(){return!1}};ot.prototype._history={};var J=class extends R{constructor(e){e=e||{};var t=o.create("DIV",{className:(e.className||"ol-videorec")+" ol-unselectable ol-control"});super({element:t,target:e.target}),o.create("BUTTON",{type:"button",className:"ol-start",title:J.prototype.tips.start,click:(function(){this.start()}).bind(this),parent:t}),o.create("BUTTON",{type:"button",className:"ol-stop",title:J.prototype.tips.stop,click:(function(){this.stop()}).bind(this),parent:t}),o.create("BUTTON",{type:"button",className:"ol-pause",title:J.prototype.tips.pause,click:(function(){this.pause()}).bind(this),parent:t}),o.create("BUTTON",{type:"button",className:"ol-resume",title:J.prototype.tips.resume,click:(function(){this.resume()}).bind(this),parent:t}),this.set("framerate",30),this.set("videoBitsPerSecond",5e6),e.videoTarget==="DIALOG"?(this._dialog=new Me({className:"ol-fullscreen-dialog",target:document.body,closeBox:!0}),this._videoTarget=this._dialog.getContentElement()):this._videoTarget=e.videoTarget,this._printCtrl=new Ce({target:o.create("DIV")})}setTooltip(e,t){var i=this.element.querySelector("button.ol-"+e);i&&(i.title=t)}setMap(e){this.getMap()&&(this.getMap().removeControl(this._printCtrl),this._dialog&&this.getMap().removeControl(this._dialog)),super.setMap(e),this.getMap()&&(this.getMap().addControl(this._printCtrl),this._dialog&&this.getMap().addControl(this._dialog))}start(){var e=this._printCtrl,t=!1;function i(s){t||e.fastPrint({canvas:s},i)}e.fastPrint({},(function(s){var a;try{a=s.captureStream(this.get("framerate")||30)}catch(n){this.dispatchEvent({type:"error",error:n});return}this._mediaRecorder=new MediaRecorder(a,{videoBitsPerSecond:this.get("videoBitsPerSecond")||5e6});var l=[];this._mediaRecorder.ondataavailable=function(n){l.push(n.data)},this._mediaRecorder.onstop=(function(){t=!0;var n=new Blob(l,{type:"video/mp4"});if(l=[],this._videoTarget instanceof Element){var h;this._videoTarget.tagName==="VIDEO"?h=this._videoTarget:(h=this._videoTarget.querySelector("video"),h||(h=o.create("VIDEO",{controls:"",parent:this._videoTarget}))),this._dialog&&this._dialog.show(),h.src=URL.createObjectURL(n),this.dispatchEvent({type:"stop",videoURL:h.src})}else this.dispatchEvent({type:"stop",videoURL:URL.createObjectURL(n)})}).bind(this),this._mediaRecorder.onpause=(function(){t=!0,this.dispatchEvent({type:"pause"})}).bind(this),this._mediaRecorder.onresume=(function(){t=!1,i(s),this.dispatchEvent({type:"resume"})}).bind(this),this._mediaRecorder.onerror=(function(n){this.dispatchEvent({type:"error",error:n})}).bind(this),t=!1,i(s),this._mediaRecorder.start(),this.dispatchEvent({type:"start",canvas:s}),this.element.setAttribute("data-state","rec")}).bind(this))}stop(){this._mediaRecorder&&(this._mediaRecorder.stop(),this._mediaRecorder=null,this.element.setAttribute("data-state","inactive"))}pause(){this._mediaRecorder&&(this._mediaRecorder.pause(),this.element.setAttribute("data-state","pause"))}resume(){this._mediaRecorder&&(this._mediaRecorder.resume(),this.element.setAttribute("data-state","rec"))}};J.prototype.tips={start:"start video",stop:"stop",pause:"pause",resume:"resume"};var Y=class extends R{constructor(e){e=e||{};var t=t=o.create("DIV",{className:e.className||"ol-mapzone"});if(super({element:t,target:e.target}),!e.target){["ol-unselectable","ol-control","ol-collapsed"].forEach(function(a){t.classList.add(a)});var i=o.create("BUTTON",{type:"button",on:{click:(function(){t.classList.toggle("ol-collapsed"),s.forEach(function(a){a.updateSize()})}).bind(this)},parent:t});o.create("I",{parent:i})}this.set("centerOnClick",e.centerOnClick);var s=this._maps=[];this._projection=e.projection,this._layer=e.layer,e.zones.forEach(this.addZone.bind(this)),setTimeout(function(){s.forEach(function(a){a.updateSize()})})}setCollapsed(e){e?(this.element.classList.remove("ol-collapsed"),this.getMaps().forEach(function(t){t.updateSize()})):this.element.classList.add("ol-collapsed")}setVisible(e){this.setCollapsed(!e)}getCollapsed(){return this.element.classList.contains("ol-collapsed")}getMaps(){return this._maps}getLength(){return this._maps.length}addZone(e){var t=new Ye({zoom:6,center:[0,0],projection:this._projection}),i;e.map?i=ye(e.map.getView().calculateExtent(),e.map.getView().getProjection(),t.getProjection()):i=ye(e.extent,"EPSG:4326",t.getProjection());var s=o.create("DIV",{className:"ol-mapzonezone",parent:this.element,click:(function(){var n=-1;this._maps.forEach(function(h,c){h.get("zone")===e&&(n=c)}),this.dispatchEvent({type:"select",zone:e,index:n,coordinate:re(i),extent:i}),this.get("centerOnClick")!==!1&&this.getMap().getView().fit(i),this.setVisible(!1)}).bind(this)}),a;e.layer?a=e.layer:typeof this._layer=="function"?a=this._layer(e):a=new this._layer.constructor({source:this._layer.getSource()});var l=new Se({target:s,view:t,controls:[],interactions:[],layers:[a]});l.set("zone",e),this._maps.push(l),t.fit(i),o.create("P",{html:e.title,parent:s})}removeZone(e){var t=this.element.querySelectorAll(".ol-mapzonezone")[e];t&&(t.remove(),this._maps.splice(e,1))}};Y.zones={};Y.zones.DOM=[{title:"Guadeloupe",extent:[-61.898594315312444,15.75623038647845,-60.957887532935324,16.575317670979473]},{title:"Guyane",extent:[-54.72525931072715,2.1603763430019,-51.528236062921344,5.7984307809552575]},{title:"Martinique",extent:[-61.257556528564756,14.387506317407514,-60.76934912110432,14.895067461729951]},{title:"Mayotte",extent:[44.959844536967815,-13.01674138212816,45.35328866510648,-12.65521942207829]},{title:"La réunion",extent:[55.17059012967656,-21.407680069231688,55.88195702001797,-20.85560221637526]}];Y.zones.TOM=[{title:"Polynésie Française",extent:[206.23664226630862,-22.189040615809787,221.85920743981987,-10.835039595040698]},{title:"Nouvelle Calédonie",extent:[163.76420580160925,-22.581641092751838,167.66984709498706,-19.816411635668445]},{title:"St-Pierre et Miquelon",extent:[-56.453698765748676,46.74449858188555,-56.0980198121544,47.14669874229787]},{title:"Wallis et Futuna",extent:[181.7588623143665,-14.7341169873267,183.95612353301715,-13.134720799175085]},{title:"St-Martin St-Barthélemy",extent:[-63.1726389501678,17.806097291313506,-62.7606535945649,18.13267688837938]}];Y.zones.DOMTOM=[{title:"Métropole",extent:[-5.318421740712579,41.16082274292913,9.73284186155716,51.21957336557702]}].concat(Y.zones.DOM,Y.zones.TOM);H.prototype.splitAt=function(r,e){var t;if(!r)return[this];if(e||(e=1e-10),r.length&&r[0].length){var i=[this];for(t=0;t<r.length;t++){for(var s=[],a=0;a<i.length;a++){var l=i[a].splitAt(r[t],e);s=s.concat(l)}i=s}return i}if(Z(r,this.getFirstCoordinate())||Z(r,this.getLastCoordinate()))return[this];var n=this.getCoordinates(),h=[n[0]],c=[];for(t=0;t<n.length-1;t++)if(!Z(n[t],n[t+1])){if(Z(r,n[t+1]))h.push(n[t+1]),c.push(new H(h)),h=[];else if(!Z(r,n[t])){var d,f,u=!1;n[t][0]==n[t+1][0]?(d=(n[t][1]-r[1])/(n[t][1]-n[t+1][1]),u=n[t][0]==r[0]&&0<d&&d<=1):n[t][1]==n[t+1][1]?(d=(n[t][0]-r[0])/(n[t][0]-n[t+1][0]),u=n[t][1]==r[1]&&0<d&&d<=1):(d=(n[t][0]-r[0])/(n[t][0]-n[t+1][0]),f=(n[t][1]-r[1])/(n[t][1]-n[t+1][1]),u=Math.abs(d-f)<=e&&0<d&&d<=1),u&&(h.push(r),c.push(new H(h)),h=[r])}h.push(n[t+1])}return h.length>1&&c.push(new H(h)),c.length?c:[this]};var ht=class extends Xe{constructor(e){e=e||{},super({handleDownEvent:function(i){return t.handleDownEvent_(i)},handleDragEvent:function(i){return this.handleDragEvent_(i)},handleMoveEvent:function(i){return this.handleMoveEvent_(i)},handleUpEvent:function(i){return this.handleUpEvent_(i)}});var t=this;this.selection_=new _e,this.handles_=new _e,this.overlayLayer_=new de({source:new Ee({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(i){return t.style[(i.get("handle")||"default")+(i.get("constraint")||"")+(i.get("option")||"")]},updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=e.features,typeof e.filter=="function"&&(this._filter=e.filter),this.layers_=e.layers?e.layers instanceof Array?e.layers:[e.layers]:null,this._handleEvent=e.condition||function(){return!0},this.addFn_=e.addCondition||function(){return!1},this.setPointRadius(e.pointRadius),this.set("translateFeature",e.translateFeature!==!1),this.set("translate",e.translate!==!1),this.set("translateBBox",e.translateBBox===!0),this.set("stretch",e.stretch!==!1),this.set("scale",e.scale!==!1),this.set("rotate",e.rotate!==!1),this.set("keepAspectRatio",e.keepAspectRatio||function(i){return i.originalEvent.shiftKey}),this.set("modifyCenter",e.modifyCenter||function(i){return i.originalEvent.metaKey||i.originalEvent.ctrlKey}),this.set("noFlip",e.noFlip||!1),this.set("selection",e.selection!==!1),this.set("hitTolerance",e.hitTolerance||0),this.set("enableRotatedTransform",e.enableRotatedTransform||!1),this.set("keepRectangle",e.keepRectangle||!1),this.set("buffer",e.buffer||0),this.on("propertychange",function(){this.drawSketch_()}),this.setDefaultStyle()}setMap(e){var t=this.getMap();if(t){var i=t.getTargetElement();t.removeLayer(this.overlayLayer_),this.previousCursor_&&i&&(i.style.cursor=this.previousCursor_),this.previousCursor_=void 0}super.setMap(e),this.overlayLayer_.setMap(e),e===null&&this.select(null),e!==null&&(this.isTouch=/touch/.test(e.getViewport().className),this.setDefaultStyle())}setActive(e){this.select(null),this.overlayLayer_&&this.overlayLayer_.setVisible(e),super.setActive(e)}setDefaultStyle(e){e=e||{};var t=e.pointStroke||new z({color:[255,0,0,1],width:1}),i=e.stroke||new z({color:[255,0,0,1],width:1,lineDash:[4,4]}),s=e.fill||new $({color:[255,0,0,.01]}),a=e.pointFill||new $({color:[255,255,255,.8]}),l=new oe({fill:a,stroke:t,radius:this.isTouch?12:6,displacement:this.isTouch?[24,-24]:[12,-12],points:15});l.setDisplacement||(l.getAnchor()[0]=this.isTouch?-10:-5);var n=new oe({fill:a,stroke:t,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),h=new oe({fill:a,stroke:t,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function c(d,f,u){return[new V({image:d,stroke:f,fill:u})]}this.style={default:c(n,i,s),translate:c(n,t,a),rotate:c(l,t,a),rotate0:c(n,t,a),scale:c(n,t,a),scale1:c(n,t,a),scale2:c(n,t,a),scale3:c(n,t,a),scalev:c(h,t,a),scaleh1:c(h,t,a),scalev2:c(h,t,a),scaleh3:c(h,t,a)},this.drawSketch_()}setStyle(e,t){if(t){t instanceof Array?this.style[e]=t:this.style[e]=[t];for(var i=0;i<this.style[e].length;i++){var s=this.style[e][i].getImage();s&&(e=="rotate"&&(s.getAnchor()[0]=-5),this.isTouch&&s.setScale(1.8));var a=this.style[e][i].getText();a&&(e=="rotate"&&a.setOffsetX(this.isTouch?14:7),this.isTouch&&a.setScale(1.8))}this.drawSketch_()}}getFeatureAtPixel_(e){var t=this;return this.getMap().forEachFeatureAtPixel(e,function(i,s){var a=!1;if(!s){if(i===t.bbox_)return t.get("translateBBox")?{feature:i,handle:"translate",constraint:"",option:""}:!1;if(t.handles_.forEach(function(n){n===i&&(a=!0)}),a)return{feature:i,handle:i.get("handle"),constraint:i.get("constraint"),option:i.get("option")}}if(!t.get("selection"))return t.selection_.getArray().some(function(n){return i===n})?{feature:i}:null;if(t._filter)return t._filter(i,s)?{feature:i}:null;if(t.layers_){for(var l=0;l<t.layers_.length;l++)if(t.layers_[l]===s)return{feature:i};return null}else return t.features_?(t.features_.forEach(function(n){n===i&&(a=!0)}),a?{feature:i}:null):{feature:i}},{hitTolerance:this.get("hitTolerance")})||{}}getGeometryRotateToZero_(e,t){var i=e.getGeometry(),s=this.getMap().getView().getRotation();if(s===0||!this.get("enableRotatedTransform"))return t?i.clone():i;var a=i.clone();return a.rotate(s*-1,this.getMap().getView().getCenter()),a}_isRectangle(e){if(this.get("keepRectangle")&&e.getType()==="Polygon"){var t=e.getCoordinates()[0];return t.length===5}return!1}drawSketch_(e){var t,i,s,a=this.selection_.item(0)&&this._isRectangle(this.selection_.item(0).getGeometry());if(this.overlayLayer_.getSource().clear(),!!this.selection_.getLength()){var l=this.getMap().getView().getRotation(),n=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent(),h;a&&(h=this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0,4),h.unshift(h[3])),n=Te(n,this.get("buffer")),this.selection_.forEach((function(g){var y=this.getGeometryRotateToZero_(g).getExtent();he(n,y)}).bind(this));var c=this.selection_.getLength()===1?this._pointRadius(this.selection_.item(0)):0;if(c&&!(c instanceof Array)&&(c=[c,c]),e===!0)this.ispt_||(this.overlayLayer_.getSource().addFeature(new U({geometry:new G(this.center_),handle:"rotate0"})),s=ie(n),this.get("enableRotatedTransform")&&l!==0&&s.rotate(l,this.getMap().getView().getCenter()),i=this.bbox_=new U(s),this.overlayLayer_.getSource().addFeature(i));else{if(this.ispt_){var d=this.getMap().getPixelFromCoordinate([n[0],n[1]]);if(d){var f=c&&c[0]||10,u=c&&c[1]||10;n=Ze([this.getMap().getCoordinateFromPixel([d[0]-f,d[1]-u]),this.getMap().getCoordinateFromPixel([d[0]+f,d[1]+u])])}}s=a?new ee([h]):ie(n),this.get("enableRotatedTransform")&&l!==0&&s.rotate(l,this.getMap().getView().getCenter()),i=this.bbox_=new U(s);var m=[],p=s.getCoordinates()[0];if(!this.ispt_||c){if(m.push(i),!this.iscircle_&&!this.ispt_&&this.get("stretch")&&this.get("scale"))for(t=0;t<p.length-1;t++)i=new U({geometry:new G([(p[t][0]+p[t+1][0])/2,(p[t][1]+p[t+1][1])/2]),handle:"scale",constraint:t%2?"h":"v",option:t}),m.push(i);if(this.get("scale"))for(t=0;t<p.length-1;t++)i=new U({geometry:new G(p[t]),handle:"scale",option:t}),m.push(i);this.get("translate")&&!this.get("translateFeature")&&(i=new U({geometry:new G([(p[0][0]+p[2][0])/2,(p[0][1]+p[2][1])/2]),handle:"translate"}),m.push(i))}!this.iscircle_&&this.get("rotate")&&(i=new U({geometry:new G(p[3]),handle:"rotate"}),m.push(i)),this.overlayLayer_.getSource().addFeatures(m)}}}select(e,t){if(!e){this.selection_&&(this.selection_.clear(),this.drawSketch_());return}if(!(!e.getGeometry||!e.getGeometry())){if(t)this.selection_.push(e);else{var i=this.selection_.getArray().indexOf(e);this.selection_.removeAt(i)}this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:e,features:this.selection_})}}setSelection(e){this.selection_.clear(),e.forEach((function(t){this.selection_.push(t)}).bind(this)),this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})}watchFeatures_(){this._featureListeners&&this._featureListeners.forEach(function(e){D(e)}),this._featureListeners=[],this.selection_.forEach((function(e){this._featureListeners.push(e.on("change",(function(){this.isUpdating_||this.drawSketch_()}).bind(this)))}).bind(this))}handleDownEvent_(e){if(this._handleEvent(e,this.selection_)){var t=this.getFeatureAtPixel_(e.pixel),i=t.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(i)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(t.handle="translate"),t.handle){this.mode_=t.handle,this.opt_=t.option,this.constraint_=t.constraint;var s=this.getMap().getView().getRotation();this.coordinate_=i.get("handle")?i.getGeometry().getCoordinates():e.coordinate,this.pixel_=this.getMap().getCoordinateFromPixel(this.coordinate_),this.geoms_=[],this.rotatedGeoms_=[];for(var a=be(),l=be(),n=0,h;h=this.selection_.item(n);n++)if(this.geoms_.push(h.getGeometry().clone()),a=he(a,h.getGeometry().getExtent()),this.get("enableRotatedTransform")&&s!==0){var c=this.getGeometryRotateToZero_(h,!0);this.rotatedGeoms_.push(c),l=he(l,c.getExtent())}if(this.extent_=ie(a).getCoordinates()[0],this.get("enableRotatedTransform")&&s!==0&&(this.rotatedExtent_=ie(l).getCoordinates()[0]),this.mode_==="rotate"){this.center_=this.getCenter()||re(a);var d=e.map.getTargetElement();d.style.cursor=this.Cursors.rotate0,this.previousCursor_=d.style.cursor}else this.center_=re(a);return this.angle_=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!0}else if(this.get("selection")){if(i){this.addFn_(e)||this.selection_.clear();var f=this.selection_.getArray().indexOf(i);f<0?this.selection_.push(i):this.selection_.removeAt(f)}else this.selection_.clear();return this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:i,features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!1}}}getCenter(){return this.get("center")}setCenter(e){return this.set("center",e)}handleDragEvent_(e){if(this._handleEvent(e,this.features_)){var t=this.getMap().getView().getRotation(),i,s,a,l,n=[this.coordinate_[0],this.coordinate_[1]],h=[e.coordinate[0],e.coordinate[1]];switch(this.isUpdating_=!0,this.mode_){case"rotate":{var c=Math.atan2(this.center_[1]-h[1],this.center_[0]-h[0]);if(!this.ispt)for(i=0,a;a=this.selection_.item(i);i++)l=this.geoms_[i].clone(),l.rotate(c-this.angle_,this.center_),l.getType()=="Circle"&&l.setCenterAndRadius(l.getCenter(),l.getRadius()),a.setGeometry(l);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:c-this.angle_,pixel:e.pixel,coordinate:e.coordinate});break}case"translate":{var d=h[0]-n[0],f=h[1]-n[1];for(i=0,a;a=this.selection_.item(i);i++)a.getGeometry().translate(d,f);this.handles_.forEach(function(k){k.getGeometry().translate(d,f)}),this.coordinate_=e.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[d,f],pixel:e.pixel,coordinate:e.coordinate});break}case"scale":{var u=this.center_;if(this.get("modifyCenter")(e)){var m=this.extent_;this.get("enableRotatedTransform")&&t!==0&&(m=this.rotatedExtent_),u=m[(Number(this.opt_)+2)%4]}var p=this.geoms_.length==1&&this._isRectangle(this.geoms_[0]),g=this.constraint_,y=this.opt_,b=this.coordinate_,x=e.coordinate;if(this.get("enableRotatedTransform")&&t!==0){var C=new G(this.coordinate_);C.rotate(t*-1,u),b=C.getCoordinates();var N=new G(e.coordinate);N.rotate(t*-1,u),x=N.getCoordinates()}var S=(x[0]-u[0])/(b[0]-u[0]),E=(x[1]-u[1])/(b[1]-u[1]),_=[x[0]-b[0],x[1]-b[1]];if(this.get("enableRotatedTransform")&&t!==0){var M=new G(u);M.rotate(t*-1,this.getMap().getView().getCenter()),u=M.getCoordinates()}for(this.get("noFlip")&&(S<0&&(S=-S),E<0&&(E=-E)),this.constraint_?this.constraint_=="h"?S=1:E=1:this.get("keepAspectRatio")(e)&&(S=E=Math.min(S,E)),i=0,a;a=this.selection_.item(i);i++)l=t===0||!this.get("enableRotatedTransform")?this.geoms_[i].clone():this.rotatedGeoms_[i].clone(),l.applyTransform((function(k,L,w){if(w<2)return L;if(p){var v=[[6],[0,8],[2],[4]],T=[k[0],k[1]],P=[k[2],k[3]],I=[k[4],k[5]],A=[k[6],k[7]],W=[k[8],k[9]];if(g){var te=y%2===0?this._countVector(T,P):this._countVector(A,T),B=this._projectVectorOnVector(_,te),le=y+1<v.length?y+1:0,j=[...v[y],...v[le]];for(s=0;s<k.length;s+=w)L[s]=j.includes(s)?k[s]+B[0]:k[s],L[s+1]=j.includes(s)?k[s+1]+B[1]:k[s+1]}else{var O,F;switch(y){case 0:_=this._countVector(A,x),O=this._projectVectorOnVector(_,this._countVector(I,A)),F=this._projectVectorOnVector(_,this._countVector(T,A)),[L[0],L[1]]=this._movePoint(T,O),[L[4],L[5]]=this._movePoint(I,F),[L[6],L[7]]=this._movePoint(A,_),[L[8],L[9]]=this._movePoint(W,O);break;case 1:_=this._countVector(T,x),O=this._projectVectorOnVector(_,this._countVector(A,T)),F=this._projectVectorOnVector(_,this._countVector(P,T)),[L[0],L[1]]=this._movePoint(T,_),[L[2],L[3]]=this._movePoint(P,O),[L[6],L[7]]=this._movePoint(A,F),[L[8],L[9]]=this._movePoint(W,_);break;case 2:_=this._countVector(P,x),O=this._projectVectorOnVector(_,this._countVector(T,P)),F=this._projectVectorOnVector(_,this._countVector(I,P)),[L[0],L[1]]=this._movePoint(T,F),[L[2],L[3]]=this._movePoint(P,_),[L[4],L[5]]=this._movePoint(I,O),[L[8],L[9]]=this._movePoint(W,F);break;case 3:_=this._countVector(I,x),O=this._projectVectorOnVector(_,this._countVector(P,I)),F=this._projectVectorOnVector(_,this._countVector(A,I)),[L[2],L[3]]=this._movePoint(P,F),[L[4],L[5]]=this._movePoint(I,_),[L[6],L[7]]=this._movePoint(A,O);break}}}else for(s=0;s<k.length;s+=w)S!=1&&(L[s]=u[0]+(k[s]-u[0])*S),E!=1&&(L[s+1]=u[1]+(k[s+1]-u[1])*E);return l.getType()=="Circle"&&l.setCenterAndRadius(l.getCenter(),l.getRadius()),L}).bind(this)),this.get("enableRotatedTransform")&&t!==0&&l.rotate(t,this.getMap().getView().getCenter()),a.setGeometry(l);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[S,E],pixel:e.pixel,coordinate:e.coordinate});break}}this.isUpdating_=!1}}handleMoveEvent_(e){if(this._handleEvent(e,this.features_)&&!this.mode_){var t=this.getFeatureAtPixel_(e.pixel),i=e.map.getTargetElement();if(t.feature){var s=t.handle?this.Cursors[(t.handle||"default")+(t.constraint||"")+(t.option||"")]:this.Cursors.select;this.previousCursor_===void 0&&(this.previousCursor_=i.style.cursor),i.style.cursor=s}else this.previousCursor_!==void 0&&(i.style.cursor=this.previousCursor_),this.previousCursor_=void 0}}handleUpEvent_(e){if(this.mode_==="rotate"){var t=e.map.getTargetElement();t.style.cursor=this.Cursors.default,this.previousCursor_=void 0}return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_}),this.drawSketch_(),this.mode_=null,!1}setPointRadius(e){typeof e=="function"?this._pointRadius=e:this._pointRadius=function(){return e}}getFeatures(){return this.selection_}_projectVectorOnVector(e,t){var i=(e[0]*t[0]+e[1]*t[1])/(t[0]*t[0]+t[1]*t[1]);return[t[0]*i,t[1]*i]}_countVector(e,t){return[t[0]-e[0],t[1]-e[1]]}_movePoint(e,t){return[e[0]+t[0],e[1]+t[1]]}};ht.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"};var Pe=class extends we{constructor(e){e=e||{},super(),this.duration_=typeof e.duration=="number"?e.duration>=0?e.duration:0:1e3,this.fade_=typeof e.fade=="function"?e.fade:null,this.repeat_=Number(e.repeat);var t=typeof e.easing=="function"?e.easing:Qe;e.revers?this.easing_=function(i){return 1-t(i)}:this.easing_=t,this.hiddenStyle=e.hiddenStyle}drawGeom_(e,t,i){var s={type:"drawing",time:e.time,feature:e.feature,start:e.start,stop:e.stop,rotation:e.rotation,style:e.style,extra:e.extra};this.dispatchEvent(s);var a=s.style instanceof Array?s.style:[s.style];this.fade_&&(e.context.globalAlpha=this.fade_(1-e.elapsed));for(var l=0;l<a.length;l++)try{var n=e.vectorContext||xe(e),h=$e(e,a[l]);n.setStyle(h),h.getZIndex()<0?n.drawGeometry(i||t):n.drawGeometry(t)}catch{}}animate(){return!1}};Pe.hiddenStyle=new V({image:new Je({}),stroke:new z({color:"transparent"})});Se.prototype.animateFeature=function(r,e){var t=this._featureAnimationLayer;t||(t=this._featureAnimationLayer=new de({source:new Ee}),t.setMap(this)),t.getSource().addFeature(r);var i=e.on("animationend",function(s){s.feature===r&&(t.getSource().removeFeature(r),D(i))});t.animateFeature(r,e)};Ke.prototype.animateFeature=function(r,e,t){var i=this,s,a=r.getStyle(),l=a||(this.getStyleFunction?this.getStyleFunction()(r):null);l||(l=[]),l instanceof Array||(l=[l]);var n={vectorContext:null,frameState:null,start:0,time:0,elapsed:0,extent:!1,feature:r,geom:r.getGeometry(),typeGeom:r.getGeometry().getType(),bbox:r.getGeometry().getExtent(),coord:re(r.getGeometry().getExtent()),style:l};e instanceof Array||(e=[e]);for(var h=e.length-1;h>=0;h--)e[h].duration_===0&&e.splice(h,1);var c=0,d=0,f=t&&this.getFilters?this.getFilters():[];function u(g){n.type=g.type;try{n.vectorContext=g.vectorContext||xe(g)}catch{}if(n.frameState=g.frameState,n.inversePixelTransform=g.inversePixelTransform,n.extent||(n.extent=g.frameState.extent,n.start=g.frameState.time,n.context=g.context),n.time=g.frameState.time-n.start,n.elapsed=n.time/e[d].duration_,n.elapsed>1&&(n.elapsed=1),g.context.save(),f.forEach(function(b){b.get("active")&&b.precompose(g)}),this.getOpacity&&(g.context.globalAlpha=this.getOpacity()),!e[d].animate(n))c++,c<e[d].repeat_?n.extent=!1:d<e.length-1?(e[d].dispatchEvent({type:"animationend",feature:r}),d++,c=0,n.extent=!1):m();else{var y={type:"animating",step:d,start:n.start,time:n.time,elapsed:n.elapsed,rotation:n.rotation||0,geom:n.geom,coordinate:n.coord,feature:r,extra:n.extra||{},style:l};e[d].dispatchEvent(y),i.dispatchEvent(y)}f.forEach(function(b){b.get("active")&&b.postcompose(g)}),g.context.restore(),g.frameState.animate=!0}function m(g){D(s),s=null,r.setStyle(a),n.stop=new Date().getTime();var y={type:"animationend",feature:r};if(g)for(var b in g)g.hasOwnProperty(b)&&(y[b]=g[b]);e[d].dispatchEvent(y),i.dispatchEvent(y)}function p(g){if(e.length&&!s){if(n.stop&&(n.start=new Date().getTime()-n.stop+n.start,n.stop=0),s=i.on(["postcompose","postrender"],u.bind(i)),i.renderSync)try{i.renderSync()}catch{}else i.changed();r.setStyle(e[d].hiddenStyle||Pe.hiddenStyle);var y={type:"animationstart",feature:r};if(g)for(var b in g)g.hasOwnProperty(b)&&(y[b]=g[b]);e[d].dispatchEvent(y),i.dispatchEvent(y)}}return p(),{start:p,stop:m,isPlaying:function(){return!!s}}};
