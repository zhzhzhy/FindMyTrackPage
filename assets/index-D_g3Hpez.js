import{$ as pe,o as x,c as I,g as o,k as s,a as r,d as Le,W as w,e as X,w as ae,j as R,b as Y,f as Ve,F as Q,Z as we,y as O,A as xe,r as me,a0 as fe,a1 as ve,a2 as Pe,C as ue,l as te,m as je,J as Ie,v as ie,_ as Ne}from"./vue-AEYJ6ivp.js";import{H as Ee}from"./@vuepic-f6R27wR1.js";import{u as Z,a as b,r as oe,d as H,c as De,v as Oe}from"./@vue-CojEnYtN.js";import{m as B}from"./mapbox-gl-DWMaBres.js";import{M as Te}from"./@mapbox-xjKLDsbk.js";import"./tinycolor2-CfovpC5H.js";import{P as ke}from"./vue3-emoji-picker-BTVvo7Px.js";import{e as de}from"./gcoord-CaovwXKb.js";import{E as ce,i as He,z as Fe}from"./element-plus-3SOxJqDN.js";import{c as ze,a as Re}from"./vue-router-43WBMuwn.js";import"./vue3-openlayers-DEL4v-Rs.js";import{Q as Ue}from"./@element-plus-k4o0aaMK.js";import{l as Ae,f as Be,F as Ke}from"./@fortawesome-B3-jPt-b.js";import"./date-fns-DjqgiLk-.js";import"./lodash-es-CiJSjksT.js";import"./@vueuse-C7Mcvaak.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-n4Xreh4I.js";import"./async-validator-CiEh-HP4.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-B-WCBpf0.js";import"./ol-PaOofTtg.js";import"./rbush-DoHIURGA.js";import"./quickselect-cI_fw6Fh.js";import"./color-space-CC1atxIw.js";import"./color-rgba-QbDrIVEx.js";import"./color-parse-D1WSI7GZ.js";import"./color-name-XvCybByO.js";import"./earcut-DymNFgKl.js";import"./ol-ext-DKhM1omF.js";import"./ol-contextmenu-DtPVqisZ.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&e(d)}).observe(document,{childList:!0,subtree:!0});function p(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(t){if(t.ep)return;t.ep=!0;const i=p(t);fetch(t.href,i)}})();const J=(c,n)=>{const p=c.__vccOpts||c;for(const[e,t]of n)p[e]=t;return p},Je={class:"daterangepicker"},Ge={class:"sidebar"},We={__name:"VueDatePicker",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(c){const n=pe(c,"modelValue");if(!n.value||n.value.length===0){const i=new Date,d=new Date(new Date().setDate(i.getDate()-7));n.value=[d,i]}const p=()=>{const i=new Date,d=new Date(new Date().setHours(i.getHours()-1));n.value=[d,i]},e=()=>{const i=new Date,d=new Date(new Date().setDate(i.getDate()-1));n.value=[d,i]},t=()=>{const i=new Date,d=new Date(new Date().setDate(i.getDate()-7));n.value=[d,i]};return(i,d)=>(x(),I("div",Je,[o(Z(Ee),{modelValue:n.value,"onUpdate:modelValue":d[3]||(d[3]=u=>n.value=u),"teleport-center":"",range:""},{"right-sidebar":s(()=>[r("div",Ge,[r("div",{class:"sidebar-div",onClick:d[0]||(d[0]=u=>p())},"Last Hour"),r("div",{class:"sidebar-div",onClick:d[1]||(d[1]=u=>e())},"Last Day"),r("div",{class:"sidebar-div",onClick:d[2]||(d[2]=u=>t())},"Last Week")])]),_:1},8,["modelValue"])]))}},ye=J(We,[["__scopeId","data-v-905a76cf"]]),qe={class:"block"},Ze=Le({__name:"ElementDateTimePicker",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(c){const n=pe(c,"modelValue");if(!n.value||n.value.length===0){const e=new Date,t=new Date(new Date().setDate(e.getDate()-7));n.value=[t,e]}const p=[{text:"Last day",value:()=>{const e=new Date,t=new Date;return t.setDate(t.getDate()-1),[t,e]}},{text:"Last week",value:()=>{const e=new Date,t=new Date;return t.setDate(t.getDate()-7),[t,e]}},{text:"Last month",value:()=>{const e=new Date,t=new Date;return t.setMonth(t.getMonth()-1),[t,e]}},{text:"Last 3 months",value:()=>{const e=new Date,t=new Date;return t.setMonth(t.getMonth()-3),[t,e]}}];return(e,t)=>{const i=w("el-date-picker");return x(),I("div",qe,[o(i,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=d=>n.value=d),type:"datetimerange",shortcuts:p,"range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date"},null,8,["modelValue"])])}}}),he=J(Ze,[["__scopeId","data-v-aadf7784"]]),Ye={__name:"GeoJSONConverter",props:{data:{type:Object,required:!0,default:{}}},setup(c,{expose:n}){const p=c,e=b({}),t=i=>{if(Object.keys(i).length>0){const d=i.data,u=[...d].sort((y,C)=>new Date(y.isodatetime)-new Date(C.isodatetime)),S=u.map(y=>({type:"Feature",properties:{name:y.id_short,id:y.id,conf:y.conf,status:y.status,TimeStamp:y.isodatetime,statusCode:y.statusCode},geometry:{type:"Point",coordinates:[y.longitude,y.latitude]}})),M=new Map,g=new Set([...d].map(y=>y.id));for(const y of g){const C=u.filter(N=>N.id==y).map(N=>[N.longitude,N.latitude]);C.length>1&&M.set(y,C)}const f=Array.from(M,([y,C])=>({type:"Feature",properties:{id:y},geometry:{type:"LineString",coordinates:C,direction:"forward","arrow-symbol":"triangle"}}));e.value={type:"FeatureCollection",features:[...S,...f]}}};return X(()=>{ae(()=>p.data,i=>{Object.keys(i).length>0&&t(i)},{immediate:!0})}),n({convertToGeoJson:t,geoJsonData:e}),(i,d)=>null}},Qe={__name:"DataHandler",props:{payload:{type:Object,default:{}}},emits:["responseError"],setup(c,{expose:n,emit:p}){const e=b(null),t=b(!0),i=b(null),d=b(),u=b(null),S=p,M=async g=>{const f={idArray:g.idSelected,dateTimeRange:{start:g.dateTimeRange[0],end:g.dateTimeRange[1]},mode:g.mode};try{const y=await fetch("https://fmt.geeek.cf/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!y.ok)throw S("responseError",y.text()),new Error(`Error: ${y.statusText}`);const C=await y.json();return C&&(d.value=C),C}catch(y){i.value=y.message}finally{t.value=!1}};return X(async()=>{ae(()=>e.value.geoJsonData,g=>{g&&(u.value=e.value.geoJsonData)},{immediate:!0})}),n({fetchData:M,exposedData:u}),(g,f)=>(x(),R(Ye,{data:d.value,ref_key:"Geojsondata",ref:e},null,8,["data"]))}},ge=J(Qe,[["__scopeId","data-v-d8316768"]]),Ce={__name:"localStorage",props:{data:{type:Object,required:!0,default:{}}},setup(c){const p=c.data;return ae(()=>p,e=>{const t=JSON.stringify(e);localStorage.setItem("itemsProp",t)},{deep:!0}),(e,t)=>null}},le=c=>(fe("data-v-fd8fa2d4"),c=c(),ve(),c),Xe={class:"main-layout-wrapper"},et={class:"main-layout"},tt=le(()=>r("i",{class:"fa-solid fa-list",style:{"margin-right":"10px"}},null,-1)),ot={class:"flex-center"},at={class:"flex flex-wrap gap-4"},lt=le(()=>r("span",{class:"hide-small",style:{"vertical-align":"middle"}}," Clear ",-1)),nt={class:"flex"},st=le(()=>r("i",{class:"fa-regular fa-square-check hide-small margin-right"},null,-1)),rt=le(()=>r("i",{class:"fa-solid fa-fire hide-small margin-right"},null,-1)),it=le(()=>r("i",{class:"fa-regular fa-clock hide-small margin-right"},null,-1)),dt={__name:"MainPanel",props:{itemsProps:{type:Object,default:{}},loading:{type:Boolean,default:!1}},emits:["submit","addHeatMap","realtime"],setup(c,{emit:n}){const p=b(!1);b("btt");const e=b([]),t=b({}),i=b(null),d=b({}),u=oe({idSelected:[],dateTimeRange:{start:"",end:""},mode:""}),S=c,M=Y(()=>S.loading),g=b(window.innerWidth),f=()=>{g.value=window.innerWidth},y=n,C=Y(()=>g.value<=770?"90%":"30%"),N=Y(()=>g.value<=770),z=()=>{u.idSelected.length>0&&Array.from(u.dateTimeRange).length>1&&y("submit",u)},K=()=>{u.idSelected.length>0&&Array.from(u.dateTimeRange).length>1&&y("addHeatMap",u)},U=()=>{u.idSelected.length>0&&y("realtime",u)},$=()=>{u.idSelected=[]};return X(()=>{window.addEventListener("resize",f),u.dateTimeRange=e.value,ae(()=>e.value,v=>{u.dateTimeRange=v,t.value=v}),ae(()=>u,v=>{t.value=v},{deep:!0})}),Ve(()=>{window.removeEventListener("resize",f)}),(v,h)=>{const P=w("el-button"),E=w("el-option"),ee=w("el-select"),L=w("el-col"),l=w("CircleClose"),a=w("el-icon"),m=w("el-row"),_=w("el-form-item"),D=w("el-form"),T=w("el-card"),V=w("el-dialog"),F=we("loading");return x(),I(Q,null,[r("div",Xe,[r("div",et,[N.value?(x(),R(ye,{key:1,modelValue:e.value,"onUpdate:modelValue":h[1]||(h[1]=k=>e.value=k),range:""},null,8,["modelValue"])):(x(),R(he,{key:0,modelValue:e.value,"onUpdate:modelValue":h[0]||(h[0]=k=>e.value=k)},null,8,["modelValue"]))]),o(P,{class:"dialog-button",type:"primary",onClick:h[2]||(h[2]=k=>p.value=!0)},{default:s(()=>[tt,O("Data Select ")]),_:1}),o(ge,{payload:t.value,ref_key:"DataHandlerRef",ref:i},null,8,["payload"]),o(Ce,{data:d.value},null,8,["data"])]),o(V,{modelValue:p.value,"onUpdate:modelValue":h[6]||(h[6]=k=>p.value=k),title:"Data select",width:C.value,draggable:"","align-center":""},{default:s(()=>[r("div",ot,[xe((x(),I("div",at,[o(T,{class:"card",shadow:"never",style:{"max-width":"600px"}},{default:s(()=>[o(D,{model:u,"label-width":"auto"},{default:s(()=>[o(_,{label:"Items select"},{default:s(()=>[o(m,{gutter:10},{default:s(()=>[o(L,{span:20},{default:s(()=>[o(ee,{modelValue:u.idSelected,"onUpdate:modelValue":h[3]||(h[3]=k=>u.idSelected=k),multiple:"",filterable:"","default-first-option":"","reserve-keyword":!1,placeholder:"Choose your items",style:{"min-width":"150px"}},{default:s(()=>[(x(!0),I(Q,null,me(S.itemsProps.value,(k,A)=>(x(),R(E,{key:A,label:`${k.emoji} ${k.Name}`,value:k.pubKey},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(L,{span:4},{default:s(()=>[o(P,{onClick:$,type:"primary"},{default:s(()=>[o(a,{style:{"vertical-align":"middle"}},{default:s(()=>[o(l)]),_:1}),lt]),_:1})]),_:1})]),_:1})]),_:1}),o(_,{label:"Activity time",style:{"max-width":"600px"}},{default:s(()=>[o(L,{span:24},{default:s(()=>[N.value?(x(),R(ye,{key:1,modelValue:e.value,"onUpdate:modelValue":h[5]||(h[5]=k=>e.value=k),range:""},null,8,["modelValue"])):(x(),R(he,{key:0,modelValue:e.value,"onUpdate:modelValue":h[4]||(h[4]=k=>e.value=k)},null,8,["modelValue"]))]),_:1})]),_:1}),o(_,null,{default:s(()=>[r("div",nt,[o(P,{type:"primary",onClick:z},{default:s(()=>[st,O("Get Data ")]),_:1}),o(P,{type:"primary",onClick:K},{default:s(()=>[rt,O("HeatMap ")]),_:1}),o(P,{type:"primary",onClick:U},{default:s(()=>[it,O("RealTime ")]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})])),[[F,M.value]])])]),_:1},8,["modelValue","width"])],64)}}},ct=J(dt,[["__scopeId","data-v-fd8fa2d4"]]),ut={id:"menu"},pt={class:"input-label-row"},mt=["id","value","checked"],ft=["for"],be="streets",vt={__name:"MapboxMain",props:{geodata:{type:Object,default:{}},itemsPropMap:{type:Object,default:{}}},setup(c,{expose:n}){const p=b(null),e=b(null),t=b(null);let i=!1;const d={ar:"ar",de:"de",en:"en",es:"es",fr:"fr",it:"it",ja:"ja",ko:"ko",mul:"mul",pt:"pt",ru:"ru",vi:"vi","zh-CN":"zh-Hans","zh-HK":"zh-Hant","zh-TW":"zh-Hant","zh-Hans":"zh-Hans","zh-Hant":"zh-Hant"},u=[],S="pk.eyJ1IjoiZ2Vla2NhdCIsImEiOiJjbHc5ZTJ6dmIwMTEyMmpudGowMXk5Y3o2In0.HDxYFBSNCpbYan731GLJEw",M=[{id:"satellite-streets",label:"Satellite Streets",url:"mapbox://styles/geekcat/clwc44om0008b01pn91yg82cg"},{id:"light-v11",label:"Light",url:"mapbox://styles/mapbox/light-v11"},{id:"dark-v11",label:"Dark",url:"mapbox://styles/mapbox/dark-v11"},{id:"streets",label:"Streets",url:"mapbox://styles/geekcat/clwxb0z8q01ep01pohp1h4q4d"},{id:"outdoors",label:"Outdoors",url:"mapbox://styles/geekcat/clwxbnita01es01po7fto915q"},{id:"amap",label:"高德地图",url:{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://wprd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}"],tileSize:256}},layers:[{id:"amap-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:24}]}}],g=c,f=()=>{const l=navigator.language||navigator.userLanguage,a=navigator.language.split("-")[0];let m="mul";a=="zh"&&d[l]&&(m=d[l]),a!=="zh"&&d[a]&&(m=d[a]),B.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js");const _=new Te({defaultLanguage:m});e.value.language=m,e.value.setStyle(_.setLanguage(e.value.getStyle(),m)),e.value.addControl(_)},y=l=>{const a=l.target.value,m=M.find(_=>_.id===a).url;e.value&&(e.value.setStyle(m),e.value.once("style.load",()=>{g.geodata.status=="GeoJSONLayers"&&z(g.geodata.data),g.geodata.status=="HeatMap"&&N(g.geodata.data)}))},C=l=>{const a=["match",["get","id"]];return Object.entries(l).length>0&&Object.entries(l).forEach(([_,D])=>{a.push(_,D)}),a.push("#B42222"),a},N=l=>{Object.keys(l).length!=0&&(e.value.getSource("findmy-data")||e.value.addSource("findmy-data",{type:"geojson",data:l}),e.value.getLayer("findmy-heatmap")||e.value.addLayer({id:"findmy-heatmap",type:"heatmap",source:"findmy-data",maxzoom:17,paint:{"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3,15,10],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,15],"heatmap-opacity":["interpolate",["linear"],["zoom"],0,.6,10,.7,17,1]},filter:["==","$type","Point"]}))},z=l=>{if(Object.keys(l).length==0)return;const a={},m={};Object.entries(g.itemsPropMap.value).forEach(T=>{const[V,F]=T;a[V]=F.pointColor,m[V]=F.lineColor});const _=C(a),D=C(m);e.value.getSource("findmy-data")||e.value.addSource("findmy-data",{type:"geojson",data:l}),e.value.getLayer("findmy-point")||e.value.addLayer({id:"findmy-point",type:"circle",source:"findmy-data",paint:{"circle-radius":6,"circle-color":_},filter:["==","$type","Point"]}),e.value.getLayer("findmy-route")||e.value.addLayer({id:"findmy-route",type:"line",source:"findmy-data",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":D,"line-width":3,"line-dasharray":[1,2]},filter:["==","$type","LineString"]}),e.value.getLayer("line-arrows")||e.value.addLayer({id:"line-arrows",type:"symbol",source:"findmy-data",layout:{"symbol-placement":"line","text-field":"▶","text-size":24,"symbol-spacing":50,"text-keep-upright":!1},paint:{"text-color":"red"},filter:["==","$type","LineString"]})},K=(l,a)=>{l.forEach(m=>{e.value.getLayer(m)&&e.value.removeLayer(m)}),a.forEach(m=>{e.value.getSource(m)&&e.value.removeSource(m)})},U=l=>{const a=new B.LngLatBounds;l.features.forEach(function(m){const _=m.geometry.coordinates;a.extend(_)}),e.value.fitBounds(a,{padding:50,maxZoom:15})},$=l=>{const a=["in",["get","name"],["literal",l]];e.value.setFilter("findmy-point",a),e.value.setFilter("findmy-route",a),e.value.setFilter("line-arrows",a),i=!0},v=()=>{e.value.setFilter("findmy-point",null),e.value.setFilter("findmy-route",null),e.value.setFilter("line-arrows",null),i=!1},h=l=>{for(const a of l.features){const m=a.properties.id,_=document.createElement("div");_.className="marker";const D=document.createElement("div");if(D.className="markerWrapper",D.innerHTML='<div class="emoji-wrapper">🌏</div>',g.itemsPropMap.value[m].emoji){const re=g.itemsPropMap.value[m].emoji;D.innerHTML=`<div class="emoji-wrapper">${re}</div>`}_.appendChild(D);const T=g.itemsPropMap.value[m].Name,V=a.geometry.coordinates,F=V.join(","),k=a.properties.TimeStamp,A=new B.Popup({offset:25}).setHTML(`<strong>Name:</strong> ${T}<br/><strong>Coordinates:</strong> ${F}<br/><strong>Timestamp:</strong> ${k}`),se=new B.Marker(_).setLngLat(V).setPopup(A).addTo(e.value);u.push(se)}},P=()=>{if(u.length>0)for(const l of u)l.remove()};function E(){var l=e.value.getCenter(),a=e.value.getZoom();localStorage.setItem("mapCenter",JSON.stringify(l)),localStorage.setItem("mapZoom",a)}function ee(){var l=JSON.parse(localStorage.getItem("mapCenter")),a=localStorage.getItem("mapZoom");l&&a&&(e.value.setCenter(l),e.value.setZoom(a))}const L=new B.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});return n({map:e,switchStyle:y,setStyleLanguage:f,geometryColorSet:C,addHeatmapLayer:N,addGeoJSONLayers:z,removeGeoJSONLayers:K,setMapFilter:$,removeMapFilter:v,FitBounds:U,addRealtimeMarker:h,removeMarkers:P}),X(()=>{const l=[104.0657,30.6594];B.accessToken=S,e.value=new B.Map({container:p.value,style:M.find(a=>a.id===be).url,center:l,zoom:2}),ee(),e.value.on("moveend",function(){E()}),e.value.on("load",()=>{f()}),e.value.on("mouseenter","findmy-point",a=>{e.value.getCanvas().style.cursor="pointer";const m=i?1:0,_=a.features[m].geometry.coordinates.slice(),D=_.map(A=>A.toFixed(4).toString()),T=a.features[m].properties.TimeStamp,V=a.features[m].properties.id,F=g.itemsPropMap.value[V].Name,k=new B.Popup({offset:25}).setLngLat(_).setHTML(`<strong>Name:</strong> ${F}<br/><strong>Coordinates:</strong> ${D}<br/><strong>Timestamp:</strong> ${T}`).addTo(e.value);e.value.on("mouseleave","findmy-point",()=>{e.value.getCanvas().style.cursor="",k.remove()})}),e.value.on("click","findmy-point",a=>{const m=i?1:0,_=a.features[m].geometry.coordinates.slice(),D=_.map(k=>k.toFixed(4).toString()),T=a.features[m].properties.TimeStamp,V=a.features[m].properties.id,F=g.itemsPropMap.value[V].Name;new B.Popup({offset:25}).setLngLat(_).setHTML(`<strong>Name:</strong> ${F}<br/><strong>Coordinates:</strong> ${D}<br/><strong>Timestamp:</strong> ${T}`).addTo(e.value)}),e.value.addControl(new B.NavigationControl),e.value.addControl(L)}),(l,a)=>{const m=w("el-row"),_=w("el-col");return x(),I("div",null,[r("div",{id:"map",ref_key:"mapContainer",ref:p},null,512),o(ge,{ref_key:"DataHandlerRef",ref:t},null,512),r("div",ut,[o(_,null,{default:s(()=>[(x(),I(Q,null,me(M,D=>o(m,{span:6,key:D.id},{default:s(()=>[r("div",pt,[r("input",{id:D.id,type:"radio",name:"rtoggle",value:D.id,checked:D.id===be,onChange:y},null,40,mt),r("label",{for:D.id},H(D.label),9,ft)])]),_:2},1024)),64))]),_:1})])])}}},gt=J(vt,[["__scopeId","data-v-f9c0b5c1"]]),_e=c=>(fe("data-v-a0b54543"),c=c(),ve(),c),_t={class:"flex-row-center"},yt={class:"flex-row"},ht=_e(()=>r("div",{class:"margin-right"},"iconColor:",-1)),bt={class:"flex-row"},wt=_e(()=>r("div",{class:"margin-right"},"pointColor:",-1)),xt={class:"flex-row"},Dt=_e(()=>r("div",{class:"margin-right"},"lineColor:",-1)),kt={__name:"ColorPicker",props:{PropsMap:Object,selectedDevice:Object},setup(c){const n=c,p=Y({get(){return n.selectedDevice.prop.bgColor},set(d){n.selectedDevice.prop.bgColor=d}}),e=Y({get(){return n.selectedDevice.prop.pointColor},set(d){n.selectedDevice.prop.pointColor=d}}),t=Y({get(){return n.selectedDevice.prop.lineColor},set(d){n.selectedDevice.prop.lineColor=d}}),i=b(["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgb(255, 120, 0)","#c71585"]);return(d,u)=>{const S=w("el-color-picker"),M=w("el-col"),g=w("el-row");return x(),I("div",_t,[o(g,{gutter:10},{default:s(()=>[o(M,{xs:24,sm:24,md:8,lg:8},{default:s(()=>[r("div",yt,[ht,o(S,{modelValue:p.value,"onUpdate:modelValue":u[0]||(u[0]=f=>p.value=f),predefine:i.value},null,8,["modelValue","predefine"])])]),_:1}),o(M,{xs:24,sm:24,md:8,lg:8},{default:s(()=>[r("div",bt,[wt,o(S,{modelValue:e.value,"onUpdate:modelValue":u[1]||(u[1]=f=>e.value=f),predefine:i.value},null,8,["modelValue","predefine"])])]),_:1}),o(M,{xs:24,sm:24,md:8,lg:8},{default:s(()=>[r("div",xt,[Dt,o(S,{modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=f=>t.value=f),predefine:i.value},null,8,["modelValue","predefine"])])]),_:1})]),_:1})])}}},Ct=J(kt,[["__scopeId","data-v-a0b54543"]]),St={key:0,class:"flex-column"},Mt={class:"justify-center"},$t={class:"Emoji-2x"},Lt={class:"Edit-info-div"},Vt={class:"Edit-info-div-inner"},Pt={class:"info-item flex-prop"},jt={key:0,class:"single-line-text"},It={class:"info-item flex-prop"},Nt={key:0,class:"single-line-text"},Et={class:"info-item flex-prop"},Ot={key:0,class:"single-line-text"},Tt={class:"info-item flex-prop"},Ht={key:0,class:"single-line-text"},Ft={__name:"EditDeviceDialog",props:Pe({dialogEditVisible:Boolean,selectedDevice:Object,iconBgColor:Function,onSelectEmoji:Function},{modelValue:{prop:"modelValue",event:"update:modelValue"},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const n=c,p=pe(c,"modelValue"),e=b(!1),t=b(!1),i=b(!1),d=b(!1),u=b(!1),S=g=>{if(!u.value)switch(u.value=!0,setTimeout(()=>{u.value=!1},100),g){case"Name":e.value=!e.value;break;case"pubKey":t.value=!t.value;break;case"Location":i.value=!i.value;break;case"Lastupdate":d.value=!d.value;break}},M=g=>{S(g)};return(g,f)=>{const y=w("el-button"),C=w("el-popover"),N=w("el-col"),z=w("el-input"),K=w("el-row"),U=w("el-dialog");return x(),R(U,{modelValue:p.value,"onUpdate:modelValue":f[9]||(f[9]=$=>p.value=$),title:"Edit Device",draggable:"",width:"50%",class:"responsive-dialog"},{default:s(()=>[c.selectedDevice?(x(),I("div",St,[o(K,{gutter:10},{default:s(()=>[o(N,{xs:24,sm:24,md:6,lg:4},{default:s(()=>[r("div",Mt,[o(C,{placement:"top",title:"Icon Picker",width:300,trigger:"click"},{reference:s(()=>[o(y,{class:"icon-div-2x",style:De(c.iconBgColor(c.selectedDevice.prop.bgColor))},{default:s(()=>[r("div",$t,H(c.selectedDevice.prop.emoji),1)]),_:1},8,["style"])]),default:s(()=>[o(Z(ke),{native:!0,onSelect:f[0]||(f[0]=$=>c.onSelectEmoji($,c.selectedDevice.id))})]),_:1})])]),_:1}),o(N,{xs:24,sm:24,md:18,lg:20},{default:s(()=>[r("div",Lt,[r("div",Vt,[r("div",Pt,[O(" Name: "),e.value?(x(),R(z,{key:1,modelValue:c.selectedDevice.prop.Name,"onUpdate:modelValue":f[1]||(f[1]=$=>c.selectedDevice.prop.Name=$),onBlur:f[2]||(f[2]=$=>M("Name")),onKeyup:f[3]||(f[3]=ue($=>M("Name"),["enter"]))},null,8,["modelValue"])):(x(),I("span",jt,H(c.selectedDevice.prop.Name),1)),r("i",{onClick:f[4]||(f[4]=$=>S("Name")),class:"fas fa-edit edit-icon"})]),r("div",It,[O(" pubKey: "),t.value?(x(),R(z,{key:1,modelValue:c.selectedDevice.prop.pubKey,"onUpdate:modelValue":f[5]||(f[5]=$=>c.selectedDevice.prop.pubKey=$),onBlur:f[6]||(f[6]=$=>M("pubKey")),onKeyup:f[7]||(f[7]=ue($=>M("pubKey"),["enter"]))},null,8,["modelValue"])):(x(),I("span",Nt,H(c.selectedDevice.prop.pubKey),1)),r("i",{onClick:f[8]||(f[8]=$=>S("pubKey")),class:"fas fa-edit edit-icon"})]),r("div",Et,[O(" Location: "),i.value?te("",!0):(x(),I("span",Ot,H(c.selectedDevice.prop.Location),1))]),r("div",Tt,[O(" Lastupdate: "),d.value?te("",!0):(x(),I("span",Ht,H(c.selectedDevice.prop.Lastupdate),1))])])])]),_:1})]),_:1}),o(Ct,je(g.$attrs,{selectedDevice:n.selectedDevice}),null,16,["selectedDevice"])])):te("",!0)]),_:1},8,["modelValue"])}}},zt=J(Ft,[["__scopeId","data-v-64d6d802"]]),G=c=>(fe("data-v-c8c0bd1e"),c=c(),ve(),c),Rt={class:"manageForm"},Ut=G(()=>r("span",{class:"hide-small",style:{"vertical-align":"middle"}}," Add ",-1)),At={class:"justify-end"},Bt=G(()=>r("i",{class:"fa-solid fa-trash margin-right"},null,-1)),Kt=G(()=>r("span",{class:"hide-small",style:{"vertical-align":"middle"}}," Clear All",-1)),Jt=G(()=>r("i",{class:"fa-solid fa-rotate-right margin-right"},null,-1)),Gt=G(()=>r("span",{class:"hide-small",style:{"vertical-align":"middle"}}," Refresh ",-1)),Wt={class:"scrolldiv"},qt={class:"itemsdiv"},Zt={class:"card-inner"},Yt={class:"Emoji"},Qt={class:"item-prop"},Xt={class:"flex-prop"},eo={class:"flex-wrap"},to={key:0},oo=G(()=>r("i",{class:"fa-solid fa-copy"},null,-1)),ao={class:"flex-prop"},lo={class:"flex-wrap"},no={key:0},so=G(()=>r("i",{class:"fa-solid fa-copy"},null,-1)),ro={class:"single-line-text"},io={class:"single-line-text"},co={class:"main-layout-wrapper"},uo=G(()=>r("i",{class:"fa-solid fa-box-archive",style:{"margin-right":"10px"}},null,-1)),po={__name:"itemsManage",props:{propsMap:{type:Object,default:{}},loading:{type:Boolean,default:!1}},emits:["updateItemProps","reqUpdateItemProps"],setup(c,{emit:n}){const p=b(!1),e=b(!1),t=b(""),i=b(new Set),d=b(null),u=b(null),S=c,M=Oe(()=>S.loading),g=n,f=l=>l?`background-color:${l}`:"",y=b("350px"),C=()=>{const l=window.innerWidth,a=window.innerHeight;y.value=a*.5+"px",l<=768&&(y.value=a*.6+"px")};X(()=>{C(),window.addEventListener("resize",C),E()}),Ie(()=>{window.removeEventListener("resize",C)});const N=l=>{u.value={id:l,prop:L[l]},e.value=!0},z=l=>{d.value=l},K=l=>{l in L&&delete L[l]},U=(l,a)=>{L[a].emoji=l.i,L[a].emojiName=l.n[0],L[a].emojiValue=l.u},$=()=>{const l=t.value;if(l&&!i.value.has(l)){i.value.add(l);const a=l,m=ee();L[a]={emoji:"🌏",emojiName:"",emojiValue:"",bgColor:"#FFFFFF",pointColor:"red",lineColor:"blue",Name:m,serialNum:"N/A",pubKey:a,Lastupdate:"N/A",Added:new Date().toISOString(),Coordinate:["N/A","N/A"],Location:"N/A"},g("updateItemProps",L),t.value=""}},v=()=>{g("reqUpdateItemProps",L)},h=()=>{Object.keys(L).forEach(l=>{delete L[l]})},P=l=>{navigator.clipboard.writeText(l).then(()=>{console.log("Copied to clipboard successfully!")},a=>{console.error("Could not copy text: ",a)})},E=()=>{if(localStorage.getItem("itemsProp")){const l=localStorage.getItem("itemsProp"),a=JSON.parse(l);Object.assign(L,a.value),g("updateItemProps",L)}},ee=(()=>{const l=[];function a(m=5){const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let D="";for(let T=0;T<m;T++)D+=_.charAt(Math.floor(Math.random()*_.length));return D}return function(m=6){let _;do _=a(m);while(l.includes(_));return l.push(_),_}})();let L=oe({});return(l,a)=>{const m=w("el-input"),_=w("el-col"),D=w("CirclePlus"),T=w("el-icon"),V=w("el-button"),F=w("el-popconfirm"),k=w("el-row"),A=w("el-popover"),se=w("el-card"),re=w("el-scrollbar"),Me=w("el-dialog"),$e=we("loading");return x(),I(Q,null,[o(Me,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=j=>p.value=j),title:"Items Manage",draggable:"",width:"95%"},{default:s(()=>[r("div",Rt,[o(k,{gutter:20},{default:s(()=>[o(_,{xs:12,sm:8},{default:s(()=>[o(m,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=j=>t.value=j),onKeydown:ue($,["enter"])},null,8,["modelValue"])]),_:1}),o(_,{xs:4,sm:4},{default:s(()=>[o(V,{type:"primary",onClick:$},{default:s(()=>[o(T,{style:{"vertical-align":"middle"}},{default:s(()=>[o(D)]),_:1}),Ut]),_:1})]),_:1}),o(_,{xs:4,sm:8}),o(_,{xs:4,sm:4},{default:s(()=>[r("div",At,[o(F,{"confirm-button-text":"Yes","cancel-button-text":"No","icon-color":"red",title:"Are you sure to delete All items?",onConfirm:h},{reference:s(()=>[o(V,{class:"clear-button",type:"danger"},{default:s(()=>[Bt,Kt]),_:1})]),_:1}),o(V,{class:"refresh-button",type:"primary",onClick:v},{default:s(()=>[Jt,Gt]),_:1})])]),_:1})]),_:1})]),o(re,{"max-height":y.value},{default:s(()=>[xe((x(),I("div",Wt,[r("div",qt,[o(k,{gutter:10},{default:s(()=>[(x(!0),I(Q,null,me(Z(L),(j,q)=>(x(),R(_,{key:q,xs:24,sm:12,md:8,lg:6},{default:s(()=>[o(A,{ref_for:!0,ref:"popover",placement:"top",title:"Options",width:200,trigger:"contextmenu"},{reference:s(()=>[o(se,{class:"card",shadow:"hover",onClick:W=>N(q)},{default:s(()=>[r("div",Zt,[o(A,{placement:"right",title:"Icon Picker",width:300,trigger:"click"},{reference:s(()=>[o(V,{class:"icon-div",onClick:ie(W=>z(q),["stop"]),style:De(f(j.bgColor))},{default:s(()=>[r("div",Yt,H(j.emoji),1)]),_:2},1032,["onClick","style"])]),default:s(()=>[o(Z(ke),{native:!0,onSelect:W=>U(W,q)},null,8,["onSelect"])]),_:2},1024),r("div",Qt,[r("div",Xt,[O("Name: "),o(A,{trigger:"hover",placement:"top"},{reference:s(()=>[r("div",eo,[O(H(j.Name.substring(0,13))+" ",1),j.Name.length>10?(x(),I("div",to,"... ")):te("",!0),o(V,{link:"",onClick:ie(W=>P(j.Name),["stop"])},{default:s(()=>[oo]),_:2},1032,["onClick"])])]),default:s(()=>[r("div",null,H(j.Name),1)]),_:2},1024)]),r("div",ao,[O("pubKey: "),o(A,{trigger:"hover",placement:"top"},{reference:s(()=>[r("div",lo,[O(H(j.pubKey.substring(0,13))+" ",1),j.pubKey.length>10?(x(),I("div",no,"... ")):te("",!0),o(V,{link:"",onClick:ie(W=>P(j.pubKey),["stop"])},{default:s(()=>[so]),_:2},1032,["onClick"])])]),default:s(()=>[r("div",null,H(j.pubKey),1)]),_:2},1024)]),r("div",ro,"Location: "+H(j.Location),1),r("div",io,"LastUpdate: "+H(j.Lastupdate),1)])])]),_:2},1032,["onClick"])]),default:s(()=>[r("div",null,[o(V,{onClick:W=>N(q)},{default:s(()=>[O("Edit")]),_:2},1032,["onClick"]),o(V,{type:"danger",onClick:W=>K(q)},{default:s(()=>[O("Delete")]),_:2},1032,["onClick"])])]),_:2},1536)]),_:2},1024))),128))]),_:1})])])),[[$e,Z(M)]])]),_:1},8,["max-height"])]),_:1},8,["modelValue"]),o(zt,{modelValue:e.value,"onUpdate:modelValue":a[2]||(a[2]=j=>e.value=j),selectedDevice:u.value,iconBgColor:f,onSelectEmoji:U,PropsMap:Z(L)},null,8,["modelValue","selectedDevice","PropsMap"]),r("div",co,[o(V,{class:"dail-button",type:"primary",onClick:a[3]||(a[3]=j=>p.value=!0)},{default:s(()=>[uo,O("Items ")]),_:1})])],64)}}},mo=J(po,[["__scopeId","data-v-c8c0bd1e"]]),fo={__name:"ElementMessage",setup(c,{expose:n}){return n({popup:(e,t)=>{t||ce(e),["success","success","info"].includes(t)&&ce({message:e,type:t}),t=="error"&&ce.error(e)}}),(e,t)=>null}},Se={__name:"MainApp",setup(c){const n=b(null),p=b(null),e=b({}),t=oe({}),i=b(null),d=b(!1),u=b(!1),S={layers:["findmy-point","findmy-route","line-arrows","findmy-heatmap"],sources:["findmy-data"]},M=v=>{g(v),e.value.data=v,e.value.status="GeoJSONLayers",n.value.removeGeoJSONLayers(S.layers,S.sources),n.value.addGeoJSONLayers(v),n.value.FitBounds(v)},g=v=>{n.value.map.getStyle().layers[0].id=="amap-tiles"&&de.transform(v,de.WGS84,de.GCJ02)},f=v=>{e.value.data=v,e.value.status="HeatMap",g(v),n.value.removeGeoJSONLayers(S.layers,S.sources),n.value.addHeatmapLayer(v),n.value.FitBounds(v)},y=async v=>{d.value=!0,v.mode="timerange",await p.value.fetchData(v),d.value=!1;const h=p.value.exposedData;M(h)},C=async v=>{d.value=!0,v.mode="timerange",await p.value.fetchData(v),d.value=!1;const h=p.value.exposedData;f(h)},N=async v=>{d.value=!0;const h={...v};h.dateTimeRange=[],h.mode="realtime",await p.value.fetchData(h),d.value=!1;const P=p.value.exposedData;g(P),n.value.removeMarkers(),n.value.addRealtimeMarker(P),n.value.FitBounds(P)},z=async()=>{const v=t.value,h=oe({idSelected:[],dateTimeRange:[],mode:"realtime"});if(v&&Object.keys(v).length){Object.values(v).forEach(E=>{h.idSelected.push(E.pubKey)}),await p.value.fetchData(h);const P=p.value.exposedData;g(P),n.value.removeMarkers(),n.value.addRealtimeMarker(P),n.value.FitBounds(P)}},K=v=>{t.value=v},U=async v=>{u.value=!0;const h=oe({idSelected:[],dateTimeRange:[],mode:"realtime"});Object.values(v).forEach(E=>{h.idSelected.push(E.pubKey)});const P=await p.value.fetchData(h);u.value=!1,P.data.forEach(E=>{v[E.id].Lastupdate=E.isodatetime,v[E.id].Coordinate=[E.longitude,E.latitude]})},$=v=>{v.then(h=>{i.value.popup(h,"error")})};return X(()=>{z()}),(v,h)=>(x(),I(Q,null,[o(ct,{"items-props":t,loading:d.value,onSubmit:y,onAddHeatMap:C,onRealtime:N},null,8,["items-props","loading"]),o(mo,{loading:u.value,onUpdateItemProps:K,onReqUpdateItemProps:U},null,8,["loading"]),o(gt,{geodata:e.value,itemsPropMap:t,ref_key:"MapboxMainRef",ref:n},null,8,["geodata","itemsPropMap"]),o(ge,{ref_key:"DataHandlerRef",ref:p,onResponseError:$},null,512),o(Ce,{data:t},null,8,["data"]),o(fo,{ref_key:"ElementMessageRef",ref:i},null,512)],64))}},vo={__name:"App",setup(c){return(n,p)=>(x(),R(Se))}};ze({history:Re("/FindMyTrackPage/"),routes:[{path:"/",name:"home",component:Se}]});Ae.add(Be);const ne=Ne(vo);ne.component("font-awesome-icon",Ke);for(const[c,n]of Object.entries(Ue))ne.component(c,n);ne.use(He,{locale:Fe});ne.mount("#app");
